<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FATTO CRIMINAL - Jogos de Mist√©rio e Investiga√ß√£o</title>
    
    <!-- FONTES -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;900&family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- FIREBASE -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        /* ==================== RESET ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Open Sans', sans-serif;
            background: #000000;
            color: #FFFFFF;
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* ==================== VARI√ÅVEIS ==================== */
        :root {
            --amarelo: #FFD700;
            --preto: #2C2C2C;
            --cinza-claro: #F8F8F8;
            --cinza-medio: #E0E0E0;
            --branco: #FFFFFF;
            --verde: #4CAF50;
            --vermelho: #E53935;
            --azul: #2196F3;
        }

        /* ==================== ANIMA√á√ïES ==================== */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes successBounce {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.3); }
            50% { transform: scale(0.9); }
            75% { transform: scale(1.1); }
        }

        @keyframes confetti {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ==================== LOADING ==================== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 15000;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--cinza-medio);
            border-top: 5px solid var(--amarelo);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* ==================== HEADER ==================== */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: background: #000000;
            border-bottom: 1px solid var(--cinza-medio);
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .logo-container:hover {
            transform: scale(1.02);
        }

        .logo-img {
            height: 50px;
            width: auto;
        }

        .nav {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .nav button {
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: var(--preto);
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s;
            font-family: 'Montserrat', sans-serif;
            position: relative;
        }

        .nav button::after {
            content: '';
            position: absolute;
            bottom: 8px;
            left: 24px;
            right: 24px;
            height: 2px;
            background: var(--amarelo);
            transform: scaleX(0);
            transition: transform 0.3s;
        }

        .nav button:hover::after {
            transform: scaleX(1);
        }

        .btn-cart {
            position: relative;
        }

        .cart-badge {
            position: absolute;
            top: 0;
            right: 8px;
            background: var(--vermelho);
            color: #fff;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
        }

        /* ==================== HERO ==================== */
        .hero {
            position: relative;
            min-height: 90vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 140px 40px 80px;
            background: linear-gradient(135deg, #f5f5f5 0%, #ffffff 100%);
        }

        .hero-content {
            max-width: 1000px;
            animation: fadeIn 1s ease-out;
        }

        .hero-logo-big {
            max-width: 600px;
            width: 100%;
            margin: 0 auto 40px;
            filter: drop-shadow(0 4px 20px rgba(0,0,0,0.1));
        }

        .hero-slogan {
            font-size: 1.8rem;
            color: var(--preto);
            margin-bottom: 50px;
            font-weight: 300;
            letter-spacing: 1px;
        }

        .hero-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* ==================== BOT√ïES ==================== */
        .btn-primary {
            padding: 16px 40px;
            background: var(--preto);
            border: 2px solid var(--preto);
            color: var(--branco);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Montserrat', sans-serif;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .btn-primary:hover {
            background: var(--branco);
            color: var(--preto);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .btn-secondary {
            padding: 16px 40px;
            background: transparent;
            border: 2px solid var(--preto);
            color: var(--preto);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Montserrat', sans-serif;
        }

        .btn-secondary:hover {
            background: var(--preto);
            color: var(--branco);
            transform: translateY(-2px);
        }

        /* ==================== SECTIONS ==================== */
        .section {
            padding: 100px 40px;
            background: var(--branco);
        }

        .section-alt {
            background: var(--cinza-claro);
        }

        .section-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 3rem;
            text-align: center;
            margin-bottom: 20px;
            color: var(--preto);
            letter-spacing: 2px;
            font-weight: 700;
        }

        .section-subtitle {
            text-align: center;
            color: #666;
            font-size: 1.2rem;
            margin-bottom: 60px;
            font-weight: 300;
        }

        /* ==================== CASOS GRID ==================== */
        .casos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 40px;
            max-width: 1400px;
            margin: 0 auto;
            justify-items: center;
        }

        .case-card {
            background: var(--branco);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.4s;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            max-width: 420px;
            width: 100%;
        }

        .case-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }

        .case-banner {
            width: 100%;
            height: 280px;
            object-fit: cover;
        }

        .case-content {
            padding: 30px;
        }

        .case-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            color: var(--preto);
            margin-bottom: 12px;
            font-weight: 700;
        }

        .case-subtitle {
            color: #666;
            margin-bottom: 25px;
            font-size: 1rem;
            line-height: 1.6;
        }

        .case-tags {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 25px 0;
        }

        .case-tag {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--cinza-claro);
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .case-tag-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        .nivel-facil { background: var(--verde); color: white; }
        .nivel-medio { background: var(--amarelo); color: var(--preto); }
        .nivel-dificil { background: var(--vermelho); color: white; }

        .case-price {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.2rem;
            color: var(--preto);
            font-weight: 700;
            margin-top: 20px;
        }

        /* ==================== MENSAGENS ==================== */
        .toast {
            position: fixed;
            top: 100px;
            right: 40px;
            padding: 20px 30px;
            font-size: 1rem;
            font-weight: 600;
            z-index: 10000;
            animation: slideDown 0.5s ease-out;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            max-width: 400px;
            font-family: 'Montserrat', sans-serif;
        }

        .toast-sucesso {
            background: var(--verde);
            color: white;
        }

        .toast-erro {
            background: var(--vermelho);
            color: white;
        }

        .toast-aviso {
            background: var(--amarelo);
            color: var(--preto);
        }

        .toast-missao {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            font-size: 1.1rem;
            line-height: 1.8;
        }

        .toast-conquista {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            font-size: 1.3rem;
            animation: successBounce 0.6s ease-out;
        }

        /* ==================== ANIMA√á√ÉO DE SUCESSO ==================== */
        .success-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 20000;
            animation: fadeIn 0.5s ease-out;
        }

        .success-overlay.active {
            display: flex;
        }

        .success-content {
            text-align: center;
            animation: successBounce 1s ease-out;
        }

        .success-icon {
            font-size: 10rem;
            margin-bottom: 30px;
            animation: successBounce 1s ease-out infinite;
        }

        .success-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 4rem;
            color: var(--verde);
            margin-bottom: 20px;
            font-weight: 900;
        }

        .success-message {
            font-size: 1.8rem;
            color: white;
            margin-bottom: 40px;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--amarelo);
            animation: confetti 3s ease-out forwards;
        }

        /* ==================== FOOTER ==================== */
        .footer {
            background: var(--cinza-claro);
            border-top: 1px solid var(--cinza-medio);
            padding: 60px 40px 40px;
            text-align: center;
        }

        .footer-logo {
            font-family: 'Montserrat', sans-serif;
            font-size: 2rem;
            color: var(--preto);
            margin-bottom: 20px;
            font-weight: 700;
        }

        /* ==================== WHATSAPP ==================== */
        .whatsapp-float {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: #25D366;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.4);
            transition: all 0.3s;
            z-index: 999;
        }

        .whatsapp-float:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(37, 211, 102, 0.6);
        }

        /* ==================== INPUTS ==================== */
        input, select, textarea {
            width: 100%;
            padding: 16px 20px;
            background: var(--branco);
            border: 2px solid var(--cinza-medio);
            color: var(--preto);
            font-size: 1rem;
            transition: all 0.3s;
            border-radius: 4px;
            font-family: 'Open Sans', sans-serif;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--amarelo);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);
        }

        /* ==================== MODAL ==================== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 40px;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--branco);
            border-radius: 12px;
            padding: 50px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        /* ==================== TABS ==================== */
        .tabs-container {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 60px;
            flex-wrap: wrap;
            border-bottom: 2px solid var(--cinza-medio);
            padding-bottom: 10px;
        }

        .tab-btn {
            padding: 15px 30px;
            background: transparent;
            border: none;
            color: #666;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s;
            font-family: 'Montserrat', sans-serif;
            position: relative;
        }

        .tab-btn.active {
            color: var(--preto);
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--amarelo);
        }

        /* ==================== UTILITY ==================== */
        .hidden {
            display: none !important;
        }

        .page-content {
            min-height: 100vh;
            padding-top: 90px;
        }

        /* ==================== RANKING ==================== */
        .rank-table {
            background: var(--branco);
            border-radius: 12px;
            overflow: hidden;
            max-width: 1000px;
            margin: 0 auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .rank-header {
            background: var(--cinza-claro);
            padding: 20px;
            display: grid;
            grid-template-columns: 80px 1fr 150px 150px;
            gap: 20px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            color: var(--preto);
        }

        .rank-row {
            padding: 20px;
            display: grid;
            grid-template-columns: 80px 1fr 150px 150px;
            gap: 20px;
            border-bottom: 1px solid var(--cinza-medio);
            transition: all 0.3s;
        }

        .rank-row:hover {
            background: var(--cinza-claro);
        }

        .rank-row.user-rank {
            background: rgba(255, 215, 0, 0.1);
            border-left: 4px solid var(--amarelo);
        }

        /* ==================== RESPONSIVO ==================== */
        @media (max-width: 768px) {
            .hero-logo-big {
                max-width: 90%;
            }
            
            .hero-slogan {
                font-size: 1.3rem;
            }
            
            .nav {
                flex-wrap: wrap;
            }
            
            .nav button {
                font-size: 0.85rem;
                padding: 10px 16px;
            }
            
            .casos-grid {
                grid-template-columns: 1fr;
            }
            
            .section-title {
                font-size: 2rem;
            }

            .rank-header, .rank-row {
                grid-template-columns: 60px 1fr 100px 100px;
                font-size: 0.85rem;
            }
        }

        /* ==================== FORM GROUP ==================== */
        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--preto);
            font-family: 'Montserrat', sans-serif;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 40px;
        }
    </style>
</head>
<body>
    <!-- LOADING -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- HEADER -->
    <header class="header">
        <div class="header-content">
            <div class="logo-container" onclick="navegarPara('home')">
                <img src="FATTO_PRETO.png" alt="FATTO CRIMINAL" class="logo-img">
            </div>
            <nav class="nav">
                <button onclick="navegarPara('home')">In√≠cio</button>
                <button onclick="navegarPara('casos')">Casos</button>
                <button onclick="navegarPara('ranking')">Ranking</button>
                <button id="btnAreaDetetive" class="hidden" onclick="navegarPara('area-detetive')">Minha √Årea</button>
                <button id="btnPerfil" class="hidden" onclick="navegarPara('perfil')">Perfil</button>
                <button id="btnAjuda" onclick="navegarPara('ajuda')">Ajuda</button>
                <button id="btnCarrinho" class="btn-cart hidden" onclick="navegarPara('carrinho')">
                    üõí
                    <span class="cart-badge hidden" id="cartBadge">0</span>
                </button>
                <button id="btnLogin" onclick="navegarPara('login')">Login</button>
                <button id="btnSair" class="hidden" onclick="fazerLogout()">Sair</button>
            </nav>
        </div>
    </header>

    <!-- CONTE√öDO DIN√ÇMICO -->
    <div id="app-content"></div>

    <!-- FOOTER -->
    <footer class="footer">
        <div class="footer-logo">FATTO CRIMINAL</div>
        <p style="color: #666; margin: 15px 0; font-size: 1rem;">
            Jogos de Mist√©rio e Investiga√ß√£o
        </p>
        <div style="display: flex; gap: 20px; justify-content: center; margin: 30px 0;">
            <a href="#" style="color: var(--preto); font-size: 1.5rem; text-decoration: none;" title="Instagram">üì∑</a>
            <a href="#" style="color: var(--preto); font-size: 1.5rem; text-decoration: none;" title="TikTok">üéµ</a>
            <a href="#" style="color: var(--preto); font-size: 1.5rem; text-decoration: none;" title="YouTube">‚ñ∂Ô∏è</a>
        </div>
        <p style="color: #999; margin: 20px 0; font-size: 0.9rem;">
            ¬© 2025 Fatto Criminal. Todos os direitos reservados.
        </p>
    </footer>

    <!-- WHATSAPP -->
    <a 
        href="https://wa.me/5517988097070?text=Ol√°,%20preciso%20de%20ajuda!" 
        target="_blank" 
        rel="noopener noreferrer"
        class="whatsapp-float"
        title="Delegado Virtual"
    >
        <span style="font-size: 35px;">üïµÔ∏è</span>
    </a>

    <!-- TOAST -->
    <div id="toastMessage" class="toast hidden"></div>

    <!-- SUCCESS OVERLAY -->
    <div id="successOverlay" class="success-overlay">
        <div class="success-content">
            <div class="success-icon">üéâ</div>
            <h2 class="success-title">CASO RESOLVIDO!</h2>
            <p class="success-message" id="successText"></p>
            <button class="btn-primary" onclick="fecharSuccessOverlay()">CONTINUAR</button>
        </div>
    </div>

    <script>
        // ==================== 6 CASOS COMPLETOS ==================== //
        const casos = [
            {
                id: 1,
                numero: "FC0001",
                titulo: "O Expresso Noturno 247",
                subtitulo: "Uma morte no trem. Um mist√©rio a ser resolvido.",
                descricao: "Durante viagem noturna no trem expresso, passageiro √© encontrado morto em cabine trancada.",
                dificuldade: "M√©dio",
                nivelCor: "nivel-medio",
                tempoLimite: 180,
                destaque: true,
                precoDigital: 59.90,
                precoFisico: 89.90,
                banner: "https://images.unsplash.com/photo-1474487548417-781cb71495f3?w=800&h=400&fit=crop",
                classificacao: "16 anos",
                jogadores: "2-6",
                resumo: "√Äs 23h47, o Expresso Noturno 247 parte da esta√ß√£o central. Passageiros dormem tranquilos... at√© o grito. Na cabine 12, empres√°rio Marcos Silva jaz morto. Porta trancada por dentro. Janela fechada. Como o assassino escapou?",
                solucao: {
                    assassino: "Laura Mendes (Condutora)",
                    arma: "Veneno (Estricnina)",
                    motivo: "Vingan√ßa - Era ex-esposa",
                    local: "Cabine 12",
                    explicacao: "Laura vingou-se de Marcos que a traiu e abandonou 5 anos atr√°s. Envenenou o u√≠sque dele durante a ronda."
                },
                opcoes: {
                    assassinos: ["Laura Mendes (Condutora)", "Jo√£o Carlos (S√≥cio)", "Rita Silva (Secret√°ria)", "Paulo Mendes (Gar√ßom)", "Ana Costa (Passageira)"],
                    armas: ["Veneno (Estricnina)", "Faca", "Sufocamento", "Golpe na cabe√ßa", "Inje√ß√£o letal"],
                    motivos: ["Vingan√ßa - Era ex-esposa", "D√≠vida financeira", "Heran√ßa", "Chantagem", "Crime passional"],
                    locais: ["Cabine 12", "Vag√£o restaurante", "Banheiro", "Corredor", "Cabine 8"]
                }
            },
            {
                id: 2,
                numero: "FC0002",
                titulo: "A √öltima Exposi√ß√£o",
                subtitulo: "Morte na galeria de arte",
                descricao: "Curador de arte renomado encontrado morto minutos antes da abertura de exposi√ß√£o milion√°ria.",
                dificuldade: "Dif√≠cil",
                nivelCor: "nivel-dificil",
                tempoLimite: 240,
                destaque: true,
                precoDigital: 69.90,
                precoFisico: 99.90,
                banner: "https://images.unsplash.com/photo-1536924940846-227afb31e2a5?w=800&h=400&fit=crop",
                classificacao: "18 anos",
                jogadores: "3-8",
                resumo: "Galeria Moderna Art prepara abertura de exposi√ß√£o. Champagne gelando. Convidados chegando. Mas Roberto Costa, curador principal, n√£o atende telefone. Encontram-no morto no dep√≥sito, rodeado de obras car√≠ssimas. Uma delas est√° faltando.",
                solucao: {
                    assassino: "Gabriel Ferreira (Artista)",
                    arma: "Est√°tua de m√°rmore",
                    motivo: "Falsifica√ß√£o descoberta",
                    local: "Dep√≥sito da galeria",
                    explicacao: "Gabriel falsificava obras renascentistas. Roberto descobriu e seria denunciado na noite da exposi√ß√£o."
                },
                opcoes: {
                    assassinos: ["Gabriel Ferreira (Artista)", "Mariana Costa (Esposa)", "Lucas Silva (Assistente)", "Beatriz Mendes (Cr√≠tica)", "Fernando Lima (Investidor)"],
                    armas: ["Est√°tua de m√°rmore", "Moldura pesada", "Faca", "Veneno", "Sufocamento"],
                    motivos: ["Falsifica√ß√£o descoberta", "Heran√ßa", "Disputa profissional", "Romance", "Fraude financeira"],
                    locais: ["Dep√≥sito da galeria", "Sala principal", "Escrit√≥rio", "Banheiro VIP", "Estacionamento"]
                }
            },
            {
                id: 3,
                numero: "FC0003",
                titulo: "Sil√™ncio no Farol",
                subtitulo: "Faroleiro desaparecido",
                descricao: "Faroleiro respons√°vel por ilha isolada desaparece misteriosamente. Tr√™s semanas depois, corpo encontrado.",
                dificuldade: "Dif√≠cil",
                nivelCor: "nivel-dificil",
                tempoLimite: 300,
                destaque: true,
                precoDigital: 79.90,
                precoFisico: 109.90,
                banner: "https://images.unsplash.com/photo-1502134249126-9f3755a50d78?w=800&h=400&fit=crop",
                classificacao: "16 anos",
                jogadores: "2-4",
                resumo: "Ilha do Sil√™ncio. Farol isolado. Roberto Alves mora sozinho h√° 5 anos. Barco de suprimentos chega: porta aberta, farol apagado, Roberto sumiu. Tr√™s semanas depois, pescadores encontram corpo na praia.",
                solucao: {
                    assassino: "N√£o houve assassino (Acidente)",
                    arma: "Queda da plataforma",
                    motivo: "Consumo de √°lcool durante tempestade",
                    local: "Plataforma do farol",
                    explicacao: "Roberto bebeu durante tempestade, perdeu equil√≠brio na plataforma externa e caiu no mar."
                },
                opcoes: {
                    assassinos: ["N√£o houve assassino (Acidente)", "Entregador de suprimentos", "Ex-s√≥cio", "Irm√£o g√™meo", "Pescador local"],
                    armas: ["Queda da plataforma", "Afogamento", "Golpe", "Envenenamento", "Empurr√£o"],
                    motivos: ["Consumo de √°lcool durante tempestade", "D√≠vida antiga", "Disputa de heran√ßa", "Segredo enterrado", "Vingan√ßa"],
                    locais: ["Plataforma do farol", "Quarto", "Cozinha", "Rochedo", "Praia"]
                }
            },
            {
                id: 4,
                numero: "FC0004",
                titulo: "Caos no Cassino Royal",
                subtitulo: "Jogador envenenado",
                descricao: "Durante partida de p√¥quer de alto risco, jogador profissional morre envenenado na mesa.",
                dificuldade: "M√©dio",
                nivelCor: "nivel-medio",
                tempoLimite: 180,
                precoDigital: 59.90,
                precoFisico: 89.90,
                banner: "https://images.unsplash.com/photo-1511512578047-dfb367046420?w=800&h=400&fit=crop",
                classificacao: "18 anos",
                jogadores: "4-8",
                resumo: "Cassino Royal. Mesa VIP. Stakes milion√°rios. Carlos '√Ås' Ferreira est√° em dia de sorte. Drink. Aposta. All-in. Come√ßa a tremer. Colapsa. M√©dicos confirmam: envenenamento.",
                solucao: {
                    assassino: "Rita Santos (Dealer)",
                    arma: "Cianureto no whisky",
                    motivo: "D√≠vida de R$ 2 milh√µes",
                    local: "Mesa de p√¥quer VIP",
                    explicacao: "Rita devia 2 milh√µes para agiotas. Carlos era credor. Envenenou o whisky durante distra√ß√£o."
                },
                opcoes: {
                    assassinos: ["Rita Santos (Dealer)", "Paulo Costa (Jogador)", "Marina Silva (Gar√ßonete)", "Lucas Mendes (Seguran√ßa)", "Ana Lima (Gerente)"],
                    armas: ["Cianureto no whisky", "Veneno no charuto", "Inje√ß√£o", "P√≥ no ar", "Comprimido triturado"],
                    motivos: ["D√≠vida de R$ 2 milh√µes", "Trapa√ßa descoberta", "Chantagem", "Ci√∫me", "Vingan√ßa de jogo"],
                    locais: ["Mesa de p√¥quer VIP", "Bar", "Banheiro", "Sala privativa", "Cofre"]
                }
            },
            {
                id: 5,
                numero: "FC0005",
                titulo: "Overdose no Hospital Central",
                subtitulo: "M√©dico-chefe assassinado",
                descricao: "Dr. Fernando Oliveira, diretor do Hospital Central, encontrado morto ap√≥s turno.",
                dificuldade: "Dif√≠cil",
                nivelCor: "nivel-dificil",
                tempoLimite: 240,
                precoDigital: 69.90,
                precoFisico: 99.90,
                banner: "https://images.unsplash.com/photo-1516549655169-df83a0774514?w=800&h=400&fit=crop",
                classificacao: "16 anos",
                jogadores: "3-6",
                resumo: "03h15. Plant√£o acaba. Dr. Fernando vai ao escrit√≥rio. √Äs 06h00, enfermeira o encontra desfalecido. Overdose de morfina. Mas Fernando nunca usou drogas.",
                solucao: {
                    assassino: "Dra. Julia Rocha (Cirurgi√£)",
                    arma: "Inje√ß√£o de morfina",
                    motivo: "Erro m√©dico encoberto",
                    local: "Escrit√≥rio do diretor",
                    explicacao: "Julia cometeu erro fatal em cirurgia 2 anos atr√°s. Fernando sabia e ia denunciar ao conselho."
                },
                opcoes: {
                    assassinos: ["Dra. Julia Rocha (Cirurgi√£)", "Ricardo Santos (Enfermeiro)", "Maria Costa (Farmac√™utica)", "Carlos Lima (Paciente)", "Ana Silva (Administradora)"],
                    armas: ["Inje√ß√£o de morfina", "Comprimidos triturados", "Inala√ß√£o de anest√©sico", "Veneno", "Sufocamento"],
                    motivos: ["Erro m√©dico encoberto", "Disputa de cargo", "Fraude de medicamentos", "Chantagem", "Processo judicial"],
                    locais: ["Escrit√≥rio do diretor", "Centro cir√∫rgico", "Farm√°cia", "UTI", "Estacionamento"]
                }
            },
            {
                id: 6,
                numero: "FC0006",
                titulo: "Trai√ß√£o no Palco",
                subtitulo: "Atriz principal morta",
                descricao: "Minutos antes da estreia da pe√ßa mais aguardada do ano, protagonista √© encontrada morta no camarim.",
                dificuldade: "F√°cil",
                nivelCor: "nivel-facil",
                tempoLimite: 120,
                precoDigital: 49.90,
                precoFisico: 79.90,
                banner: "https://images.unsplash.com/photo-1503095396549-807759245b35?w=800&h=400&fit=crop",
                classificacao: "14 anos",
                jogadores: "2-5",
                resumo: "Teatro lotado. P√∫blico ansioso. Estreia de 'Amor e Morte'. Mas Camila Santos, estrela principal, n√£o aparece. Encontram-na no camarim. Caf√© envenenado ao lado.",
                solucao: {
                    assassino: "Marina Costa (Atriz substituta)",
                    arma: "Cianureto no caf√©",
                    motivo: "Inveja - queria papel principal",
                    local: "Camarim principal",
                    explicacao: "Marina era substituta h√° 3 anos. Sempre segunda op√ß√£o. Envenenou caf√© minutos antes da estreia."
                },
                opcoes: {
                    assassinos: ["Marina Costa (Atriz substituta)", "Paulo Silva (Diretor)", "Roberto Lima (Produtor)", "Carla Mendes (Figurinista)", "Lucas Dias (Ator coadjuvante)"],
                    armas: ["Cianureto no caf√©", "Sufocamento", "Golpe", "Veneno em maquiagem", "Empurr√£o da escada"],
                    motivos: ["Inveja - queria papel principal", "Romance proibido", "D√≠vida", "Chantagem", "Disputa art√≠stica"],
                    locais: ["Camarim principal", "Palco", "Bastidores", "Sala de figurinos", "Dep√≥sito"]
                }
            }
        ];

        console.log('‚úÖ 6 casos carregados');

        // ==================== FIREBASE CONFIG ==================== //
        const firebaseConfig = {
            apiKey: "AIzaSyBUavAk-f5nqe3x_xzI_ZLoU9oqoEzMCV4",
            authDomain: "fatto-criminal-7addf.firebaseapp.com",
            projectId: "fatto-criminal-7addf",
            storageBucket: "fatto-criminal-7addf.firebasestorage.app",
            messagingSenderId: "90391050719",
            appId: "1:90391050719:web:3712862c39cacb65e52c6a",
            measurementId: "G-8VJD43K4R6"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        console.log('üî• Firebase conectado com sucesso!');

        // ==================== FUN√á√ïES FIREBASE ==================== //
        function mostrarLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function esconderLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        async function salvarUsuarioFirebase(usuario) {
            try {
                mostrarLoading();
                await db.collection('usuarios').doc(usuario.email).set(usuario);
                console.log('‚úÖ Usu√°rio salvo no Firebase');
                esconderLoading();
            } catch (error) {
                console.error('‚ùå Erro ao salvar usu√°rio:', error);
                esconderLoading();
            }
        }

        async function buscarUsuarioFirebase(email) {
            try {
                mostrarLoading();
                const doc = await db.collection('usuarios').doc(email).get();
                esconderLoading();
                if (doc.exists) {
                    return doc.data();
                }
                return null;
            } catch (error) {
                console.error('‚ùå Erro ao buscar usu√°rio:', error);
                esconderLoading();
                return null;
            }
        }

        async function buscarTodosUsuariosFirebase() {
            try {
                const snapshot = await db.collection('usuarios').get();
                const usuarios = [];
                snapshot.forEach(doc => {
                    usuarios.push(doc.data());
                });
                return usuarios;
            } catch (error) {
                console.error('‚ùå Erro ao buscar usu√°rios:', error);
                return [];
            }
        }

        // ==================== ESTADO GLOBAL ==================== //
        let paginaAtual = 'home';
        let usuarioLogado = null;
        let carrinho = [];
        let casoSelecionado = null;
        let casoEmJogo = null;
        let timerInterval = null;
        let tempoDecorrido = 0;
        let subPaginaDetetive = 'casos';
        let versaoSelecionada = 'digital';
        let dadosOriginaisPerfil = null;

        // Carregar do localStorage
        if (localStorage.getItem('usuarioLogado')) {
            usuarioLogado = JSON.parse(localStorage.getItem('usuarioLogado'));
            atualizarHeader();
        }

        if (localStorage.getItem('carrinho')) {
            carrinho = JSON.parse(localStorage.getItem('carrinho'));
            atualizarCarrinhoBadge();
        }

        // ==================== FUN√á√ïES AUXILIARES ==================== //
        function salvarUsuarioLogado() {
            if (usuarioLogado) {
                localStorage.setItem('usuarioLogado', JSON.stringify(usuarioLogado));
                salvarUsuarioFirebase(usuarioLogado); // Salvar tamb√©m no Firebase
            } else {
                localStorage.removeItem('usuarioLogado');
            }
        }

        function salvarCarrinho() {
            localStorage.setItem('carrinho', JSON.stringify(carrinho));
        }

        function mostrarToast(texto, tipo = 'sucesso', duracao = 4000) {
            const toast = document.getElementById('toastMessage');
            toast.textContent = texto;
            toast.className = `toast toast-${tipo}`;
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, duracao);
        }

        function mostrarMissao(nomeCaso) {
            const toast = document.getElementById('toastMessage');
            toast.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 2.5rem; margin-bottom: 15px;">üéØ</div>
                    <div style="font-size: 1.4rem; margin-bottom: 15px; font-weight: 900;">NOVA MISS√ÉO ATRIBU√çDA</div>
                    <div style="line-height: 1.8;">
                        Detetive <strong>${usuarioLogado.nome}</strong>,<br>
                        Voc√™ foi designado para resolver o caso<br>
                        <strong>"${nomeCaso}"</strong><br><br>
                        Analise as evid√™ncias com cuidado.<br>
                        A verdade est√° esperando por voc√™.
                    </div>
                </div>
            `;
            toast.className = 'toast toast-missao';
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 7000);
        }

        function mostrarConquista(conquista) {
            const toast = document.getElementById('toastMessage');
            const emojis = {
                'Lupa de Ouro': 'ü•á',
                'Lupa de Prata': 'ü•à',
                'Lupa de Bronze': 'ü•â',
                'Ajudante de Honra': 'üéñÔ∏è',
                'Advertido Pelo Departamento': '‚ö†Ô∏è'
            };
            toast.innerHTML = `
                <div style="position: relative;">
                    <button onclick="document.getElementById('toastMessage').classList.add('hidden')" style="position: absolute; top: -10px; right: -10px; background: rgba(0,0,0,0.5); border: none; color: white; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; font-weight: 700;">√ó</button>
                    <div style="text-align: center;">
                        <div style="font-size: 3rem; margin-bottom: 10px;">${emojis[conquista] || 'üèÜ'}</div>
                        <div style="font-size: 1.8rem; font-weight: 900;">NOVA CONQUISTA!</div>
                        <div style="font-size: 1.3rem; margin-top: 10px;">${conquista}</div>
                    </div>
                </div>
            `;
            toast.className = 'toast toast-conquista';
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 5000);
        }

        function mostrarPromocao(patente) {
            const toast = document.getElementById('toastMessage');
            toast.innerHTML = `
                <div style="position: relative;">
                    <button onclick="document.getElementById('toastMessage').classList.add('hidden')" style="position: absolute; top: -10px; right: -10px; background: rgba(0,0,0,0.5); border: none; color: white; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; font-weight: 700;">√ó</button>
                    <div style="text-align: center;">
                        <div style="font-size: 3rem; margin-bottom: 10px;">‚≠ê</div>
                        <div style="font-size: 1.8rem; font-weight: 900;">PROMO√á√ÉO!</div>
                        <div style="font-size: 1.4rem; margin-top: 10px;">Voc√™ agora √©<br><strong>${patente}</strong></div>
                    </div>
                </div>
            `;
            toast.className = 'toast toast-conquista';
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 5000);
        }

        function mostrarSuccessOverlay(pontos, tag) {
            const overlay = document.getElementById('successOverlay');
            const text = document.getElementById('successText');
            
            text.innerHTML = `
                Voc√™ ganhou <strong>${pontos} pontos</strong>!<br>
                ${tag ? `<br>üèÜ <strong>${tag}</strong> desbloqueada!` : ''}
            `;
            
            overlay.classList.add('active');
            
            // Criar confetes
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = ['#FFD700', '#4CAF50', '#2196F3', '#E53935'][Math.floor(Math.random() * 4)];
                    confetti.style.animationDelay = Math.random() * 2 + 's';
                    overlay.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 50);
            }
        }

        function fecharSuccessOverlay() {
            const overlay = document.getElementById('successOverlay');
            overlay.classList.remove('active');
            navegarPara('ver-solucao', {casoJogo: casoEmJogo});
        }

        function formatarTempoCompleto(segundos) {
            const horas = Math.floor(segundos / 3600);
            const minutos = Math.floor((segundos % 3600) / 60);
            const segs = segundos % 60;
            return `${String(horas).padStart(2, '0')}:${String(minutos).padStart(2, '0')}:${String(segs).padStart(2, '0')}`;
        }

        function calcularPatente(casosResolvidos) {
            if (casosResolvidos === 0) return 'Detetive J√∫nior';
            if (casosResolvidos === 1) return 'Sargento';
            if (casosResolvidos >= 3 && casosResolvidos < 5) return 'Inspetor';
            if (casosResolvidos >= 5 && casosResolvidos < 10) return 'Inspetor-Chefe';
            if (casosResolvidos >= 10) return 'Lenda: Sherlock Holmes';
            return 'Detetive J√∫nior';
        }

        // ==================== NAVEGA√á√ÉO ==================== //
        function navegarPara(pagina, dados = null) {
            console.log(`üìç Navegando para: ${pagina}`);
            paginaAtual = pagina;
            if (dados) {
                if (dados.caso) casoSelecionado = dados.caso;
                if (dados.casoJogo) casoEmJogo = dados.casoJogo;
            }
            renderizarPagina();
            window.scrollTo(0, 0);
        }

        function mudarAba(aba) {
            subPaginaDetetive = aba;
            renderizarPagina();
        }

        function atualizarHeader() {
            if (usuarioLogado) {
                document.getElementById('btnLogin').classList.add('hidden');
                document.getElementById('btnAreaDetetive').classList.remove('hidden');
                document.getElementById('btnPerfil').classList.remove('hidden');
                document.getElementById('btnCarrinho').classList.remove('hidden');
                document.getElementById('btnSair').classList.remove('hidden');
            } else {
                document.getElementById('btnLogin').classList.remove('hidden');
                document.getElementById('btnAreaDetetive').classList.add('hidden');
                document.getElementById('btnPerfil').classList.add('hidden');
                document.getElementById('btnCarrinho').classList.add('hidden');
                document.getElementById('btnSair').classList.add('hidden');
            }
        }

        function atualizarCarrinhoBadge() {
            const badge = document.getElementById('cartBadge');
            if (carrinho.length > 0) {
                badge.textContent = carrinho.length;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        // ==================== LOGIN/CADASTRO ==================== //
        async function fazerLogin(email, senha) {
            const usuario = await buscarUsuarioFirebase(email);
            
            if (usuario && usuario.senha === senha) {
                usuarioLogado = usuario;
                localStorage.setItem('usuarioLogado', JSON.stringify(usuarioLogado));
                atualizarHeader();
                navegarPara('home');
                mostrarToast('Login realizado com sucesso!', 'sucesso');
            } else {
                mostrarToast('Email ou senha incorretos!', 'erro');
            }
        }

        async function fazerCadastro(nome, email, senha, telefone) {
            if (!nome || !email || !senha || !telefone) {
                mostrarToast('Preencha todos os campos!', 'erro');
                return;
            }
            
            // Verificar se email j√° existe
            const usuarioExistente = await buscarUsuarioFirebase(email);
            if (usuarioExistente) {
                mostrarToast('Email j√° cadastrado!', 'erro');
                return;
            }
            
            const novoUsuario = {
                id: Date.now(),
                nome: nome,
                email: email,
                senha: senha,
                telefone: telefone,
                pontos: 0,
                casosResolvidos: 0,
                casosComprados: [],
                conquistas: [],
                patente: 'Detetive J√∫nior'
            };
            
            await salvarUsuarioFirebase(novoUsuario);
            
            usuarioLogado = novoUsuario;
            localStorage.setItem('usuarioLogado', JSON.stringify(usuarioLogado));
            atualizarHeader();
            navegarPara('home');
            mostrarToast('Cadastro realizado!', 'sucesso');
        }

        function fazerLogout() {
            usuarioLogado = null;
            salvarUsuarioLogado();
            carrinho = [];
            salvarCarrinho();
            atualizarHeader();
            atualizarCarrinhoBadge();
            navegarPara('home');
            mostrarToast('At√© logo!', 'aviso');
        }

        function executarLogin() {
            const email = document.getElementById('emailLogin').value;
            const senha = document.getElementById('senhaLogin').value;
            fazerLogin(email, senha);
        }

        function executarCadastro() {
            const nome = document.getElementById('nomeCadastro').value;
            const email = document.getElementById('emailCadastro').value;
            const senha = document.getElementById('senhaCadastro').value;
            const telefone = document.getElementById('telefoneCadastro').value;
            fazerCadastro(nome, email, senha, telefone);
        }

        // ==================== CARRINHO ==================== //
        function adicionarAoCarrinho(caso, versao) {
            if (!usuarioLogado) {
                mostrarToast('Fa√ßa login primeiro!', 'erro');
                navegarPara('login');
                return;
            }
            
            const itemExiste = carrinho.find(item => item.casoId === caso.id && item.versao === versao);
            if (itemExiste) {
                mostrarToast('J√° est√° no carrinho!', 'aviso');
                return;
            }
            
            carrinho.push({
                id: Date.now(),
                casoId: caso.id,
                titulo: caso.titulo,
                versao: versao,
                preco: versao === 'digital' ? caso.precoDigital : caso.precoFisico,
                caso: caso
            });
            
            salvarCarrinho();
            atualizarCarrinhoBadge();
            mostrarToast('Caso adicionado ao carrinho!', 'sucesso');
        }

        function removerDoCarrinho(itemId) {
            carrinho = carrinho.filter(item => item.id !== itemId);
            salvarCarrinho();
            atualizarCarrinhoBadge();
            renderizarPagina();
            mostrarToast('Item removido', 'aviso');
        }

        function finalizarCompra() {
            if (!usuarioLogado) {
                navegarPara('login');
                return;
            }

            const novosCasos = carrinho.map(item => ({
                ...item.caso,
                versao: item.versao,
                dataCompra: new Date().toISOString(),
                iniciado: false,
                tentativas: 0,
                resolvido: false,
                tempoAcumulado: 0
            }));

            // Adiciona 100 pontos por compra
            const pontosCompra = carrinho.length * 100;
            usuarioLogado.pontos += pontosCompra;
            
            usuarioLogado.casosComprados = [...(usuarioLogado.casosComprados || []), ...novosCasos];
            salvarUsuarioLogado();

            // Mostrar miss√£o para cada caso
            novosCasos.forEach((caso, index) => {
                setTimeout(() => {
                    mostrarMissao(caso.titulo);
                }, index * 7500);
            });

            carrinho = [];
            salvarCarrinho();
            atualizarCarrinhoBadge();

            mostrarToast(`Compra realizada! +${pontosCompra} pontos`, 'sucesso');
            
            setTimeout(() => {
                navegarPara('area-detetive');
            }, 2000);
        }

        function selecionarVersao(versao) {
            versaoSelecionada = versao;
            const digital = document.getElementById('versaoDigital');
            const fisica = document.getElementById('versaoFisica');
            
            if (versao === 'digital') {
                digital.style.border = '3px solid var(--amarelo)';
                digital.style.background = 'rgba(255, 215, 0, 0.1)';
                fisica.style.border = '2px solid var(--cinza-medio)';
                fisica.style.background = 'var(--branco)';
            } else {
                fisica.style.border = '3px solid var(--amarelo)';
                fisica.style.background = 'rgba(255, 215, 0, 0.1)';
                digital.style.border = '2px solid var(--cinza-medio)';
                digital.style.background = 'var(--branco)';
            }
        }

        function adicionarCasoAoCarrinho() {
            adicionarAoCarrinho(casoSelecionado, versaoSelecionada);
        }

        // ==================== PERFIL ==================== //
        function salvarPerfil() {
            const novoNome = document.getElementById('perfilNome').value;
            const novaSenha = document.getElementById('perfilSenha').value;
            
            if (!novoNome) {
                mostrarToast('Nome n√£o pode estar vazio!', 'erro');
                return;
            }
            
            usuarioLogado.nome = novoNome;
            if (novaSenha) {
                usuarioLogado.senha = novaSenha;
            }
            
            salvarUsuarioLogado();
            dadosOriginaisPerfil = {nome: novoNome, senha: novaSenha};
            mostrarToast('Perfil atualizado!', 'sucesso');
        }

        function cancelarEdicaoPerfil() {
            if (dadosOriginaisPerfil) {
                document.getElementById('perfilNome').value = dadosOriginaisPerfil.nome;
                document.getElementById('perfilSenha').value = '';
            }
            mostrarToast('Altera√ß√µes canceladas', 'aviso');
        }

        // ==================== JOGAR CASO ==================== //
        function iniciarCaso(caso) {
            const index = usuarioLogado.casosComprados.findIndex(c => c.id === caso.id);
            if (index !== -1) {
                usuarioLogado.casosComprados[index].iniciado = true;
                usuarioLogado.casosComprados[index].tempoInicio = Date.now();
                salvarUsuarioLogado();
            }
        }

        function jogarCaso(caso) {
            casoEmJogo = caso;
            tempoDecorrido = caso.tempoAcumulado || 0;
            
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                tempoDecorrido++;
                const timerEl = document.getElementById('timer');
                if (timerEl) {
                    timerEl.textContent = formatarTempoCompleto(tempoDecorrido);
                }
            }, 1000);
            
            navegarPara('jogar-caso', {casoJogo: caso});
        }

        function validarResposta() {
            const assassino = document.getElementById('selectAssassino').value;
            const arma = document.getElementById('selectArma').value;
            const motivo = document.getElementById('selectMotivo').value;
            const local = document.getElementById('selectLocal').value;

            if (!assassino || !arma || !motivo || !local) {
                mostrarToast('Preencha todos os campos!', 'erro');
                return;
            }

            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }

            const tentativasAtuais = (casoEmJogo.tentativas || 0) + 1;
            const acertou = 
                assassino === casoEmJogo.solucao.assassino &&
                arma === casoEmJogo.solucao.arma &&
                motivo === casoEmJogo.solucao.motivo &&
                local === casoEmJogo.solucao.local;

            const index = usuarioLogado.casosComprados.findIndex(c => c.id === casoEmJogo.id);
            
            if (acertou) {
                // Sistema de pontua√ß√£o
                const pontosPorTentativa = {1: 500, 2: 400, 3: 300, 4: 200, 5: 100};
                let pontosGanhos = pontosPorTentativa[tentativasAtuais] || 50;
                
                // B√¥nus de tempo (tags)
                const tempoLimite = casoEmJogo.tempoLimite * 60;
                let tagGanha = null;
                let bonusTempo = 0;
                
                if (tempoDecorrido < tempoLimite) {
                    const tagsMap = {
                        1: {nome: 'Lupa de Ouro', bonus: 150},
                        2: {nome: 'Lupa de Prata', bonus: 120},
                        3: {nome: 'Lupa de Bronze', bonus: 100},
                        4: {nome: 'Ajudante de Honra', bonus: 90},
                        5: {nome: 'Advertido Pelo Departamento', bonus: 70}
                    };
                    
                    if (tagsMap[tentativasAtuais]) {
                        tagGanha = tagsMap[tentativasAtuais].nome;
                        bonusTempo = tagsMap[tentativasAtuais].bonus;
                        pontosGanhos += bonusTempo;
                        
                        // CORRIGIDO: Adicionar √† lista de conquistas
                        if (!usuarioLogado.conquistas) {
                            usuarioLogado.conquistas = [];
                        }
                        if (!usuarioLogado.conquistas.includes(tagGanha)) {
                            usuarioLogado.conquistas.push(tagGanha);
                            setTimeout(() => mostrarConquista(tagGanha), 1000);
                        }
                    }
                }

                usuarioLogado.casosComprados[index].resolvido = true;
                usuarioLogado.casosComprados[index].tentativas = tentativasAtuais;
                usuarioLogado.casosComprados[index].tempoTotal = tempoDecorrido;
                usuarioLogado.casosComprados[index].pontosGanhos = pontosGanhos;
                usuarioLogado.casosComprados[index].tagGanha = tagGanha;
                
                const patenteAnterior = usuarioLogado.patente;
                usuarioLogado.casosResolvidos++;
                usuarioLogado.pontos += pontosGanhos;
                
                // Promo√ß√µes de patente
                usuarioLogado.patente = calcularPatente(usuarioLogado.casosResolvidos);
                
                if (patenteAnterior !== usuarioLogado.patente) {
                    const bonusPatente = {
                        'Sargento': 200,
                        'Inspetor': 250,
                        'Inspetor-Chefe': 300,
                        'Lenda: Sherlock Holmes': 500
                    };
                    const bonus = bonusPatente[usuarioLogado.patente] || 0;
                    usuarioLogado.pontos += bonus;
                    setTimeout(() => mostrarPromocao(usuarioLogado.patente), 2000);
                }
                
                salvarUsuarioLogado();
                
                // IMPORTANTE: Atualizar casoEmJogo com os dados mais recentes
                casoEmJogo = JSON.parse(JSON.stringify(usuarioLogado.casosComprados[index]));
                
                // Mostrar overlay de sucesso
                mostrarSuccessOverlay(pontosGanhos, tagGanha);
                
            } else {
                if (tentativasAtuais >= 5) {
                    usuarioLogado.casosComprados[index].naoSolucionado = true;
                    usuarioLogado.casosComprados[index].tentativas = tentativasAtuais;
                    usuarioLogado.pontos -= 50;
                    salvarUsuarioLogado();
                    
                    mostrarToast('Caso n√£o solucionado - 50 pontos', 'erro', 5000);
                    
                    setTimeout(() => navegarPara('area-detetive'), 3000);
                } else {
                    usuarioLogado.casosComprados[index].tentativas = tentativasAtuais;
                    usuarioLogado.casosComprados[index].tempoAcumulado = tempoDecorrido;
                    salvarUsuarioLogado();
                    
                    casoEmJogo = usuarioLogado.casosComprados[index];
                    
                    // Mensagem com dica
                    const toast = document.getElementById('toastMessage');
                    toast.innerHTML = `
                        <div style="text-align: center; line-height: 1.8;">
                            <div style="font-size: 2rem; margin-bottom: 10px;">‚ùå</div>
                            <div style="font-size: 1.3rem; margin-bottom: 15px; font-weight: 900;">CASO N√ÉO SOLUCIONADO</div>
                            <div style="font-size: 1rem;">
                                Tentativa ${tentativasAtuais}/5<br><br>
                                Revise as provas e depoimentos.<br>
                                Tire d√∫vidas com o Delegado Virtual.
                            </div>
                        </div>
                    `;
                    toast.className = 'toast toast-erro';
                    toast.classList.remove('hidden');
                    
                    setTimeout(() => {
                        toast.classList.add('hidden');
                    }, 6000);
                    
                    document.getElementById('selectAssassino').value = '';
                    document.getElementById('selectArma').value = '';
                    document.getElementById('selectMotivo').value = '';
                    document.getElementById('selectLocal').value = '';
                    document.getElementById('modalFormulario').classList.remove('active');
                    
                    if (timerInterval) clearInterval(timerInterval);
                    timerInterval = setInterval(() => {
                        tempoDecorrido++;
                        const timerEl = document.getElementById('timer');
                        if (timerEl) {
                            timerEl.textContent = formatarTempoCompleto(tempoDecorrido);
                        }
                    }, 1000);
                }
            }
        }

        // ==================== RENDERIZA√á√ÉO ==================== //
        function renderizarPagina() {
            console.log(`üé¨ Renderizando: ${paginaAtual}`);
            const content = document.getElementById('app-content');
            
            if (timerInterval && paginaAtual !== 'jogar-caso') {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            switch(paginaAtual) {
                case 'home':
                    content.innerHTML = renderHome();
                    break;
                case 'login':
                    content.innerHTML = renderLogin();
                    break;
                case 'cadastro':
                    content.innerHTML = renderCadastro();
                    break;
                case 'casos':
                    content.innerHTML = renderCasos();
                    break;
                case 'caso-detalhe':
                    content.innerHTML = renderCasoDetalhe();
                    break;
                case 'carrinho':
                    content.innerHTML = renderCarrinho();
                    break;
                case 'checkout':
                    content.innerHTML = renderCheckout();
                    break;
                case 'area-detetive':
                    content.innerHTML = renderAreaDetetive();
                    break;
                case 'perfil':
                    content.innerHTML = renderPerfil();
                    break;
                case 'ajuda':
                    content.innerHTML = renderAjuda();
                    break;
                case 'jogar-caso':
                    content.innerHTML = renderJogarCaso();
                    break;
                case 'ver-solucao':
                    content.innerHTML = renderVerSolucao();
                    break;
                case 'ranking':
                    content.innerHTML = renderRanking();
                    break;
                default:
                    content.innerHTML = renderHome();
            }
        }

        function renderHome() {
            return `
                <section class="hero">
                    <div class="hero-content">
                        <img src="FATTO_PRETO.png" alt="FATTO CRIMINAL" class="hero-logo-big">
                        <p class="hero-slogan">Jogos de Mist√©rio e Investiga√ß√£o</p>
                        <div class="hero-buttons">
                            <button class="btn-primary" onclick="navegarPara('casos')">
                                Ver Casos
                            </button>
                            <button class="btn-secondary" onclick="navegarPara('${usuarioLogado ? 'area-detetive' : 'login'}')">
                                Minha √Årea
                            </button>
                        </div>
                    </div>
                </section>

                <section class="section section-alt">
                    <h2 class="section-title">Casos em Destaque</h2>
                    <p class="section-subtitle">Os mist√©rios mais desafiadores</p>
                    <div class="casos-grid">
                        ${casos.filter(c => c.destaque).map(caso => `
                            <div class="case-card" onclick='navegarPara("caso-detalhe", {caso: ${JSON.stringify(caso).replace(/'/g, "\\'")}})'>
                                <img src="${caso.banner}" alt="${caso.titulo}" class="case-banner" />
                                <div class="case-content">
                                    <h3 class="case-title">${caso.titulo}</h3>
                                    <p class="case-subtitle">${caso.subtitulo}</p>
                                    <div class="case-tags">
                                        <span class="case-tag">
                                            <span class="case-tag-icon ${caso.nivelCor}">‚ö°</span>
                                            ${caso.dificuldade}
                                        </span>
                                        <span class="case-tag">üïê ${caso.tempoLimite}min</span>
                                        <span class="case-tag">üéØ ${caso.classificacao}</span>
                                        <span class="case-tag">üë• ${caso.jogadores}</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 25px; padding-top: 25px; border-top: 1px solid var(--cinza-medio);">
                                        <div class="case-price">R$ ${caso.precoDigital.toFixed(2)}</div>
                                        <button class="btn-primary" style="padding: 12px 28px;" onclick='event.stopPropagation(); navegarPara("caso-detalhe", {caso: ${JSON.stringify(caso).replace(/'/g, "\\'")}})'>
                                            Ver caso
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div style="text-align: center; margin-top: 60px;">
                        <button class="btn-primary" onclick="navegarPara('casos')" style="padding: 18px 50px; font-size: 1.1rem;">
                            Ver Todos os Casos
                        </button>
                    </div>
                </section>

                <section class="section">
                    <h2 class="section-title">Como Funciona?</h2>
                    <p class="section-subtitle">Entenda as etapas para desvendar um crime</p>
                    <div style="max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 50px; margin-top: 60px;">
                        ${[
                            {emoji: 'üîç', titulo: 'Explore as Provas', desc: 'Tenha acesso a arquivos confidenciais, laudos t√©cnicos e evid√™ncias. Cada item √© uma pe√ßa-chave no quebra-cabe√ßa.'},
                            {emoji: 'üåê', titulo: 'V√° Al√©m do B√°sico', desc: 'Algumas pistas est√£o escondidas em fontes digitais externas. Analise tudo com aten√ß√£o e conecte os pontos.'},
                            {emoji: 'üéØ', titulo: 'Monte sua Teoria', desc: 'Com a dedu√ß√£o final em m√£os, apresente-a para o nosso Delegado Virtual e verifique se voc√™ acertou.'}
                        ].map(item => `
                            <div style="text-align: center; padding: 40px 20px;">
                                <div style="font-size: 4rem; margin-bottom: 25px;">${item.emoji}</div>
                                <h3 style="font-family: Montserrat; font-size: 1.6rem; color: var(--preto); margin-bottom: 20px; font-weight: 700;">${item.titulo}</h3>
                                <p style="color: #666; line-height: 1.8; font-size: 1.05rem;">${item.desc}</p>
                            </div>
                        `).join('')}
                    </div>
                </section>
            `;
        }

        function renderLogin() {
            return `
                <div class="page-content" style="min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 140px 40px 80px;">
                    <div style="background: var(--branco); border-radius: 12px; padding: 60px; max-width: 500px; width: 100%; box-shadow: 0 10px 40px rgba(0,0,0,0.1);">
                        <h2 style="font-family: Montserrat; color: var(--preto); font-size: 2.5rem; text-align: center; margin-bottom: 50px; font-weight: 700;">Login</h2>
                        
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" id="emailLogin" placeholder="seu@email.com" />
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Senha</label>
                            <input type="password" id="senhaLogin" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeypress="if(event.key === 'Enter') executarLogin()" />
                        </div>
                        
                        <button class="btn-primary" style="width: 100%; margin-top: 30px;" onclick="executarLogin()">
                            Entrar
                        </button>
                        
                        <p style="text-align: center; margin-top: 30px; color: #666; cursor: pointer;" onclick="navegarPara('cadastro')">
                            N√£o tem conta? <strong style="color: var(--preto);">Cadastre-se aqui</strong>
                        </p>
                    </div>
                </div>
            `;
        }

        function renderCadastro() {
            return `
                <div class="page-content" style="min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 140px 40px 80px;">
                    <div style="background: var(--branco); border-radius: 12px; padding: 60px; max-width: 500px; width: 100%; box-shadow: 0 10px 40px rgba(0,0,0,0.1);">
                        <h2 style="font-family: Montserrat; color: var(--preto); font-size: 2.5rem; text-align: center; margin-bottom: 50px; font-weight: 700;">Cadastro</h2>
                        
                        <div class="form-group">
                            <label class="form-label">Nome Completo</label>
                            <input type="text" id="nomeCadastro" placeholder="Seu nome" />
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" id="emailCadastro" placeholder="seu@email.com" />
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Telefone</label>
                            <input type="tel" id="telefoneCadastro" placeholder="(00) 00000-0000" />
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Senha</label>
                            <input type="password" id="senhaCadastro" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeypress="if(event.key === 'Enter') executarCadastro()" />
                        </div>
                        
                        <button class="btn-primary" style="width: 100%;" onclick="executarCadastro()">
                            Cadastrar
                        </button>
                        
                        <p style="text-align: center; margin-top: 30px; color: #666; cursor: pointer;" onclick="navegarPara('login')">
                            J√° tem conta? <strong style="color: var(--preto);">Fa√ßa login</strong>
                        </p>
                    </div>
                </div>
            `;
        }

        function renderCasos() {
            return `
                <section class="section page-content">
                    <h2 class="section-title">Todos os Casos</h2>
                    <p class="section-subtitle">6 mist√©rios para desvendar</p>

                    <div class="casos-grid" style="margin-top: 60px;">
                        ${casos.map(caso => `
                            <div class="case-card" onclick='navegarPara("caso-detalhe", {caso: ${JSON.stringify(caso).replace(/'/g, "\\'")}})'>
                                <img src="${caso.banner}" alt="${caso.titulo}" class="case-banner" />
                                <div class="case-content">
                                    <h3 class="case-title">${caso.titulo}</h3>
                                    <p class="case-subtitle">${caso.subtitulo}</p>
                                    <div class="case-tags">
                                        <span class="case-tag">
                                            <span class="case-tag-icon ${caso.nivelCor}">‚ö°</span>
                                            ${caso.dificuldade}
                                        </span>
                                        <span class="case-tag">üïê ${caso.tempoLimite}min</span>
                                        <span class="case-tag">üéØ ${caso.classificacao}</span>
                                        <span class="case-tag">üë• ${caso.jogadores}</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 25px; padding-top: 25px; border-top: 1px solid var(--cinza-medio);">
                                        <div class="case-price">R$ ${caso.precoDigital.toFixed(2)}</div>
                                        <button class="btn-primary" style="padding: 12px 28px;" onclick='event.stopPropagation(); navegarPara("caso-detalhe", {caso: ${JSON.stringify(caso).replace(/'/g, "\\'")}})'>Ver caso</button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </section>
            `;
        }

        function renderCasoDetalhe() {
            if (!casoSelecionado) {
                navegarPara('casos');
                return '';
            }

            return `
                <div class="page-content">
                    <div style="background: var(--cinza-claro); padding: 100px 40px 80px; text-align: center;">
                        <div style="max-width: 1000px; margin: 0 auto;">
                            <div style="display: inline-block; background: var(--amarelo); color: var(--preto); padding: 8px 20px; border-radius: 20px; font-weight: 700; font-size: 0.9rem; margin-bottom: 25px;">${casoSelecionado.numero}</div>
                            <h1 style="font-family: Montserrat; font-size: 3.5rem; color: var(--preto); margin-bottom: 20px; font-weight: 700;">${casoSelecionado.titulo}</h1>
                            <p style="font-size: 1.5rem; color: #666;">${casoSelecionado.subtitulo}</p>
                        </div>
                    </div>

                    <section class="section">
                        <div style="max-width: 1200px; margin: 0 auto;">
                            <div style="background: var(--branco); border-radius: 12px; padding: 50px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin-bottom: 40px;">
                                <h3 style="font-family: Montserrat; color: var(--preto); font-size: 2rem; margin-bottom: 30px; font-weight: 700;">
                                    Informa√ß√µes do Caso
                                </h3>

                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px;">
                                    ${[
                                        {label: 'Dificuldade', value: casoSelecionado.dificuldade, emoji: '‚ö°'},
                                        {label: 'Tempo Limite', value: `${casoSelecionado.tempoLimite}min`, emoji: 'üïê'},
                                        {label: 'Classifica√ß√£o', value: casoSelecionado.classificacao, emoji: 'üéØ'},
                                        {label: 'Jogadores', value: casoSelecionado.jogadores, emoji: 'üë•'}
                                    ].map(info => `
                                        <div style="text-align: center; padding: 25px; background: var(--cinza-claro); border-radius: 8px;">
                                            <div style="font-size: 2rem; margin-bottom: 10px;">${info.emoji}</div>
                                            <div style="color: #666; margin-bottom: 8px; font-size: 0.9rem;">${info.label}</div>
                                            <div style="color: var(--preto); font-size: 1.3rem; font-weight: 700; font-family: Montserrat;">${info.value}</div>
                                        </div>
                                    `).join('')}
                                </div>

                                <h4 style="font-family: Montserrat; color: var(--preto); font-size: 1.8rem; margin-bottom: 20px; font-weight: 700;">Resumo</h4>
                                <p style="color: #666; line-height: 2; font-size: 1.1rem; margin-bottom: 40px;">${casoSelecionado.resumo}</p>

                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-bottom: 50px;">
                                    <div id="versaoDigital" style="border: 3px solid var(--amarelo); border-radius: 12px; padding: 40px; cursor: pointer; background: rgba(255, 215, 0, 0.1); text-align: center; transition: all 0.3s;" onclick="selecionarVersao('digital')">
                                        <div style="font-size: 3rem; margin-bottom: 15px;">üì±</div>
                                        <h4 style="font-family: Montserrat; color: var(--preto); font-size: 1.8rem; margin-bottom: 10px; font-weight: 700;">Digital</h4>
                                        <p style="color: #666; margin-bottom: 20px;">Receba por email</p>
                                        <div style="font-family: Montserrat; font-size: 3rem; color: var(--preto); font-weight: 700;">R$ ${casoSelecionado.precoDigital.toFixed(2)}</div>
                                    </div>

                                    <div id="versaoFisica" style="border: 2px solid var(--cinza-medio); border-radius: 12px; padding: 40px; cursor: pointer; background: var(--branco); text-align: center; transition: all 0.3s;" onclick="selecionarVersao('fisica')">
                                        <div style="font-size: 3rem; margin-bottom: 15px;">üì¶</div>
                                        <h4 style="font-family: Montserrat; color: var(--preto); font-size: 1.8rem; margin-bottom: 10px; font-weight: 700;">F√≠sica</h4>
                                        <p style="color: #666; margin-bottom: 20px;">Receba em casa</p>
                                        <div style="font-family: Montserrat; font-size: 3rem; color: var(--preto); font-weight: 700;">R$ ${casoSelecionado.precoFisico.toFixed(2)}</div>
                                    </div>
                                </div>

                                <button class="btn-primary" style="width: 100%; font-size: 1.3rem; padding: 22px;" onclick="adicionarCasoAoCarrinho()">
                                    Adicionar ao Carrinho
                                </button>
                            </div>
                        </div>
                    </section>
                </div>
            `;
        }

        function renderCarrinho() {
            if (carrinho.length === 0) {
                return `
                    <section class="section page-content" style="min-height: 100vh;">
                        <h2 class="section-title">Carrinho</h2>
                        <div style="text-align: center; padding: 100px 40px;">
                            <div style="font-size: 6rem; margin-bottom: 30px;">üõí</div>
                            <p style="font-size: 1.8rem; color: #666; margin-bottom: 40px;">Carrinho vazio</p>
                            <button class="btn-primary" onclick="navegarPara('casos')">
                                Ver Casos
                            </button>
                        </div>
                    </section>
                `;
            }

            const total = carrinho.reduce((sum, item) => sum + item.preco, 0);

            return `
                <section class="section page-content" style="min-height: 100vh;">
                    <h2 class="section-title">Meu Carrinho</h2>
                    <div style="max-width: 1000px; margin: 60px auto 0;">
                        ${carrinho.map(item => `
                            <div style="background: var(--branco); border-radius: 12px; padding: 30px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.08);">
                                <div style="flex: 1;">
                                    <h3 style="font-family: Montserrat; color: var(--preto); font-size: 1.8rem; margin-bottom: 8px; font-weight: 700;">${item.titulo}</h3>
                                    <p style="color: #666; font-size: 1.1rem;">Vers√£o: ${item.versao === 'digital' ? 'Digital üì±' : 'F√≠sica üì¶'}</p>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-family: Montserrat; font-size: 2.5rem; color: var(--preto); margin-bottom: 15px; font-weight: 700;">
                                        R$ ${item.preco.toFixed(2)}
                                    </div>
                                    <button class="btn-secondary" style="padding: 10px 20px;" onclick="removerDoCarrinho(${item.id})">
                                        Remover
                                    </button>
                                </div>
                            </div>
                        `).join('')}

                        <div style="background: var(--cinza-claro); border-radius: 12px; padding: 40px; margin-top: 30px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <h3 style="font-family: Montserrat; color: var(--preto); font-size: 2.5rem; font-weight: 700;">Total</h3>
                                <div style="font-family: Montserrat; font-size: 4rem; color: var(--preto); font-weight: 700;">
                                    R$ ${total.toFixed(2)}
                                </div>
                            </div>
                            <button class="btn-primary" style="width: 100%; margin-top: 30px; font-size: 1.5rem; padding: 20px;" onclick="navegarPara('checkout')">
                                Finalizar Compra
                            </button>
                        </div>
                    </div>
                </section>
            `;
        }

        function renderCheckout() {
            const total = carrinho.reduce((sum, item) => sum + item.preco, 0);

            return `
                <section class="section page-content" style="min-height: 100vh;">
                    <h2 class="section-title">Checkout</h2>
                    <div style="max-width: 800px; margin: 60px auto 0;">
                        <div style="background: var(--branco); border-radius: 12px; padding: 50px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
                            <h3 style="font-family: Montserrat; color: var(--preto); font-size: 2.5rem; margin-bottom: 40px; text-align: center; font-weight: 700;">
                                Pagamento (Simulado)
                            </h3>
                            
                            <div style="text-align: center; margin-bottom: 40px;">
                                <img src="https://http2.mlstatic.com/storage/logos-api-admin/51b446b0-571c-11e8-9a2d-4b2bd7b1bf77-xl@2x.png" alt="Mercado Pago" style="max-width: 180px;">
                            </div>
                            
                            <p style="font-family: Montserrat; color: var(--preto); font-size: 3.5rem; margin-bottom: 50px; text-align: center; font-weight: 700;">
                                R$ ${total.toFixed(2)}
                            </p>
                            
                            <p style="text-align: center; color: #666; margin-bottom: 40px; font-size: 1rem; line-height: 1.8;">
                                üí≥ Este √© um checkout <strong>SIMULADO</strong> para testes<br>
                                Nenhuma cobran√ßa real ser√° efetuada
                            </p>
                            
                            <button class="btn-primary" style="width: 100%; font-size: 1.5rem; padding: 20px;" onclick="finalizarCompra()">
                                Confirmar Pagamento
                            </button>
                        </div>
                    </div>
                </section>
            `;
        }

        function renderAreaDetetive() {
            if (!usuarioLogado) {
                navegarPara('login');
                return '';
            }

            let conteudoAba = '';

            if (subPaginaDetetive === 'casos') {
                if (!usuarioLogado.casosComprados || usuarioLogado.casosComprados.length === 0) {
                    conteudoAba = `
                        <div style="text-align: center; padding: 100px 40px;">
                            <div style="font-size: 6rem; margin-bottom: 30px;">üìÅ</div>
                            <p style="font-size: 1.8rem; color: #666; margin-bottom: 40px;">Nenhum caso adquirido</p>
                            <button class="btn-primary" onclick="navegarPara('casos')">
                                Comprar Casos
                            </button>
                        </div>
                    `;
                } else {
                    conteudoAba = `
                        <div class="casos-grid">
                            ${usuarioLogado.casosComprados.map(caso => `
                                <div class="case-card">
                                    <img src="${caso.banner}" alt="${caso.titulo}" style="width: 100%; height: 220px; object-fit: cover;" />
                                    <div style="padding: 30px;">
                                        <h3 style="font-family: Montserrat; font-size: 1.6rem; color: var(--preto); margin-bottom: 15px; font-weight: 700;">${caso.titulo}</h3>
                                        
                                        ${caso.resolvido ? `
                                            <div style="background: rgba(76, 175, 80, 0.1); border: 2px solid var(--verde); border-radius: 8px; padding: 20px; margin-bottom: 20px; text-align: center;">
                                                <div style="color: var(--verde); font-size: 2rem; margin-bottom: 8px;">‚úÖ</div>
                                                <div style="color: var(--verde); font-weight: 700; font-family: Montserrat; font-size: 1.3rem; margin-bottom: 5px;">RESOLVIDO!</div>
                                                <div style="color: var(--verde); font-size: 0.95rem;">+${caso.pontosGanhos || 0} pontos${caso.tagGanha ? ' + ' + caso.tagGanha : ''}</div>
                                            </div>
                                        ` : caso.naoSolucionado ? `
                                            <div style="background: rgba(229, 57, 53, 0.1); border: 2px solid var(--vermelho); border-radius: 8px; padding: 20px; margin-bottom: 20px; text-align: center;">
                                                <div style="color: var(--vermelho); font-size: 2rem; margin-bottom: 8px;">‚ùå</div>
                                                <div style="color: var(--vermelho); font-weight: 700; font-family: Montserrat; font-size: 1.3rem; margin-bottom: 5px;">N√ÉO SOLUCIONADO</div>
                                                <div style="color: var(--vermelho); font-size: 0.95rem;">5/5 tentativas</div>
                                            </div>
                                        ` : caso.iniciado ? `
                                            <div style="background: rgba(255, 215, 0, 0.1); border: 2px solid var(--amarelo); border-radius: 8px; padding: 20px; margin-bottom: 20px; text-align: center;">
                                                <div style="color: var(--preto); font-weight: 700; font-family: Montserrat; font-size: 1.2rem; margin-bottom: 5px;">EM ANDAMENTO</div>
                                                <div style="color: #666; font-size: 0.95rem;">Tentativas: ${caso.tentativas || 0}/5</div>
                                            </div>
                                        ` : ''}

                                        <button class="btn-primary" style="width: 100%; padding: 14px; font-size: 1.1rem;" onclick='${caso.resolvido || caso.naoSolucionado ? `navegarPara("ver-solucao", {casoJogo: ${JSON.stringify(caso).replace(/'/g, "\\'")}})` : `iniciarCaso(${JSON.stringify(caso).replace(/'/g, "\\'")}); jogarCaso(${JSON.stringify(caso).replace(/'/g, "\\'")})` }'>
                                            ${caso.resolvido ? 'Ver Solu√ß√£o' : caso.naoSolucionado ? 'Ver Solu√ß√£o' : caso.iniciado ? 'Continuar' : 'Iniciar'}
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
            } else if (subPaginaDetetive === 'patentes') {
                conteudoAba = `
                    <div style="text-align: center; margin-bottom: 60px;">
                        <div style="display: inline-block; background: rgba(255, 215, 0, 0.1); border: 3px solid var(--amarelo); border-radius: 12px; padding: 30px 60px;">
                            <h3 style="font-family: Montserrat; font-size: 3rem; color: var(--preto); font-weight: 700;">${usuarioLogado.patente}</h3>
                        </div>
                    </div>

                    <h3 style="font-family: Montserrat; color: var(--preto); font-size: 2.5rem; margin-bottom: 50px; text-align: center; font-weight: 700;">
                        Promo√ß√µes de Patente
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 30px;">
                        ${[
                            {nome: 'Detetive J√∫nior', desc: 'Inicial', desbloqueada: true, bonus: '+0 pts'},
                            {nome: 'Sargento', desc: '1 caso resolvido', desbloqueada: usuarioLogado.casosResolvidos >= 1, bonus: '+200 pts'},
                            {nome: 'Inspetor', desc: '3 casos resolvidos', desbloqueada: usuarioLogado.casosResolvidos >= 3, bonus: '+250 pts'},
                            {nome: 'Inspetor-Chefe', desc: '5 casos resolvidos', desbloqueada: usuarioLogado.casosResolvidos >= 5, bonus: '+300 pts'},
                            {nome: 'Lenda: Sherlock Holmes', desc: '10 casos', desbloqueada: usuarioLogado.casosResolvidos >= 10, bonus: '+500 pts'}
                        ].map(patente => `
                            <div style="background: var(--branco); border: 2px solid ${patente.desbloqueada ? 'var(--amarelo)' : 'var(--cinza-medio)'}; border-radius: 12px; padding: 30px; text-align: center; ${patente.desbloqueada ? '' : 'opacity: 0.5;'}">
                                ${!patente.desbloqueada ? '<div style="font-size: 2.5rem; margin-bottom: 10px;">üîí</div>' : '<div style="font-size: 2.5rem; margin-bottom: 10px;">üéñÔ∏è</div>'}
                                <div style="font-family: Montserrat; color: var(--preto); font-weight: 700; margin-bottom: 10px; font-size: 1.3rem;">
                                    ${patente.nome}
                                </div>
                                <div style="color: #666; font-size: 0.95rem; margin-bottom: 10px;">${patente.desc}</div>
                                <div style="color: var(--preto); font-weight: 600; font-size: 0.9rem;">${patente.bonus}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else if (subPaginaDetetive === 'conquistas') {
                conteudoAba = `
                    <h3 style="font-family: Montserrat; color: var(--preto); font-size: 2.5rem; margin-bottom: 50px; text-align: center; font-weight: 700;">
                        Conquistas de Desempenho
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 30px;">
                        ${[
                            {id: 'Lupa de Ouro', nome: 'Lupa de Ouro', desc: '1¬™ tentativa + tempo', emoji: 'ü•á'},
                            {id: 'Lupa de Prata', nome: 'Lupa de Prata', desc: '2¬™ tentativa + tempo', emoji: 'ü•à'},
                            {id: 'Lupa de Bronze', nome: 'Lupa de Bronze', desc: '3¬™ tentativa + tempo', emoji: 'ü•â'},
                            {id: 'Ajudante de Honra', nome: 'Ajudante de Honra', desc: '4¬™ tentativa + tempo', emoji: 'üéñÔ∏è'},
                            {id: 'Advertido Pelo Departamento', nome: 'Advertido', desc: '5¬™ tentativa + tempo', emoji: '‚ö†Ô∏è'}
                        ].map(conquista => {
                            const desbloqueada = usuarioLogado.conquistas?.includes(conquista.id);
                            return `
                                <div style="background: var(--branco); border: 2px solid ${desbloqueada ? 'var(--amarelo)' : 'var(--cinza-medio)'}; border-radius: 12px; padding: 30px; text-align: center; ${desbloqueada ? '' : 'opacity: 0.5;'}">
                                    ${!desbloqueada ? '<div style="font-size: 2.5rem; margin-bottom: 10px;">üîí</div>' : `<div style="font-size: 3rem; margin-bottom: 10px;">${conquista.emoji}</div>`}
                                    <div style="font-family: Montserrat; color: var(--preto); font-weight: 700; margin-bottom: 10px; font-size: 1.3rem;">
                                        ${conquista.nome}
                                    </div>
                                    <div style="color: #666; font-size: 0.95rem;">${conquista.desc}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            } else if (subPaginaDetetive === 'resumo') {
                conteudoAba = `
                    <div style="max-width: 900px; margin: 0 auto;">
                        <div style="background: var(--branco); border-radius: 12px; padding: 50px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
                            <h3 style="font-family: Montserrat; color: var(--preto); font-size: 2.5rem; margin-bottom: 40px; text-align: center; font-weight: 700;">
                                Ficha do Detetive
                            </h3>

                            <div style="background: var(--cinza-claro); padding: 30px; margin-bottom: 25px; border-radius: 8px;">
                                <div style="color: #666; margin-bottom: 10px; font-size: 0.95rem; font-weight: 600;">ID</div>
                                <div style="font-family: Montserrat; color: var(--preto); font-size: 2rem; font-weight: 700;">#${String(usuarioLogado.id).padStart(5, '0')}</div>
                            </div>

                            <div style="background: var(--branco); border: 2px solid var(--cinza-medio); padding: 30px; margin-bottom: 25px; border-radius: 8px;">
                                <div style="color: #666; margin-bottom: 10px; font-size: 0.95rem; font-weight: 600;">NOME</div>
                                <div style="color: var(--preto); font-size: 1.6rem; font-weight: 600;">${usuarioLogado.nome}</div>
                            </div>

                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 25px;">
                                <div style="background: var(--cinza-claro); padding: 30px; text-align: center; border-radius: 8px;">
                                    <div style="color: #666; margin-bottom: 10px; font-size: 0.95rem; font-weight: 600;">PONTOS</div>
                                    <div style="font-family: Montserrat; color: var(--preto); font-size: 3rem; font-weight: 700;">${usuarioLogado.pontos}</div>
                                </div>
                                <div style="background: var(--cinza-claro); padding: 30px; text-align: center; border-radius: 8px;">
                                    <div style="color: #666; margin-bottom: 10px; font-size: 0.95rem; font-weight: 600;">CASOS</div>
                                    <div style="font-family: Montserrat; color: var(--preto); font-size: 3rem; font-weight: 700;">${usuarioLogado.casosResolvidos}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            return `
                <section class="section page-content" style="min-height: 100vh;">
                    <h2 class="section-title">√Årea do Detetive</h2>
                    
                    <div class="tabs-container">
                        ${[
                            {id: 'casos', label: 'Meus Casos'},
                            {id: 'patentes', label: 'Promo√ß√µes'},
                            {id: 'conquistas', label: 'Conquistas'},
                            {id: 'resumo', label: 'Resumo'}
                        ].map(aba => `
                            <button class="tab-btn ${subPaginaDetetive === aba.id ? 'active' : ''}" onclick="mudarAba('${aba.id}')">
                                ${aba.label}
                            </button>
                        `).join('')}
                    </div>

                    <div style="max-width: 1400px; margin: 0 auto;">
                        ${conteudoAba}
                    </div>
                </section>
            `;
        }

        function renderPerfil() {
            if (!usuarioLogado) {
                navegarPara('login');
                return '';
            }

            dadosOriginaisPerfil = {nome: usuarioLogado.nome, senha: usuarioLogado.senha};

            return `
                <section class="section page-content" style="min-height: 100vh;">
                    <h2 class="section-title">Perfil</h2>
                    
                    <div style="max-width: 900px; margin: 60px auto 0;">
                        <div style="background: var(--branco); border-radius: 12px; padding: 50px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
                            <h3 style="font-family: Montserrat; color: var(--preto); font-size: 2.5rem; margin-bottom: 40px; text-align: center; font-weight: 700;">
                                Dados do Detetive
                            </h3>

                            <div class="form-group">
                                <label class="form-label">ID do Cadastro</label>
                                <input type="text" value="#${String(usuarioLogado.id).padStart(5, '0')}" readonly style="background: var(--cinza-claro); cursor: not-allowed;">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Nome/Nick (pode ser alterado)</label>
                                <input type="text" id="perfilNome" value="${usuarioLogado.nome}">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Email (n√£o pode ser alterado)</label>
                                <input type="email" value="${usuarioLogado.email}" readonly style="background: var(--cinza-claro); cursor: not-allowed;">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Nova Senha (deixe em branco para n√£o alterar)</label>
                                <input type="password" id="perfilSenha" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            </div>

                            <div class="form-actions">
                                <button class="btn-secondary" style="flex: 1;" onclick="cancelarEdicaoPerfil()">
                                    Cancelar
                                </button>
                                <button class="btn-primary" style="flex: 1;" onclick="salvarPerfil()">
                                    Salvar
                                </button>
                            </div>

                            <button class="btn-secondary" style="width: 100%; margin-top: 20px;" onclick="navegarPara('area-detetive')">
                                Voltar
                            </button>
                        </div>
                    </div>
                </section>
            `;
        }

        function renderAjuda() {
            return `
                <section class="section page-content" style="min-height: 100vh;">
                    <h2 class="section-title">Ajuda</h2>
                    
                    <div style="max-width: 1000px; margin: 60px auto 0;">
                        <div style="background: var(--branco); border-radius: 12px; padding: 50px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
                            <h3 style="font-family: Montserrat; color: var(--preto); font-size: 2.5rem; margin-bottom: 40px; text-align: center; font-weight: 700;">
                                Perguntas Frequentes
                            </h3>

                            ${[
                                {q: 'Como funciona o jogo?', a: 'Voc√™ compra um caso, recebe as evid√™ncias e precisa descobrir: quem √© o assassino, qual arma foi usada, o motivo e o local do crime.'},
                                {q: 'Quantas tentativas tenho?', a: 'Voc√™ tem 5 tentativas para resolver cada caso. Na primeira tentativa voc√™ ganha 500 pontos, na segunda 400, e assim por diante.'},
                                {q: 'O que s√£o as Tags?', a: 'S√£o conquistas especiais que voc√™ ganha ao resolver casos dentro do tempo limite. Lupa de Ouro, Prata, Bronze, etc.'},
                                {q: 'Como funcionam as promo√ß√µes?', a: 'Conforme resolve mais casos, sua patente sobe: Sargento (1 caso), Inspetor (3 casos), Inspetor-Chefe (5 casos), Lenda Sherlock (10 casos).'},
                                {q: 'Posso jogar mais de uma vez?', a: 'Sim! Ap√≥s finalizar um caso (resolvido ou n√£o), voc√™ pode jogar novamente comprando outro caso.'}
                            ].map((faq, i) => `
                                <div style="background: var(--cinza-claro); border-left: 4px solid var(--amarelo); border-radius: 8px; padding: 30px; margin-bottom: 20px;">
                                    <h4 style="font-family: Montserrat; color: var(--preto); font-size: 1.5rem; margin-bottom: 15px; font-weight: 700;">
                                        ${faq.q}
                                    </h4>
                                    <p style="color: #666; line-height: 1.8; font-size: 1.05rem;">
                                        ${faq.a}
                                    </p>
                                </div>
                            `).join('')}

                            <div style="text-align: center; margin-top: 60px;">
                                <h3 style="font-family: Montserrat; color: var(--preto); font-size: 2rem; margin-bottom: 30px; font-weight: 700;">
                                    Fale com o Delegado Virtual
                                </h3>
                                <a href="https://wa.me/5517988097070?text=Ol√°,%20preciso%20de%20ajuda!" target="_blank" rel="noopener noreferrer">
                                    <button class="btn-primary" style="font-size: 1.3rem; padding: 20px 50px;">
                                        üí¨ Abrir WhatsApp
                                    </button>
                                </a>
                            </div>
                        </div>
                    </div>
                </section>
            `;
        }

        function renderJogarCaso() {
            if (!casoEmJogo) {
                navegarPara('area-detetive');
                return '';
            }

            return `
                <section class="section page-content" style="min-height: 100vh;">
                    <div style="max-width: 1200px; margin: 0 auto;">
                        <div style="background: var(--branco); border-radius: 12px; padding: 40px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 20px rgba(0,0,0,0.08); flex-wrap: wrap; gap: 30px;">
                            <div>
                                <h2 style="font-family: Montserrat; font-size: 2.5rem; color: var(--preto); margin-bottom: 10px; font-weight: 700;">
                                    ${casoEmJogo.titulo}
                                </h2>
                                <p style="color: #666; font-size: 1.1rem; font-weight: 600;">Tentativa ${(casoEmJogo.tentativas || 0) + 1} de 5</p>
                            </div>
                            <div style="text-align: center;">
                                <div style="color: #666; margin-bottom: 8px; font-size: 0.95rem; font-weight: 600;">TEMPO</div>
                                <div id="timer" style="font-family: Montserrat; font-size: 2.5rem; color: var(--preto); font-weight: 700;">
                                    ${formatarTempoCompleto(tempoDecorrido)}
                                </div>
                            </div>
                        </div>

                        <div style="background: var(--branco); border-radius: 12px; padding: 50px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
                            <div style="text-align: center;">
                                <button class="btn-primary" style="font-size: 1.5rem; padding: 22px 60px;" onclick="document.getElementById('modalFormulario').classList.add('active')">
                                    Apresentar Teoria
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- MODAL -->
                    <div id="modalFormulario" class="modal-overlay">
                        <div class="modal-content">
                            <h3 style="font-family: Montserrat; font-size: 2.5rem; color: var(--preto); margin-bottom: 40px; text-align: center; font-weight: 700;">
                                Sua Teoria
                            </h3>

                            <div class="form-group">
                                <label class="form-label">1. Quem √© o assassino?</label>
                                <select id="selectAssassino">
                                    <option value="">Selecione...</option>
                                    ${casoEmJogo.opcoes.assassinos.map(op => `<option value="${op}">${op}</option>`).join('')}
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">2. Qual foi a arma?</label>
                                <select id="selectArma">
                                    <option value="">Selecione...</option>
                                    ${casoEmJogo.opcoes.armas.map(op => `<option value="${op}">${op}</option>`).join('')}
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">3. Qual foi o motivo?</label>
                                <select id="selectMotivo">
                                    <option value="">Selecione...</option>
                                    ${casoEmJogo.opcoes.motivos.map(op => `<option value="${op}">${op}</option>`).join('')}
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">4. Onde aconteceu?</label>
                                <select id="selectLocal">
                                    <option value="">Selecione...</option>
                                    ${casoEmJogo.opcoes.locais.map(op => `<option value="${op}">${op}</option>`).join('')}
                                </select>
                            </div>

                            <div class="form-actions">
                                <button class="btn-secondary" style="flex: 1;" onclick="document.getElementById('modalFormulario').classList.remove('active')">
                                    Fechar
                                </button>
                                <button class="btn-primary" style="flex: 1;" onclick="validarResposta()">
                                    Validar
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
            `;
        }

        function renderVerSolucao() {
            if (!casoEmJogo) {
                navegarPara('area-detetive');
                return '';
            }

            return `
                <section class="section page-content" style="min-height: 100vh;">
                    <div style="max-width: 1000px; margin: 0 auto;">
                        <div style="background: var(--branco); border-radius: 12px; padding: 50px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
                            <h2 style="font-family: Montserrat; font-size: 3.5rem; color: var(--preto); margin-bottom: 50px; text-align: center; font-weight: 700;">
                                Solu√ß√£o do Caso
                            </h2>

                            ${casoEmJogo.resolvido ? `
                                <div style="background: rgba(76, 175, 80, 0.1); border: 3px solid var(--verde); border-radius: 12px; padding: 40px; margin-bottom: 50px; text-align: center;">
                                    <div style="font-size: 5rem; margin-bottom: 20px;">‚úÖ</div>
                                    <h3 style="font-family: Montserrat; color: var(--verde); font-size: 2.5rem; margin-bottom: 20px; font-weight: 700;">
                                        CASO RESOLVIDO!
                                    </h3>
                                    <p style="color: var(--verde); font-size: 1.3rem; margin-bottom: 8px; font-weight: 600;">
                                        Tentativa ${casoEmJogo.tentativas}
                                    </p>
                                    <p style="color: var(--verde); font-size: 1.3rem; margin-bottom: 8px; font-weight: 600;">
                                        Tempo: ${formatarTempoCompleto(casoEmJogo.tempoTotal || 0)}
                                    </p>
                                    <p style="color: var(--verde); font-size: 2.2rem; font-weight: 900; font-family: Montserrat; margin-top: 15px;">
                                        +${casoEmJogo.pontosGanhos || 0} PONTOS
                                    </p>
                                    ${casoEmJogo.tagGanha ? `<p style="color: var(--verde); font-size: 1.6rem; font-weight: 700; margin-top: 15px;">üèÜ ${casoEmJogo.tagGanha}</p>` : ''}
                                </div>
                            ` : casoEmJogo.naoSolucionado ? `
                                <div style="background: rgba(229, 57, 53, 0.1); border: 3px solid var(--vermelho); border-radius: 12px; padding: 40px; margin-bottom: 50px; text-align: center;">
                                    <div style="font-size: 5rem; margin-bottom: 20px;">‚ùå</div>
                                    <h3 style="font-family: Montserrat; color: var(--vermelho); font-size: 2.5rem; margin-bottom: 20px; font-weight: 700;">
                                        CASO N√ÉO SOLUCIONADO
                                    </h3>
                                    <p style="color: var(--vermelho); font-size: 1.3rem; font-weight: 600;">
                                        Tentativas esgotadas (5/5)
                                    </p>
                                </div>
                            ` : ''}

                            <h3 style="font-family: Montserrat; color: var(--preto); font-size: 2rem; margin-bottom: 30px; font-weight: 700;">
                                Resposta Correta
                            </h3>
                            <div style="display: grid; gap: 20px; margin-bottom: 50px;">
                                ${Object.entries(casoEmJogo.solucao).filter(([key]) => key !== 'explicacao').map(([key, value]) => `
                                    <div style="background: var(--cinza-claro); padding: 25px; border-radius: 8px;">
                                        <div style="color: #666; margin-bottom: 10px; font-weight: 600; font-size: 0.9rem; text-transform: uppercase;">${key}</div>
                                        <div style="color: var(--preto); font-size: 1.4rem; font-weight: 700; font-family: Montserrat;">${value}</div>
                                    </div>
                                `).join('')}
                            </div>

                            <h3 style="font-family: Montserrat; color: var(--preto); font-size: 2rem; margin-bottom: 30px; font-weight: 700;">
                                Como Aconteceu
                            </h3>
                            <div style="background: var(--cinza-claro); padding: 35px; margin-bottom: 50px; border-radius: 8px;">
                                <p style="color: #666; font-size: 1.15rem; line-height: 2;">
                                    ${casoEmJogo.solucao.explicacao}
                                </p>
                            </div>

                            <button class="btn-primary" style="width: 100%; padding: 20px; font-size: 1.3rem;" onclick="navegarPara('area-detetive')">
                                Voltar
                            </button>
                        </div>
                    </div>
                </section>
            `;
        }

        async function renderRanking() {
            const todosUsuarios = await buscarTodosUsuariosFirebase();
            const ranking = todosUsuarios
                .sort((a, b) => b.pontos - a.pontos)
                .map((u, index) => ({...u, posicao: index + 1}));
            
            const top10 = ranking.slice(0, 10);
            const usuarioRanking = usuarioLogado ? ranking.find(u => u.id === usuarioLogado.id) : null;

            const content = document.getElementById('app-content');
            content.innerHTML = `
                <section class="section page-content" style="min-height: 100vh;">
                    <h2 class="section-title">Ranking Global</h2>
                    <p class="section-subtitle">Top 10 detetives</p>
                    
                    <div class="rank-table" style="margin-top: 60px;">
                        <div class="rank-header">
                            <div>POS</div>
                            <div>DETETIVE</div>
                            <div>PONTOS</div>
                            <div>CASOS</div>
                        </div>
                        ${top10.map(user => `
                            <div class="rank-row ${usuarioLogado && user.id === usuarioLogado.id ? 'user-rank' : ''}">
                                <div style="font-family: Montserrat; font-size: 1.8rem; font-weight: 700; color: var(--preto);">
                                    ${user.posicao === 1 ? 'ü•á' : user.posicao === 2 ? 'ü•à' : user.posicao === 3 ? 'ü•â' : `#${user.posicao}`}
                                </div>
                                <div style="font-weight: ${usuarioLogado && user.id === usuarioLogado.id ? '700' : '400'}; color: ${usuarioLogado && user.id === usuarioLogado.id ? 'var(--preto)' : '#666'}; font-size: 1.1rem; font-family: Montserrat;">
                                    ${user.nome} ${usuarioLogado && user.id === usuarioLogado.id ? '(VOC√ä)' : ''}
                                </div>
                                <div style="font-family: Montserrat; color: var(--preto); font-weight: 700; font-size: 1.4rem;">${user.pontos}</div>
                                <div style="color: #666; font-size: 1.2rem; font-weight: 600;">${user.casosResolvidos}</div>
                            </div>
                        `).join('')}
                        ${usuarioRanking && usuarioRanking.posicao > 10 ? `
                            <div class="rank-row user-rank">
                                <div style="font-family: Montserrat; font-size: 1.8rem; font-weight: 700; color: var(--preto);">#${usuarioRanking.posicao}</div>
                                <div style="font-weight: 700; color: var(--preto); font-size: 1.1rem; font-family: Montserrat;">
                                    ${usuarioRanking.nome} (VOC√ä)
                                </div>
                                <div style="font-family: Montserrat; color: var(--preto); font-weight: 700; font-size: 1.4rem;">${usuarioRanking.pontos}</div>
                                <div style="color: #666; font-size: 1.2rem; font-weight: 600;">${usuarioRanking.casosResolvidos}</div>
                            </div>
                        ` : ''}
                    </div>
                </section>
            `;
        }

        // ==================== INICIALIZA√á√ÉO ==================== //
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚úÖ FATTO CRIMINAL V2.0 carregado!');
            console.log('‚úÖ 6 casos dispon√≠veis');
            console.log('‚úÖ Visual limpo e moderno');
            console.log('‚úÖ Todas as funcionalidades operacionais');
            renderizarPagina();
        });
    </script>
</body>
</html>
