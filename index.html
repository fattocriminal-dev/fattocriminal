<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FATTO CRIMINAL - Jogos de Mistério e Investigação</title>
    
    <!-- FONTES -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;900&family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- FIREBASE -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        /* ==================== RESET ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Open Sans', sans-serif;
            background: #000000;
            color: #FFFFFF;
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* ==================== VARIÁVEIS ==================== */
        :root {
            --amarelo: #FFD700;
            --preto: #000000;
            --cinza-claro: #1A1A1A;
            --cinza-medio: #333333;
            --branco: #FFFFFF;
            --verde: #4CAF50;
            --vermelho: #E53935;
            --azul: #2196F3;
        }

        /* ==================== ANIMAÇÕES ==================== */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes successBounce {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.3); }
            50% { transform: scale(0.9); }
            75% { transform: scale(1.1); }
        }

        @keyframes confetti {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Animações necessárias para modais */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }
        
        @keyframes fadeInBounce {
            0% { 
                transform: scale(0.8);
                opacity: 0;
            }
            50% {
                transform: scale(1.02);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }


        /* ==================== VALIDAÇÕES DE FORMULÁRIO ==================== */
        
        /* Feedback de Validação */
        .input-feedback {
            font-size: 0.85rem;
            margin-top: 0.5rem;
            display: none;
            font-weight: 500;
        }
        
        .input-feedback.error {
            color: #ff4444;
            display: block;
        }
        
        .input-feedback.success {
            color: #00ff88;
            display: block;
        }
        
        /* Wrapper do Input */
        .input-wrapper {
            position: relative;
        }
        
        /* Ícone de Validação */
        .input-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
            display: none;
            pointer-events: none;
        }
        
        .input-icon.show {
            display: block;
        }
        
        .input-icon.valid {
            color: #00ff88;
        }
        
        .input-icon.invalid {
            color: #ff4444;
        }
        
        /* Input com validação */
        input.valid {
            border-color: #00ff88 !important;
            box-shadow: 0 0 0 2px rgba(0, 255, 136, 0.1) !important;
        }
        
        input.invalid {
            border-color: #ff4444 !important;
            box-shadow: 0 0 0 2px rgba(255, 68, 68, 0.1) !important;
        }
        
        /* ==================== TERMÔMETRO DE SENHA ==================== */
        
        .password-strength {
            margin-top: 0.8rem;
        }
        
        .strength-bar {
            height: 8px;
            background: #0a0a0a;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
            border: 1px solid #333333;
        }
        
        .strength-bar-fill {
            height: 100%;
            width: 0%;
            transition: all 0.4s ease;
            border-radius: 3px;
        }
        
        .strength-bar-fill.fraca {
            width: 33%;
            background: linear-gradient(90deg, #ff4444, #ff6666);
        }
        
        .strength-bar-fill.media {
            width: 66%;
            background: linear-gradient(90deg, #ffaa00, #ffcc44);
        }
        
        .strength-bar-fill.forte {
            width: 100%;
            background: linear-gradient(90deg, #00ff88, #00cc66);
        }
        
        .strength-text {
            font-size: 0.9rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .strength-text.fraca {
            color: #ff4444;
        }
        
        .strength-text.media {
            color: #ffaa00;
        }
        
        .strength-text.forte {
            color: #00ff88;
        }
        
        .strength-icon {
            font-size: 1.2rem;
        }

        /* ==================== LOADING ==================== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 15000;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--cinza-medio);
            border-top: 5px solid var(--amarelo);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* ==================== HEADER ==================== */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #000000;
            border-bottom: 1px solid #333333;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(255,255,255,0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .logo-container:hover {
            transform: scale(1.02);
        }

        .logo-img {
            height: 50px;
            width: auto;
        }

        .nav {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .nav button {
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: #FFFFFF;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s;
            font-family: 'Montserrat', sans-serif;
            position: relative;
        }

        .nav button::after {
            content: '';
            position: absolute;
            bottom: 8px;
            left: 24px;
            right: 24px;
            height: 2px;
            background: var(--amarelo);
            transform: scaleX(0);
            transition: transform 0.3s;
        }

        .nav button:hover::after {
            transform: scaleX(1);
        }

        .btn-cart {
            position: relative;
        }

        .cart-badge {
            position: absolute;
            top: 0;
            right: 8px;
            background: var(--vermelho);
            color: #fff;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
        }

        /* ==================== HERO ==================== */
        .hero {
            position: relative;
            min-height: 90vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 140px 40px 80px;
            background-image: url('BANNER.jpeg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        
        /* Sobreposição escura para melhorar legibilidade do texto */
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 1;
        }
        
        .hero-content {
            position: relative;
            z-index: 2;
            max-width: 1000px;
            animation: fadeIn 1s ease-out;
        }

        .hero-logo-big {
            max-width: 600px;
            width: 100%;
            margin: 0 auto 40px;
            filter: drop-shadow(0 4px 20px rgba(0,0,0,0.1));
        }

        .hero-slogan {
            font-size: 1.8rem;
            color: #FFFFFF;
            margin-bottom: 50px;
            font-weight: 300;
            letter-spacing: 1px;
        }

        .hero-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* ==================== BOTÕES ==================== */
        .btn-primary {
            padding: 16px 40px;
            background: var(--amarelo);
            border: 2px solid var(--amarelo);
            color: #000000;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Montserrat', sans-serif;
            box-shadow: 0 4px 15px rgba(255,215,0,0.3);
        }

        .btn-primary:hover {
            background: #000000;
            color: var(--amarelo);
            border: 2px solid var(--amarelo);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,215,0,0.5);
        }

        .btn-secondary {
            padding: 16px 40px;
            background: transparent;
            border: 2px solid #FFFFFF;
            color: #FFFFFF;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Montserrat', sans-serif;
        }

        .btn-secondary:hover {
            background: #FFFFFF;
            color: #000000;
            transform: translateY(-2px);
        }

        /* ==================== SECTIONS ==================== */
        .section {
            padding: 100px 40px;
            background: #000000;
        }

        .section-alt {
            background: #0a0a0a;
        }

        .section-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 3rem;
            text-align: center;
            margin-bottom: 20px;
            color: #FFFFFF;
            letter-spacing: 2px;
            font-weight: 700;
        }

        .section-subtitle {
            text-align: center;
            color: #bbbbbb;
            font-size: 1.2rem;
            margin-bottom: 60px;
            font-weight: 300;
        }

        /* ==================== CASOS GRID ==================== */
        .casos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 40px;
            max-width: 1400px;
            margin: 0 auto;
            justify-items: center;
        }

        .case-card {
            background: #1a1a1a;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.4s;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(255,255,255,0.1);
            max-width: 420px;
            width: 100%;
            position: relative;
        }

        .case-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 12px 40px rgba(255, 215, 0, 0.4), 0 0 80px rgba(255, 215, 0, 0.3);
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 12px 40px rgba(255, 215, 0, 0.4), 0 0 80px rgba(255, 215, 0, 0.3);
            }
            50% {
                box-shadow: 0 12px 60px rgba(255, 215, 0, 0.6), 0 0 100px rgba(255, 215, 0, 0.5);
            }
        }

        .case-banner {
            width: 100%;
            height: 280px;
            object-fit: cover;
            position: relative;
        }

        .case-content {
            padding: 30px;
            position: relative;
        }
            z-index: 1;
            filter: blur(1px);
        }

        .case-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            color: #FFFFFF;
            margin-bottom: 12px;
            font-weight: 700;
        }

        .case-subtitle {
            color: #bbbbbb;
            margin-bottom: 25px;
            font-size: 1rem;
            line-height: 1.6;
        }

        .case-tags {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 25px 0;
        }

        .case-tag {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--cinza-claro);
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            color: #FFFFFF;
            filter: brightness(1.2);
        }

        .case-tag-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        .nivel-facil { background: var(--verde); color: white; }
        .nivel-medio { background: var(--amarelo); color: #FFFFFF; }
        .nivel-dificil { background: var(--vermelho); color: white; }

        .case-price {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.2rem;
            color: #FFD700;
            font-weight: 700;
            margin-top: 20px;
        }

        /* ==================== MENSAGENS ==================== */
        .toast {
            position: fixed;
            top: 100px;
            right: 40px;
            padding: 20px 30px;
            font-size: 1rem;
            font-weight: 600;
            z-index: 10000;
            animation: slideDown 0.5s ease-out;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            max-width: 400px;
            font-family: 'Montserrat', sans-serif;
        }

        .toast-sucesso {
            background: var(--verde);
            color: white;
        }

        .toast-erro {
            background: var(--vermelho);
            color: white;
        }

        .toast-aviso {
            background: var(--amarelo);
            color: #FFFFFF;
        }

        .toast-missao {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            font-size: 1.1rem;
            line-height: 1.8;
        }

        .toast-conquista {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            font-size: 1.3rem;
            animation: successBounce 0.6s ease-out;
        }

        /* ==================== ANIMAÇÃO DE SUCESSO ==================== */
        .success-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 20000;
            animation: fadeIn 0.5s ease-out;
        }

        .success-overlay.active {
            display: flex;
        }

        .success-content {
            text-align: center;
            animation: successBounce 1s ease-out;
        }

        .success-icon {
            font-size: 10rem;
            margin-bottom: 30px;
            animation: successBounce 1s ease-out infinite;
        }

        .success-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 4rem;
            color: var(--verde);
            margin-bottom: 20px;
            font-weight: 900;
        }

        .success-message {
            font-size: 1.8rem;
            color: white;
            margin-bottom: 40px;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--amarelo);
            animation: confetti 3s ease-out forwards;
        }

        /* ==================== FOOTER ==================== */
        .footer {
            background: #000000;
            border-top: 1px solid #333333;
            padding: 30px 40px 25px;
            text-align: center;
        }

        .footer-logo {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.6rem;
            color: #FFFFFF;
            margin-bottom: 12px;
            font-weight: 700;
        }

        /* ==================== WHATSAPP ==================== */
        .whatsapp-float {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #25D366;
            border-radius: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 14px 22px;
            cursor: pointer;
            box-shadow: 0 6px 25px rgba(37, 211, 102, 0.5);
            transition: all 0.4s ease;
            z-index: 999;
            text-decoration: none;
            animation: pulse 2s infinite;
        }
        
        .whatsapp-float span {
            color: white;
            font-weight: 700;
            font-size: 0.95rem;
            font-family: 'Montserrat', sans-serif;
            white-space: nowrap;
        }

        .whatsapp-float:hover {
            transform: scale(1.08) translateY(-4px);
            box-shadow: 0 10px 35px rgba(37, 211, 102, 0.7);
            animation: none;
        }
        
        /* Responsivo para mobile */
        @media (max-width: 768px) {
            .whatsapp-float {
                bottom: 20px;
                right: 20px;
                padding: 12px 18px;
                gap: 10px;
            }
            
            .whatsapp-float span {
                font-size: 0.85rem;
            }
        }

        /* ==================== INPUTS ==================== */
        input, select, textarea {
            width: 100%;
            padding: 16px 20px;
            background: #1a1a1a;
            border: 2px solid #333333;
            color: #FFFFFF;
            font-size: 1rem;
            transition: all 0.3s;
            border-radius: 4px;
            font-family: 'Open Sans', sans-serif;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--amarelo);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);
        }

        input::placeholder, textarea::placeholder {
            color: #888888;
        }

        /* ==================== MODAL ==================== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 40px;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: #1a1a1a;
            border-radius: 12px;
            padding: 50px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.9);
            border: 1px solid #333333;
        }

        /* ==================== TABS ==================== */
        .tabs-container {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 60px;
            flex-wrap: wrap;
            border-bottom: 2px solid var(--cinza-medio);
            padding-bottom: 10px;
        }

        .tab-btn {
            padding: 15px 30px;
            background: transparent;
            border: none;
            color: #888888;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s;
            font-family: 'Montserrat', sans-serif;
            position: relative;
        }

        .tab-btn.active {
            color: #FFFFFF;
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--amarelo);
        }

        /* ==================== UTILITY ==================== */
        .hidden {
            display: none !important;
        }

        .page-content {
            min-height: 100vh;
            padding-top: 90px;
        }

        /* ==================== RANKING ==================== */
        .rank-table {
            background: #1a1a1a;
            border-radius: 12px;
            overflow: hidden;
            max-width: 1000px;
            margin: 0 auto;
            box-shadow: 0 6px 30px rgba(255, 215, 0, 0.2);
            border: 1px solid #333333;
        }

        .rank-header {
            background: #000000;
            padding: 20px;
            display: grid;
            grid-template-columns: 80px 1fr 150px 150px;
            gap: 20px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            color: #FFD700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .rank-row {
            padding: 20px;
            display: grid;
            grid-template-columns: 80px 1fr 150px 150px;
            gap: 20px;
            border-bottom: 1px solid #333333;
            transition: all 0.3s;
            color: #FFFFFF;
            font-weight: 500;
        }

        .rank-row:hover {
            background: #252525;
            transform: translateX(5px);
            border-left: 3px solid #FFD700;
        }

        .rank-row.user-rank {
            background: rgba(255, 215, 0, 0.15);
            border-left: 5px solid var(--amarelo);
            font-weight: 700;
        }

        /* ==================== RESPONSIVO ==================== */
        @media (max-width: 768px) {
            .hero {
                min-height: 70vh;
                padding: 120px 20px 60px;
            }
            
            .hero::before {
                background: rgba(0, 0, 0, 0.5);
            }
            
            .hero-logo-big {
                max-width: 90%;
            }
            
            .hero-slogan {
                font-size: 1.3rem;
            }
            
            .nav {
                flex-wrap: wrap;
            }
            
            .nav button {
                font-size: 0.85rem;
                padding: 10px 16px;
            }
            
            .casos-grid {
                grid-template-columns: 1fr;
            }
            
            .section-title {
                font-size: 2rem;
            }

            .rank-header, .rank-row {
                grid-template-columns: 60px 1fr 100px 100px;
                font-size: 0.85rem;
            }
        }

        /* ==================== FORM GROUP ==================== */
        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #FFFFFF;
            font-family: 'Montserrat', sans-serif;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 40px;
        }
        
        /* ==================== RESPONSIVO MOBILE ==================== */
        @media (max-width: 768px) {
            /* CARDS DE CASOS - 2 POR LINHA */
            .case-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 20px !important;
            }
            
            .case-card {
                max-width: 100% !important;
            }
            
            .case-banner {
                height: 180px !important;
            }
            
            .case-content {
                padding: 20px !important;
            }
            
            .case-title {
                font-size: 1.3rem !important;
            }
            
            .case-subtitle {
                font-size: 0.9rem !important;
            }
            
            /* MENUS */
            .tabs-container {
                display: flex !important;
                overflow-x: auto !important;
                gap: 10px !important;
                padding: 10px !important;
                -webkit-overflow-scrolling: touch;
            }
            
            .tab-btn {
                white-space: nowrap !important;
                font-size: 0.9rem !important;
                padding: 12px 20px !important;
            }
            
            /* GRID DE SELEÇÃO DE MÍDIA */
            .version-grid {
                grid-template-columns: 1fr !important;
                gap: 20px !important;
            }
            
            /* MODAIS */
            .modal-content {
                width: 95% !important;
                max-width: 95% !important;
                padding: 30px 20px !important;
                max-height: 90vh !important;
                overflow-y: auto !important;
            }
            
            /* FORMULÁRIOS */
            .form-group {
                margin-bottom: 20px !important;
            }
            
            select, input {
                font-size: 16px !important; /* Evita zoom no iOS */
            }
            
            /* TÍTULOS */
            .section-title {
                font-size: 2rem !important;
            }
            
            .section-subtitle {
                font-size: 1rem !important;
            }
            
            /* FICHA DO DETETIVE */
            .case-card h3 {
                font-size: 1.8rem !important;
            }
            
            /* GRID DE ESTATÍSTICAS */
            div[style*="grid-template-columns: repeat(2, 1fr)"] {
                grid-template-columns: 1fr !important;
            }
            
            /* BOTÕES */
            .primary-btn, .btn {
                padding: 14px 25px !important;
                font-size: 1rem !important;
            }
        }
        
        /* MOBILE MUITO PEQUENO - 1 CARD POR LINHA */
        @media (max-width: 480px) {
            .case-grid {
                grid-template-columns: 1fr !important;
            }
            
            .modal-content {
                padding: 20px 15px !important;
            }
        }
    </style>
</head>
<body>
    <!-- LOADING -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- HEADER -->
    <header class="header">
        <div class="header-content">
            <div class="logo-container" onclick="navegarPara('home')">
                <div class="logo-text" style="font-family: 'Montserrat', sans-serif; font-weight: 900; font-size: 1.5rem; color: #FFD700;">FATTO CRIMINAL</div>
            </div>
            <nav class="nav">
                <button onclick="navegarPara('home')">Início</button>
                <button onclick="navegarPara('casos')">Casos</button>
                <button onclick="navegarPara('ranking')">Ranking</button>
                <button id="btnAreaDetetive" class="hidden" onclick="navegarPara('area-detetive')">Minha Área</button>
                <button id="btnPerfil" class="hidden" onclick="navegarPara('perfil')">Perfil</button>
                <button id="btnAjuda" onclick="navegarPara('ajuda')">Ajuda</button>
                <button id="btnCarrinho" class="btn-cart hidden" onclick="navegarPara('carrinho')">
                    🛒
                    <span class="cart-badge hidden" id="cartBadge">0</span>
                </button>
                <button id="btnLogin" onclick="navegarPara('login')">Login</button>
                <button id="btnSair" class="hidden" onclick="fazerLogout()">Sair</button>
            </nav>
        </div>
    </header>

    <!-- CONTEÚDO DINÂMICO -->
    <div id="app-content"></div>

    <!-- FOOTER -->
    <footer class="footer">
        <div class="footer-logo">FATTO CRIMINAL</div>
        <p style="color: #aaaaaa; margin: 15px 0; font-size: 1rem;">
            Jogos de Mistério e Investigação
        </p>
        <div style="display: flex; gap: 20px; justify-content: center; margin: 30px 0;">
            <a href="#" style="color: #FFFFFF; font-size: 1.5rem; text-decoration: none;" title="Instagram">📷</a>
            <a href="#" style="color: #FFFFFF; font-size: 1.5rem; text-decoration: none;" title="TikTok">🎵</a>
            <a href="#" style="color: #FFFFFF; font-size: 1.5rem; text-decoration: none;" title="YouTube">▶️</a>
        </div>
        <p style="color: #999; margin: 20px 0; font-size: 0.9rem;">
            © 2025 Fatto Criminal. Todos os direitos reservados.
        </p>
    </footer>

    <!-- WHATSAPP -->
    <a 
        href="https://wa.me/5517988097070?text=Olá,%20preciso%20de%20ajuda!" 
        target="_blank" 
        rel="noopener noreferrer"
        class="whatsapp-float"
        title="Delegado Virtual"
    >
        <div style="font-size: 32px;">🕵️</div>
        <span>Fale com o Delegado Virtual</span>
    </a>

    <!-- TOAST -->
    <div id="toastMessage" class="toast hidden"></div>

    <!-- SUCCESS OVERLAY -->
    <div id="successOverlay" class="success-overlay">
        <div class="success-content">
            <div class="success-icon">🎉</div>
            <h2 class="success-title">CASO RESOLVIDO!</h2>
            <p class="success-message" id="successText"></p>
            <button class="btn-primary" onclick="fecharSuccessOverlay()">CONTINUAR</button>
        </div>
    </div>

    <script>
        // ==================== 6 CASOS COMPLETOS ==================== //
        const casos = [
            {
                id: 1,
                numero: "FC0001",
                titulo: "O Expresso Noturno 247",
                subtitulo: "Uma morte no trem. Um mistério a ser resolvido.",
                descricao: "Durante viagem noturna no trem expresso, passageiro é encontrado morto em cabine trancada.",
                dificuldade: "Médio",
                nivelCor: "nivel-medio",
                tempoLimite: 180,
                destaque: true,
                precoDigital: 59.90,
                precoFisico: 89.90,
                banner: "https://images.unsplash.com/photo-1474487548417-781cb71495f3?w=800&h=400&fit=crop",
                classificacao: "16 anos",
                jogadores: "2-6",
                resumo: "Às 23h47, o Expresso Noturno 247 parte da estação central. Passageiros dormem tranquilos... até o grito. Na cabine 12, empresário Marcos Silva jaz morto. Porta trancada por dentro. Janela fechada. Como o assassino escapou?",
                solucao: {
                    assassino: "Laura Mendes (Condutora)",
                    arma: "Veneno (Estricnina)",
                    motivo: "Vingança - Era ex-esposa",
                    local: "Cabine 12",
                    explicacao: "Laura vingou-se de Marcos que a traiu e abandonou 5 anos atrás. Envenenou o uísque dele durante a ronda."
                },
                opcoes: {
                    assassinos: ["Laura Mendes (Condutora)", "João Carlos (Sócio)", "Rita Silva (Secretária)", "Paulo Mendes (Garçom)", "Ana Costa (Passageira)"],
                    armas: ["Veneno (Estricnina)", "Faca", "Sufocamento", "Golpe na cabeça", "Injeção letal"],
                    motivos: ["Vingança - Era ex-esposa", "Dívida financeira", "Herança", "Chantagem", "Crime passional"],
                    locais: ["Cabine 12", "Vagão restaurante", "Banheiro", "Corredor", "Cabine 8"]
                }
            },
            {
                id: 2,
                numero: "FC0002",
                titulo: "A Última Exposição",
                subtitulo: "Morte na galeria de arte",
                descricao: "Curador de arte renomado encontrado morto minutos antes da abertura de exposição milionária.",
                dificuldade: "Difícil",
                nivelCor: "nivel-dificil",
                tempoLimite: 240,
                destaque: true,
                precoDigital: 69.90,
                precoFisico: 99.90,
                banner: "https://images.unsplash.com/photo-1536924940846-227afb31e2a5?w=800&h=400&fit=crop",
                classificacao: "18 anos",
                jogadores: "3-8",
                resumo: "Galeria Moderna Art prepara abertura de exposição. Champagne gelando. Convidados chegando. Mas Roberto Costa, curador principal, não atende telefone. Encontram-no morto no depósito, rodeado de obras caríssimas. Uma delas está faltando.",
                solucao: {
                    assassino: "Gabriel Ferreira (Artista)",
                    arma: "Estátua de mármore",
                    motivo: "Falsificação descoberta",
                    local: "Depósito da galeria",
                    explicacao: "Gabriel falsificava obras renascentistas. Roberto descobriu e seria denunciado na noite da exposição."
                },
                opcoes: {
                    assassinos: ["Gabriel Ferreira (Artista)", "Mariana Costa (Esposa)", "Lucas Silva (Assistente)", "Beatriz Mendes (Crítica)", "Fernando Lima (Investidor)"],
                    armas: ["Estátua de mármore", "Moldura pesada", "Faca", "Veneno", "Sufocamento"],
                    motivos: ["Falsificação descoberta", "Herança", "Disputa profissional", "Romance", "Fraude financeira"],
                    locais: ["Depósito da galeria", "Sala principal", "Escritório", "Banheiro VIP", "Estacionamento"]
                }
            },
            {
                id: 3,
                numero: "FC0003",
                titulo: "Silêncio no Farol",
                subtitulo: "Faroleiro desaparecido",
                descricao: "Faroleiro responsável por ilha isolada desaparece misteriosamente. Três semanas depois, corpo encontrado.",
                dificuldade: "Difícil",
                nivelCor: "nivel-dificil",
                tempoLimite: 300,
                destaque: true,
                precoDigital: 79.90,
                precoFisico: 109.90,
                banner: "https://images.unsplash.com/photo-1502134249126-9f3755a50d78?w=800&h=400&fit=crop",
                classificacao: "16 anos",
                jogadores: "2-4",
                resumo: "Ilha do Silêncio. Farol isolado. Roberto Alves mora sozinho há 5 anos. Barco de suprimentos chega: porta aberta, farol apagado, Roberto sumiu. Três semanas depois, pescadores encontram corpo na praia.",
                solucao: {
                    assassino: "Não houve assassino (Acidente)",
                    arma: "Queda da plataforma",
                    motivo: "Consumo de álcool durante tempestade",
                    local: "Plataforma do farol",
                    explicacao: "Roberto bebeu durante tempestade, perdeu equilíbrio na plataforma externa e caiu no mar."
                },
                opcoes: {
                    assassinos: ["Não houve assassino (Acidente)", "Entregador de suprimentos", "Ex-sócio", "Irmão gêmeo", "Pescador local"],
                    armas: ["Queda da plataforma", "Afogamento", "Golpe", "Envenenamento", "Empurrão"],
                    motivos: ["Consumo de álcool durante tempestade", "Dívida antiga", "Disputa de herança", "Segredo enterrado", "Vingança"],
                    locais: ["Plataforma do farol", "Quarto", "Cozinha", "Rochedo", "Praia"]
                }
            },
            {
                id: 4,
                numero: "FC0004",
                titulo: "Caos no Cassino Royal",
                subtitulo: "Jogador envenenado",
                descricao: "Durante partida de pôquer de alto risco, jogador profissional morre envenenado na mesa.",
                dificuldade: "Médio",
                nivelCor: "nivel-medio",
                tempoLimite: 180,
                precoDigital: 59.90,
                precoFisico: 89.90,
                banner: "https://images.unsplash.com/photo-1511512578047-dfb367046420?w=800&h=400&fit=crop",
                classificacao: "18 anos",
                jogadores: "4-8",
                resumo: "Cassino Royal. Mesa VIP. Stakes milionários. Carlos 'Ás' Ferreira está em dia de sorte. Drink. Aposta. All-in. Começa a tremer. Colapsa. Médicos confirmam: envenenamento.",
                solucao: {
                    assassino: "Rita Santos (Dealer)",
                    arma: "Cianureto no whisky",
                    motivo: "Dívida de R$ 2 milhões",
                    local: "Mesa de pôquer VIP",
                    explicacao: "Rita devia 2 milhões para agiotas. Carlos era credor. Envenenou o whisky durante distração."
                },
                opcoes: {
                    assassinos: ["Rita Santos (Dealer)", "Paulo Costa (Jogador)", "Marina Silva (Garçonete)", "Lucas Mendes (Segurança)", "Ana Lima (Gerente)"],
                    armas: ["Cianureto no whisky", "Veneno no charuto", "Injeção", "Pó no ar", "Comprimido triturado"],
                    motivos: ["Dívida de R$ 2 milhões", "Trapaça descoberta", "Chantagem", "Ciúme", "Vingança de jogo"],
                    locais: ["Mesa de pôquer VIP", "Bar", "Banheiro", "Sala privativa", "Cofre"]
                }
            },
            {
                id: 5,
                numero: "FC0005",
                titulo: "Overdose no Hospital Central",
                subtitulo: "Médico-chefe assassinado",
                descricao: "Dr. Fernando Oliveira, diretor do Hospital Central, encontrado morto após turno.",
                dificuldade: "Difícil",
                nivelCor: "nivel-dificil",
                tempoLimite: 240,
                precoDigital: 69.90,
                precoFisico: 99.90,
                banner: "https://images.unsplash.com/photo-1516549655169-df83a0774514?w=800&h=400&fit=crop",
                classificacao: "16 anos",
                jogadores: "3-6",
                resumo: "03h15. Plantão acaba. Dr. Fernando vai ao escritório. Às 06h00, enfermeira o encontra desfalecido. Overdose de morfina. Mas Fernando nunca usou drogas.",
                solucao: {
                    assassino: "Dra. Julia Rocha (Cirurgiã)",
                    arma: "Injeção de morfina",
                    motivo: "Erro médico encoberto",
                    local: "Escritório do diretor",
                    explicacao: "Julia cometeu erro fatal em cirurgia 2 anos atrás. Fernando sabia e ia denunciar ao conselho."
                },
                opcoes: {
                    assassinos: ["Dra. Julia Rocha (Cirurgiã)", "Ricardo Santos (Enfermeiro)", "Maria Costa (Farmacêutica)", "Carlos Lima (Paciente)", "Ana Silva (Administradora)"],
                    armas: ["Injeção de morfina", "Comprimidos triturados", "Inalação de anestésico", "Veneno", "Sufocamento"],
                    motivos: ["Erro médico encoberto", "Disputa de cargo", "Fraude de medicamentos", "Chantagem", "Processo judicial"],
                    locais: ["Escritório do diretor", "Centro cirúrgico", "Farmácia", "UTI", "Estacionamento"]
                }
            },
            {
                id: 6,
                numero: "FC0006",
                titulo: "Traição no Palco",
                subtitulo: "Atriz principal morta",
                descricao: "Minutos antes da estreia da peça mais aguardada do ano, protagonista é encontrada morta no camarim.",
                dificuldade: "Fácil",
                nivelCor: "nivel-facil",
                tempoLimite: 120,
                precoDigital: 49.90,
                precoFisico: 79.90,
                banner: "https://images.unsplash.com/photo-1503095396549-807759245b35?w=800&h=400&fit=crop",
                classificacao: "14 anos",
                jogadores: "2-5",
                resumo: "Teatro lotado. Público ansioso. Estreia de 'Amor e Morte'. Mas Camila Santos, estrela principal, não aparece. Encontram-na no camarim. Café envenenado ao lado.",
                solucao: {
                    assassino: "Marina Costa (Atriz substituta)",
                    arma: "Cianureto no café",
                    motivo: "Inveja - queria papel principal",
                    local: "Camarim principal",
                    explicacao: "Marina era substituta há 3 anos. Sempre segunda opção. Envenenou café minutos antes da estreia."
                },
                opcoes: {
                    assassinos: ["Marina Costa (Atriz substituta)", "Paulo Silva (Diretor)", "Roberto Lima (Produtor)", "Carla Mendes (Figurinista)", "Lucas Dias (Ator coadjuvante)"],
                    armas: ["Cianureto no café", "Sufocamento", "Golpe", "Veneno em maquiagem", "Empurrão da escada"],
                    motivos: ["Inveja - queria papel principal", "Romance proibido", "Dívida", "Chantagem", "Disputa artística"],
                    locais: ["Camarim principal", "Palco", "Bastidores", "Sala de figurinos", "Depósito"]
                }
            }
        ];

        console.log('✅ 6 casos carregados');

        // ==================== FIREBASE CONFIG ==================== //
        const firebaseConfig = {
            apiKey: "AIzaSyBUavAk-f5nqe3x_xzI_ZLoU9oqoEzMCV4",
            authDomain: "fatto-criminal-7addf.firebaseapp.com",
            projectId: "fatto-criminal-7addf",
            storageBucket: "fatto-criminal-7addf.firebasestorage.app",
            messagingSenderId: "90391050719",
            appId: "1:90391050719:web:3712862c39cacb65e52c6a",
            measurementId: "G-8VJD43K4R6"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        console.log('🔥 Firebase conectado com sucesso!');

        // ==================== FUNÇÕES FIREBASE ==================== //
        function mostrarLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function esconderLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        async function salvarUsuarioFirebase(usuario) {
            try {
                mostrarLoading();
                await db.collection('usuarios').doc(usuario.email).set(usuario);
                console.log('✅ Usuário salvo no Firebase');
                esconderLoading();
            } catch (error) {
                console.error('❌ Erro ao salvar usuário:', error);
                esconderLoading();
            }
        }

        async function buscarUsuarioFirebase(email) {
            try {
                mostrarLoading();
                const doc = await db.collection('usuarios').doc(email).get();
                esconderLoading();
                if (doc.exists) {
                    return doc.data();
                }
                return null;
            } catch (error) {
                console.error('❌ Erro ao buscar usuário:', error);
                esconderLoading();
                return null;
            }
        }

        async function buscarTodosUsuariosFirebase() {
            try {
                const snapshot = await db.collection('usuarios').get();
                const usuarios = [];
                snapshot.forEach(doc => {
                    usuarios.push(doc.data());
                });
                return usuarios;
            } catch (error) {
                console.error('❌ Erro ao buscar usuários:', error);
                return [];
            }
        }

        // ==================== ESTADO GLOBAL ==================== //
        let paginaAtual = 'home';
        let usuarioLogado = null;
        let carrinho = [];
        let casoSelecionado = null;
        let casoEmJogo = null;
        let timerInterval = null;
        let tempoDecorrido = 0;
        let subPaginaDetetive = 'casos';
        let versaoSelecionada = 'digital';
        let dadosOriginaisPerfil = null;

        // Carregar do localStorage
        if (localStorage.getItem('usuarioLogado')) {
            usuarioLogado = JSON.parse(localStorage.getItem('usuarioLogado'));
            // atualizarHeader(); // MOVIDO para DOMContentLoaded
        }

        if (localStorage.getItem('carrinho')) {
            carrinho = JSON.parse(localStorage.getItem('carrinho'));
            // atualizarCarrinhoBadge(); // MOVIDO para DOMContentLoaded
        }

        // ==================== FUNÇÕES AUXILIARES ==================== //
        function salvarUsuarioLogado() {
            if (usuarioLogado) {
                localStorage.setItem('usuarioLogado', JSON.stringify(usuarioLogado));
                salvarUsuarioFirebase(usuarioLogado); // Salvar também no Firebase
            } else {
                localStorage.removeItem('usuarioLogado');
            }
        }

        function salvarCarrinho() {
            localStorage.setItem('carrinho', JSON.stringify(carrinho));
        }

        function mostrarToast(texto, tipo = 'sucesso', duracao = 4000) {
            const toast = document.getElementById('toastMessage');
            toast.textContent = texto;
            toast.className = `toast toast-${tipo}`;
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, duracao);
        }

        function mostrarMissao(nomeCaso) {
            const toast = document.getElementById('toastMessage');
            toast.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 2.5rem; margin-bottom: 15px;">🎯</div>
                    <div style="font-size: 1.4rem; margin-bottom: 15px; font-weight: 900;">NOVA MISSÃO ATRIBUÍDA</div>
                    <div style="line-height: 1.8;">
                        Detetive <strong>${usuarioLogado.nome}</strong>,<br>
                        Você foi designado para resolver o caso<br>
                        <strong>"${nomeCaso}"</strong><br><br>
                        Analise as evidências com cuidado.<br>
                        A verdade está esperando por você.
                    </div>
                </div>
            `;
            toast.className = 'toast toast-missao';
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 7000);
        }

        function mostrarConquista(conquista) {
            const toast = document.getElementById('toastMessage');
            const emojis = {
                'Lupa de Ouro': '🥇',
                'Lupa de Prata': '🥈',
                'Lupa de Bronze': '🥉',
                'Ajudante de Honra': '🎖️',
                'Advertido Pelo Departamento': '⚠️'
            };
            toast.innerHTML = `
                <div style="position: relative;">
                    <button onclick="document.getElementById('toastMessage').classList.add('hidden')" style="position: absolute; top: -10px; right: -10px; background: rgba(0,0,0,0.5); border: none; color: white; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; font-weight: 700;">×</button>
                    <div style="text-align: center;">
                        <div style="font-size: 3rem; margin-bottom: 10px;">${emojis[conquista] || '🏆'}</div>
                        <div style="font-size: 1.8rem; font-weight: 900;">NOVA CONQUISTA!</div>
                        <div style="font-size: 1.3rem; margin-top: 10px;">${conquista}</div>
                    </div>
                </div>
            `;
            toast.className = 'toast toast-conquista';
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 5000);
        }

        function mostrarPromocao(patente) {
            const toast = document.getElementById('toastMessage');
            toast.innerHTML = `
                <div style="position: relative;">
                    <button onclick="document.getElementById('toastMessage').classList.add('hidden')" style="position: absolute; top: -10px; right: -10px; background: rgba(0,0,0,0.5); border: none; color: white; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; font-weight: 700;">×</button>
                    <div style="text-align: center;">
                        <div style="font-size: 3rem; margin-bottom: 10px;">⭐</div>
                        <div style="font-size: 1.8rem; font-weight: 900;">PROMOÇÃO!</div>
                        <div style="font-size: 1.4rem; margin-top: 10px;">Você agora é<br><strong>${patente}</strong></div>
                    </div>
                </div>
            `;
            toast.className = 'toast toast-conquista';
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 5000);
        }
        
        function mostrarModalCompra(pontosGanhos, quantidadeCasos) {
            const toast = document.getElementById('toastMessage');
            toast.innerHTML = `
                <div style="animation: fadeInBounce 0.6s ease-out;">
                    <div style="text-align: center;">
                        <div style="font-size: 5rem; margin-bottom: 20px;">🎉</div>
                        <div style="font-size: 2.2rem; font-weight: 900; color: var(--amarelo); margin-bottom: 20px; font-family: Montserrat;">
                            COMPRA REALIZADA!
                        </div>
                        <div style="font-size: 1.4rem; line-height: 1.9; margin-bottom: 25px; color: #FFFFFF;">
                            ${quantidadeCasos} ${quantidadeCasos > 1 ? 'casos adquiridos' : 'caso adquirido'} com sucesso!<br>
                            <strong style="color: var(--verde); font-size: 1.6rem;">+${pontosGanhos} pontos</strong>
                        </div>
                        <div style="font-size: 1.05rem; color: #aaaaaa; margin-bottom: 30px; line-height: 1.6;">
                            Os casos foram adicionados à sua área do detetive.<br>
                            Boa sorte nas investigações! 🕵️
                        </div>
                        <button 
                            onclick="document.getElementById('toastMessage').classList.add('hidden'); navegarPara('area-detetive');" 
                            style="background: var(--amarelo); color: #000; border: none; padding: 18px 50px; font-size: 1.3rem; font-weight: 900; border-radius: 10px; cursor: pointer; font-family: Montserrat; transition: all 0.3s; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);"
                            onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 25px rgba(255, 215, 0, 0.6)';"
                            onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 15px rgba(255, 215, 0, 0.4)';">
                            IR PARA MEUS CASOS
                        </button>
                    </div>
                </div>
            `;
            toast.className = 'toast toast-sucesso';
            toast.style.animation = 'fadeInBounce 0.6s ease-out';
            toast.classList.remove('hidden');
        }
        
        function mostrarCasoNaoSolucionado(pontosRestantes) {
            const toast = document.getElementById('toastMessage');
            
            // Adiciona conquista de advertência
            if (!usuarioLogado.conquistasContador) {
                usuarioLogado.conquistasContador = {};
            }
            if (!usuarioLogado.conquistasContador['Advertido Pelo Departamento']) {
                usuarioLogado.conquistasContador['Advertido Pelo Departamento'] = 0;
            }
            usuarioLogado.conquistasContador['Advertido Pelo Departamento']++;
            salvarUsuarioLogado();
            
            toast.innerHTML = `
                <div style="animation: fadeInBounce 0.5s ease-out, shake 0.6s ease-in-out 0.5s;">
                    <div style="text-align: center;">
                        <div style="font-size: 5rem; margin-bottom: 20px;">❌</div>
                        <div style="font-size: 2.2rem; font-weight: 900; color: #ff4444; margin-bottom: 20px; font-family: Montserrat;">
                            CASO NÃO SOLUCIONADO
                        </div>
                        <div style="font-size: 1.3rem; line-height: 1.9; margin-bottom: 25px; color: #FFFFFF;">
                            Você esgotou todas as 5 tentativas sem resolver o caso.<br>
                            <strong style="color: #ff4444; font-size: 1.5rem;">-50 pontos</strong>
                        </div>
                        <div style="background: rgba(255, 68, 68, 0.15); padding: 20px; border-radius: 12px; border: 2px solid #ff4444; margin-bottom: 25px;">
                            <div style="font-size: 2rem; margin-bottom: 8px;">⚠️</div>
                            <div style="font-size: 1.4rem; font-weight: 900; color: #ff4444; margin-bottom: 5px;">ADVERTÊNCIA OFICIAL</div>
                            <div style="font-size: 1rem; color: #aaaaaa;">Departamento de Investigação Criminal</div>
                        </div>
                        <div style="font-size: 1.1rem; color: #aaaaaa; margin-bottom: 25px; line-height: 1.7;">
                            📊 Pontuação atual: <strong style="color: var(--amarelo);">${pontosRestantes} pontos</strong><br>
                            🏆 Patente desbloqueada: <strong style="color: #ff4444;">Advertido Pelo Departamento</strong> (${usuarioLogado.conquistasContador['Advertido Pelo Departamento']}x)
                        </div>
                        <div style="font-size: 1rem; color: #888888; margin-bottom: 30px; line-height: 1.6;">
                            💡 Dica: Revise as provas e depoimentos cuidadosamente.<br>
                            Tire dúvidas com o Delegado Virtual antes de tentar novamente.
                        </div>
                        <button 
                            onclick="document.getElementById('toastMessage').classList.add('hidden'); navegarPara('area-detetive');" 
                            style="background: var(--amarelo); color: #000; border: none; padding: 18px 50px; font-size: 1.3rem; font-weight: 900; border-radius: 10px; cursor: pointer; font-family: Montserrat; transition: all 0.3s; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);"
                            onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 25px rgba(255, 215, 0, 0.6)';"
                            onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 15px rgba(255, 215, 0, 0.4)';">
                            CONTINUAR
                        </button>
                    </div>
                </div>
            `;
            toast.className = 'toast toast-erro';
            toast.style.animation = 'fadeInBounce 0.5s ease-out, shake 0.6s ease-in-out 0.5s';
            toast.classList.remove('hidden');
        }

        function mostrarSuccessOverlay(pontos, tag, patenteNova) {
            const overlay = document.getElementById('successOverlay');
            const text = document.getElementById('successText');
            
            // Informações de tag
            const emojisTag = {
                'Lupa de Ouro': '🥇',
                'Lupa de Prata': '🥈',
                'Lupa de Bronze': '🥉',
                'Ajudante de Honra': '🎖️',
                'Advertido Pelo Departamento': '⚠️'
            };
            const quantidadeTag = usuarioLogado.conquistasContador?.[tag] || 0;
            
            text.innerHTML = `
                <div style="font-size: 2.5rem; font-weight: 900; margin-bottom: 20px;">🎉 CASO RESOLVIDO! 🎉</div>
                <div style="font-size: 1.5rem; margin-bottom: 30px;">
                    Você ganhou <strong style="color: var(--amarelo);">${pontos} pontos</strong>!
                </div>
                ${tag ? `
                    <div style="background: rgba(255, 215, 0, 0.1); padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 2px solid var(--amarelo);">
                        <div style="font-size: 3rem; margin-bottom: 10px;">${emojisTag[tag] || '🏆'}</div>
                        <div style="font-size: 1.4rem; font-weight: 900; margin-bottom: 8px;">TAG DESBLOQUEADA ${quantidadeTag > 1 ? '#' + quantidadeTag : ''}!</div>
                        <div style="font-size: 1.2rem;">${tag}</div>
                    </div>
                ` : ''}
                ${patenteNova ? `
                    <div style="background: rgba(255, 215, 0, 0.15); padding: 20px; border-radius: 12px; border: 2px solid var(--amarelo);">
                        <div style="font-size: 2.5rem; margin-bottom: 10px;">⭐</div>
                        <div style="font-size: 1.4rem; font-weight: 900; margin-bottom: 8px;">PROMOÇÃO!</div>
                        <div style="font-size: 1.2rem;">Você agora é<br><strong>${patenteNova}</strong></div>
                    </div>
                ` : ''}
            `;
            
            overlay.classList.add('active');
            
            // Criar confetes
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = ['#FFD700', '#4CAF50', '#2196F3', '#E53935'][Math.floor(Math.random() * 4)];
                    confetti.style.animationDelay = Math.random() * 2 + 's';
                    overlay.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 50);
            }
        }

        function fecharSuccessOverlay() {
            const overlay = document.getElementById('successOverlay');
            overlay.classList.remove('active');
            navegarPara('ver-solucao', {casoJogo: casoEmJogo});
        }

        function formatarTempoCompleto(segundos) {
            const horas = Math.floor(segundos / 3600);
            const minutos = Math.floor((segundos % 3600) / 60);
            const segs = segundos % 60;
            return `${String(horas).padStart(2, '0')}:${String(minutos).padStart(2, '0')}:${String(segs).padStart(2, '0')}`;
        }

        function calcularPatente(casosResolvidos) {
            if (casosResolvidos === 0) return 'Detetive Júnior';
            if (casosResolvidos === 1) return 'Sargento';
            if (casosResolvidos >= 3 && casosResolvidos < 5) return 'Inspetor';
            if (casosResolvidos >= 5 && casosResolvidos < 10) return 'Inspetor-Chefe';
            if (casosResolvidos >= 10) return 'Lenda: Sherlock Holmes';
            return 'Detetive Júnior';
        }
        
        function getIconePatente(patente) {
            const icones = {
                'Detetive Júnior': '🔰',
                'Sargento': '⭐',
                'Inspetor': '🎖️',
                'Inspetor-Chefe': '🏆',
                'Lenda: Sherlock Holmes': '👑'
            };
            return icones[patente] || '🔰';
        }

        // ==================== NAVEGAÇÃO ==================== //
        function navegarPara(pagina, dados = null) {
            console.log(`📍 Navegando para: ${pagina}`);
            paginaAtual = pagina;
            if (dados) {
                if (dados.caso) casoSelecionado = dados.caso;
                if (dados.casoJogo) casoEmJogo = dados.casoJogo;
            }
            renderizarPagina();
            window.scrollTo(0, 0);
            
            // Inicializa validações se estiver na página de cadastro
            if (pagina === 'cadastro') {
                inicializarValidacoes();
            }
        }

        function mudarAba(aba) {
            subPaginaDetetive = aba;
            renderizarPagina();
        }

        function atualizarHeader() {
            if (usuarioLogado) {
                document.getElementById('btnLogin').classList.add('hidden');
                document.getElementById('btnAreaDetetive').classList.remove('hidden');
                document.getElementById('btnPerfil').classList.remove('hidden');
                document.getElementById('btnCarrinho').classList.remove('hidden');
                document.getElementById('btnSair').classList.remove('hidden');
            } else {
                document.getElementById('btnLogin').classList.remove('hidden');
                document.getElementById('btnAreaDetetive').classList.add('hidden');
                document.getElementById('btnPerfil').classList.add('hidden');
                document.getElementById('btnCarrinho').classList.add('hidden');
                document.getElementById('btnSair').classList.add('hidden');
            }
        }

        function atualizarCarrinhoBadge() {
            const badge = document.getElementById('cartBadge');
            if (carrinho.length > 0) {
                badge.textContent = carrinho.length;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        // ==================== LOGIN/CADASTRO ==================== //
        async function fazerLogin(email, senha) {
            const usuario = await buscarUsuarioFirebase(email);
            
            if (usuario && usuario.senha === senha) {
                usuarioLogado = usuario;
                localStorage.setItem('usuarioLogado', JSON.stringify(usuarioLogado));
                atualizarHeader();
                navegarPara('home');
                mostrarToast('Login realizado com sucesso!', 'sucesso');
            } else {
                mostrarToast('Email ou senha incorretos!', 'erro');
            }
        }

        async function fazerCadastro(nome, email, senha, telefone) {
            if (!nome || !email || !senha || !telefone) {
                mostrarToast('Preencha todos os campos!', 'erro');
                return;
            }
            
            // Verificar se email já existe
            const usuarioExistente = await buscarUsuarioFirebase(email);
            if (usuarioExistente) {
                mostrarToast('Email já cadastrado!', 'erro');
                return;
            }
            
            const novoUsuario = {
                id: Date.now(),
                nome: nome,
                email: email,
                senha: senha,
                telefone: telefone,
                pontos: 0,
                casosResolvidos: 0,
                casosComprados: [],
                conquistas: [],
                patente: 'Detetive Júnior'
            };
            
            await salvarUsuarioFirebase(novoUsuario);
            
            usuarioLogado = novoUsuario;
            localStorage.setItem('usuarioLogado', JSON.stringify(usuarioLogado));
            atualizarHeader();
            navegarPara('home');
            mostrarToast('Cadastro realizado!', 'sucesso');
        }

        function fazerLogout() {
            usuarioLogado = null;
            salvarUsuarioLogado();
            carrinho = [];
            salvarCarrinho();
            atualizarHeader();
            atualizarCarrinhoBadge();
            navegarPara('home');
            mostrarToast('Até logo!', 'aviso');
        }

        function executarLogin() {
            const email = document.getElementById('emailLogin').value;
            const senha = document.getElementById('senhaLogin').value;
            fazerLogin(email, senha);
        }

        function executarCadastro() {
            const nomeInput = document.getElementById('nomeCadastro');
            const emailInput = document.getElementById('emailCadastro');
            const senhaInput = document.getElementById('senhaCadastro');
            const telefoneInput = document.getElementById('telefoneCadastro');
            const confirmarSenhaInput = document.getElementById('confirmarSenha');
            
            // Valida todos os campos
            const nomeValido = validarNome(nomeInput);
            const emailValido = validarEmail(emailInput);
            const telefoneValido = validarTelefone(telefoneInput);
            const senhaValida = validarSenha(senhaInput);
            const confirmacaoValida = validarConfirmacaoSenha(confirmarSenhaInput);
            
            // Verifica se todos os campos estão válidos
            if (!nomeValido || !emailValido || !telefoneValido || !senhaValida || !confirmacaoValida) {
                mostrarToast('⚠️ Por favor, corrija os campos inválidos antes de continuar.', 'erro');
                return;
            }
            
            // Se tudo válido, prossegue com o cadastro
            const nome = nomeInput.value;
            const email = emailInput.value;
            const senha = senhaInput.value;
            const telefone = telefoneInput.value;
            
            fazerCadastro(nome, email, senha, telefone);
        }

        // ==================== CARRINHO ==================== //
        function adicionarAoCarrinho(caso, versao) {
            if (!usuarioLogado) {
                mostrarToast('Faça login primeiro!', 'erro');
                navegarPara('login');
                return;
            }
            
            const itemExiste = carrinho.find(item => item.casoId === caso.id && item.versao === versao);
            if (itemExiste) {
                mostrarToast('Já está no carrinho!', 'aviso');
                return;
            }
            
            carrinho.push({
                id: Date.now(),
                casoId: caso.id,
                titulo: caso.titulo,
                versao: versao,
                preco: versao === 'digital' ? caso.precoDigital : caso.precoFisico,
                caso: caso
            });
            
            salvarCarrinho();
            atualizarCarrinhoBadge();
            mostrarToast('Caso adicionado ao carrinho!', 'sucesso');
        }

        function removerDoCarrinho(itemId) {
            carrinho = carrinho.filter(item => item.id !== itemId);
            salvarCarrinho();
            atualizarCarrinhoBadge();
            renderizarPagina();
            mostrarToast('Item removido', 'aviso');
        }

        function finalizarCompra() {
            if (!usuarioLogado) {
                navegarPara('login');
                return;
            }

            const novosCasos = carrinho.map(item => ({
                ...item.caso,
                versao: item.versao,
                dataCompra: new Date().toISOString(),
                iniciado: false,
                tentativas: 0,
                resolvido: false,
                tempoAcumulado: 0
            }));

            // Adiciona 100 pontos por compra
            const pontosCompra = carrinho.length * 100;
            const quantidadeCasos = carrinho.length;
            usuarioLogado.pontos += pontosCompra;
            
            usuarioLogado.casosComprados = [...(usuarioLogado.casosComprados || []), ...novosCasos];
            salvarUsuarioLogado();

            carrinho = [];
            salvarCarrinho();
            atualizarCarrinhoBadge();

            // Modal centralizado
            mostrarModalCompra(pontosCompra, quantidadeCasos);
            
            // Mostrar missões após fechar modal
            novosCasos.forEach((caso, index) => {
                setTimeout(() => {
                    mostrarMissao(caso.titulo);
                }, (index + 1) * 5000);
            });
        }

        function selecionarVersao(versao) {
            versaoSelecionada = versao;
            const digital = document.getElementById('versaoDigital');
            const fisica = document.getElementById('versaoFisica');
            
            if (versao === 'digital') {
                digital.style.border = '3px solid var(--amarelo)';
                digital.style.background = 'rgba(255, 215, 0, 0.1)';
                fisica.style.border = '2px solid #333333';
                fisica.style.background = '#1a1a1a';
            } else {
                fisica.style.border = '3px solid var(--amarelo)';
                fisica.style.background = 'rgba(255, 215, 0, 0.1)';
                digital.style.border = '2px solid #333333';
                digital.style.background = '#1a1a1a';
            }
        }

        function adicionarCasoAoCarrinho() {
            adicionarAoCarrinho(casoSelecionado, versaoSelecionada);
        }

        // ==================== PERFIL ==================== //
        function salvarPerfil() {
            const novoNome = document.getElementById('perfilNome').value;
            const novaSenha = document.getElementById('perfilSenha').value;
            
            if (!novoNome) {
                mostrarToast('Nome não pode estar vazio!', 'erro');
                return;
            }
            
            usuarioLogado.nome = novoNome;
            if (novaSenha) {
                usuarioLogado.senha = novaSenha;
            }
            
            salvarUsuarioLogado();
            dadosOriginaisPerfil = {nome: novoNome, senha: novaSenha};
            mostrarToast('Perfil atualizado!', 'sucesso');
        }

        function cancelarEdicaoPerfil() {
            if (dadosOriginaisPerfil) {
                document.getElementById('perfilNome').value = dadosOriginaisPerfil.nome;
                document.getElementById('perfilSenha').value = '';
            }
            mostrarToast('Alterações canceladas', 'aviso');
        }

        // ==================== JOGAR CASO ==================== //
        function iniciarCaso(caso) {
            const index = usuarioLogado.casosComprados.findIndex(c => c.id === caso.id);
            if (index !== -1) {
                usuarioLogado.casosComprados[index].iniciado = true;
                usuarioLogado.casosComprados[index].tempoInicio = Date.now();
                salvarUsuarioLogado();
            }
        }

        function jogarCaso(caso) {
            casoEmJogo = caso;
            
            // Sistema de tempo persistente com timestamp
            const index = usuarioLogado.casosComprados.findIndex(c => c.id === caso.id);
            
            if (!caso.tempoInicio) {
                // Primeira vez: salva timestamp inicial
                caso.tempoInicio = Date.now();
                if (index !== -1) {
                    usuarioLogado.casosComprados[index].tempoInicio = caso.tempoInicio;
                    salvarUsuarioLogado();
                }
            }
            
            // Calcula tempo decorrido desde o início
            tempoDecorrido = Math.floor((Date.now() - caso.tempoInicio) / 1000);
            
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                tempoDecorrido = Math.floor((Date.now() - caso.tempoInicio) / 1000);
                const timerEl = document.getElementById('timer');
                if (timerEl) {
                    timerEl.textContent = formatarTempoCompleto(tempoDecorrido);
                }
            }, 1000);
            
            navegarPara('jogar-caso', {casoJogo: caso});
        }

        function validarResposta() {
            const assassino = document.getElementById('selectAssassino').value;
            const arma = document.getElementById('selectArma').value;
            const motivo = document.getElementById('selectMotivo').value;
            const local = document.getElementById('selectLocal').value;

            if (!assassino || !arma || !motivo || !local) {
                mostrarToast('Preencha todos os campos!', 'erro');
                return;
            }

            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }

            const tentativasAtuais = (casoEmJogo.tentativas || 0) + 1;
            const acertou = 
                assassino === casoEmJogo.solucao.assassino &&
                arma === casoEmJogo.solucao.arma &&
                motivo === casoEmJogo.solucao.motivo &&
                local === casoEmJogo.solucao.local;

            const index = usuarioLogado.casosComprados.findIndex(c => c.id === casoEmJogo.id);
            
            // SINCRONIZAÇÃO IMEDIATA: Atualiza tentativas ANTES de qualquer lógica
            if (index !== -1) {
                usuarioLogado.casosComprados[index].tentativas = tentativasAtuais;
                casoEmJogo.tentativas = tentativasAtuais;
                salvarUsuarioLogado();
            }
            
            if (acertou) {
                // Sistema de pontuação
                const pontosPorTentativa = {1: 500, 2: 400, 3: 300, 4: 200, 5: 100};
                let pontosGanhos = pontosPorTentativa[tentativasAtuais] || 50;
                
                // Bônus de tempo (tags)
                const tempoLimite = casoEmJogo.tempoLimite * 60;
                let tagGanha = null;
                let bonusTempo = 0;
                
                if (tempoDecorrido < tempoLimite) {
                    const tagsMap = {
                        1: {nome: 'Lupa de Ouro', bonus: 150},
                        2: {nome: 'Lupa de Prata', bonus: 120},
                        3: {nome: 'Lupa de Bronze', bonus: 100},
                        4: {nome: 'Ajudante de Honra', bonus: 90},
                        5: {nome: 'Advertido Pelo Departamento', bonus: 70}
                    };
                    
                    if (tagsMap[tentativasAtuais]) {
                        tagGanha = tagsMap[tentativasAtuais].nome;
                        bonusTempo = tagsMap[tentativasAtuais].bonus;
                        pontosGanhos += bonusTempo;
                        
                        // Sistema de conquistas acumulativas
                        if (!usuarioLogado.conquistasContador) {
                            usuarioLogado.conquistasContador = {};
                        }
                        if (!usuarioLogado.conquistasContador[tagGanha]) {
                            usuarioLogado.conquistasContador[tagGanha] = 0;
                        }
                        usuarioLogado.conquistasContador[tagGanha]++;
                    }
                }

                usuarioLogado.casosComprados[index].resolvido = true;
                usuarioLogado.casosComprados[index].tentativas = tentativasAtuais;
                usuarioLogado.casosComprados[index].tempoTotal = tempoDecorrido;
                usuarioLogado.casosComprados[index].pontosGanhos = pontosGanhos;
                usuarioLogado.casosComprados[index].tagGanha = tagGanha;
                
                const patenteAnterior = usuarioLogado.patente;
                usuarioLogado.casosResolvidos++;
                usuarioLogado.pontos += pontosGanhos;
                
                // Promoções de patente
                usuarioLogado.patente = calcularPatente(usuarioLogado.casosResolvidos);
                
                let patenteNova = null;
                if (patenteAnterior !== usuarioLogado.patente) {
                    const bonusPatente = {
                        'Sargento': 200,
                        'Inspetor': 250,
                        'Inspetor-Chefe': 300,
                        'Lenda: Sherlock Holmes': 500
                    };
                    const bonus = bonusPatente[usuarioLogado.patente] || 0;
                    usuarioLogado.pontos += bonus;
                    patenteNova = usuarioLogado.patente;
                }
                
                salvarUsuarioLogado();
                
                // IMPORTANTE: Atualizar casoEmJogo com os dados mais recentes
                casoEmJogo = JSON.parse(JSON.stringify(usuarioLogado.casosComprados[index]));
                
                // Mostrar overlay de sucesso com tudo junto
                mostrarSuccessOverlay(pontosGanhos, tagGanha, patenteNova);
                
            } else {
                if (tentativasAtuais >= 5) {
                    usuarioLogado.casosComprados[index].naoSolucionado = true;
                    usuarioLogado.casosComprados[index].tentativas = tentativasAtuais;
                    usuarioLogado.pontos -= 50;
                    salvarUsuarioLogado();
                    
                    mostrarCasoNaoSolucionado(usuarioLogado.pontos);
                    
                } else {
                    usuarioLogado.casosComprados[index].tentativas = tentativasAtuais;
                    usuarioLogado.casosComprados[index].tempoAcumulado = tempoDecorrido;
                    salvarUsuarioLogado();
                    
                    casoEmJogo = usuarioLogado.casosComprados[index];
                    
                    // Mensagem com dica
                    const toast = document.getElementById('toastMessage');
                    toast.innerHTML = `
                        <div style="text-align: center; line-height: 1.8;">
                            <div style="font-size: 2rem; margin-bottom: 10px;">❌</div>
                            <div style="font-size: 1.3rem; margin-bottom: 15px; font-weight: 900;">CASO NÃO SOLUCIONADO</div>
                            <div style="font-size: 1rem;">
                                Tentativa ${tentativasAtuais}/5<br><br>
                                Revise as provas e depoimentos.<br>
                                Tire dúvidas com o Delegado Virtual.
                            </div>
                        </div>
                    `;
                    toast.className = 'toast toast-erro';
                    toast.classList.remove('hidden');
                    
                    setTimeout(() => {
                        toast.classList.add('hidden');
                    }, 6000);
                    
                    document.getElementById('selectAssassino').value = '';
                    document.getElementById('selectArma').value = '';
                    document.getElementById('selectMotivo').value = '';
                    document.getElementById('selectLocal').value = '';
                    document.getElementById('modalFormulario').classList.remove('active');
                    
                    if (timerInterval) clearInterval(timerInterval);
                    timerInterval = setInterval(() => {
                        tempoDecorrido++;
                        const timerEl = document.getElementById('timer');
                        if (timerEl) {
                            timerEl.textContent = formatarTempoCompleto(tempoDecorrido);
                        }
                    }, 1000);
                }
            }
        }

        // ==================== RENDERIZAÇÃO ==================== //
        function renderizarPagina() {
            console.log(`🎬 Renderizando: ${paginaAtual}`);
            const content = document.getElementById('app-content');
            
            if (timerInterval && paginaAtual !== 'jogar-caso') {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            switch(paginaAtual) {
                case 'home':
                    content.innerHTML = renderHome();
                    break;
                case 'login':
                    content.innerHTML = renderLogin();
                    break;
                case 'cadastro':
                    content.innerHTML = renderCadastro();
                    break;
                case 'casos':
                    content.innerHTML = renderCasos();
                    break;
                case 'caso-detalhe':
                    content.innerHTML = renderCasoDetalhe();
                    break;
                case 'carrinho':
                    content.innerHTML = renderCarrinho();
                    break;
                case 'checkout':
                    content.innerHTML = renderCheckout();
                    break;
                case 'area-detetive':
                    content.innerHTML = renderAreaDetetive();
                    break;
                case 'perfil':
                    content.innerHTML = renderPerfil();
                    break;
                case 'ajuda':
                    content.innerHTML = renderAjuda();
                    break;
                case 'jogar-caso':
                    content.innerHTML = renderJogarCaso();
                    break;
                case 'ver-solucao':
                    content.innerHTML = renderVerSolucao();
                    break;
                case 'ranking':
                    content.innerHTML = renderRanking();
                    break;
                default:
                    content.innerHTML = renderHome();
            }
        }

        function renderHome() {
            return `
                <section class="hero">
                    <div class="hero-content">
                        <div style="font-family: 'Montserrat', sans-serif; font-weight: 900; font-size: 4rem; color: #FFD700; text-align: center; margin-bottom: 30px;">FATTO CRIMINAL</div>
                        <p class="hero-slogan">Jogos de Mistério e Investigação</p>
                        <div class="hero-buttons">
                            <button class="btn-primary" onclick="navegarPara('casos')">
                                Ver Casos
                            </button>
                            <button class="btn-secondary" onclick="navegarPara('${usuarioLogado ? 'area-detetive' : 'login'}')">
                                Minha Área
                            </button>
                        </div>
                    </div>
                </section>

                <section class="section section-alt">
                    <h2 class="section-title">Casos em Destaque</h2>
                    <p class="section-subtitle">Os mistérios mais desafiadores</p>
                    <div class="casos-grid">
                        ${casos.filter(c => c.destaque).map(caso => `
                            <div class="case-card" onclick='navegarPara("caso-detalhe", {caso: ${JSON.stringify(caso).replace(/'/g, "\\'")}})'>
                                <img src="${caso.banner}" alt="${caso.titulo}" class="case-banner" />
                                <div class="case-content">
                                    <h3 class="case-title">${caso.titulo}</h3>
                                    <p class="case-subtitle">${caso.subtitulo}</p>
                                    <div class="case-tags">
                                        <span class="case-tag">
                                            <span class="case-tag-icon ${caso.nivelCor}">⚡</span>
                                            ${caso.dificuldade}
                                        </span>
                                        <span class="case-tag">🕐 ${formatarTempo(caso.tempoLimite)}</span>
                                        <span class="case-tag">🎯 ${caso.classificacao}</span>
                                        <span class="case-tag">👥 ${caso.jogadores}</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 25px; padding-top: 25px; border-top: 1px solid var(--cinza-medio);">
                                        <div class="case-price">R$ ${caso.precoDigital.toFixed(2)}</div>
                                        <button class="btn-primary" style="padding: 12px 28px;" onclick='event.stopPropagation(); navegarPara("caso-detalhe", {caso: ${JSON.stringify(caso).replace(/'/g, "\\'")}})'>
                                            Ver caso
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div style="text-align: center; margin-top: 60px;">
                        <button class="btn-primary" onclick="navegarPara('casos')" style="padding: 18px 50px; font-size: 1.1rem;">
                            Ver Todos os Casos
                        </button>
                    </div>
                </section>

                <section class="section">
                    <h2 class="section-title">Como Funciona?</h2>
                    <p class="section-subtitle">Entenda as etapas para desvendar um crime</p>
                    <div style="max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 50px; margin-top: 60px;">
                        ${[
                            {emoji: '🔍', titulo: 'Explore as Provas', desc: 'Tenha acesso a arquivos confidenciais, laudos técnicos e evidências. Cada item é uma peça-chave no quebra-cabeça.'},
                            {emoji: '🌐', titulo: 'Vá Além do Básico', desc: 'Algumas pistas estão escondidas em fontes digitais externas. Analise tudo com atenção e conecte os pontos.'},
                            {emoji: '🎯', titulo: 'Monte sua Teoria', desc: 'Com a dedução final em mãos, apresente-a para o nosso Delegado Virtual e verifique se você acertou.'}
                        ].map(item => `
                            <div style="text-align: center; padding: 40px 20px;">
                                <div style="font-size: 4rem; margin-bottom: 25px;">${item.emoji}</div>
                                <h3 style="font-family: Montserrat; font-size: 1.6rem; color: #FFFFFF; margin-bottom: 20px; font-weight: 700;">${item.titulo}</h3>
                                <p style="color: #aaaaaa; line-height: 1.8; font-size: 1.05rem;">${item.desc}</p>
                            </div>
                        `).join('')}
                    </div>
                </section>
            `;
        }

        function renderLogin() {
            return `
                <div class="page-content" style="min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 140px 40px 80px;">
                    <div style="background: #1a1a1a; border-radius: 12px; padding: 60px; max-width: 500px; width: 100%; box-shadow: 0 10px 40px rgba(0,0,0,0.1);">
                        <h2 style="font-family: Montserrat; color: #FFFFFF; font-size: 2.5rem; text-align: center; margin-bottom: 50px; font-weight: 700;">Login</h2>
                        
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" id="emailLogin" placeholder="seu@email.com" />
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Senha</label>
                            <input type="password" id="senhaLogin" placeholder="••••••••" onkeypress="if(event.key === 'Enter') executarLogin()" />
                        </div>
                        
                        <button class="btn-primary" style="width: 100%; margin-top: 30px;" onclick="executarLogin()">
                            Entrar
                        </button>
                        
                        <p style="text-align: center; margin-top: 30px; color: #aaaaaa; cursor: pointer;" onclick="navegarPara('cadastro')">
                            Não tem conta? <strong style="color: #FFFFFF;">Cadastre-se aqui</strong>
                        </p>
                    </div>
                </div>
            `;
        }

        function renderCadastro() {
            return `
                <div class="page-content" style="min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 140px 40px 80px;">
                    <div style="background: #1a1a1a; border-radius: 12px; padding: 60px; max-width: 500px; width: 100%; box-shadow: 0 10px 40px rgba(0,0,0,0.1);">
                        <h2 style="font-family: Montserrat; color: #FFFFFF; font-size: 2.5rem; text-align: center; margin-bottom: 50px; font-weight: 700;">Cadastro</h2>
                        
                        <div class="form-group">
                            <label class="form-label">Nome / Nick</label>
                            <div class="input-wrapper">
                                <input type="text" id="nomeCadastro" placeholder="Seu nome ou apelido" maxlength="30" />
                                <span class="input-icon">✓</span>
                            </div>
                            <div class="input-feedback"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <div class="input-wrapper">
                                <input type="email" id="emailCadastro" placeholder="seu@email.com" />
                                <span class="input-icon">✓</span>
                            </div>
                            <div class="input-feedback"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Telefone</label>
                            <div class="input-wrapper">
                                <input type="tel" id="telefoneCadastro" placeholder="(00) 00000-0000" maxlength="15" />
                                <span class="input-icon">✓</span>
                            </div>
                            <div class="input-feedback"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Senha</label>
                            <div class="input-wrapper">
                                <input type="password" id="senhaCadastro" placeholder="••••••••" />
                            </div>
                            <div class="password-strength">
                                <div class="strength-bar">
                                    <div class="strength-bar-fill" id="senha-strength-bar"></div>
                                </div>
                                <div class="strength-text" id="senha-strength-text"></div>
                            </div>
                            <div class="input-feedback"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Confirmar Senha</label>
                            <div class="input-wrapper">
                                <input type="password" id="confirmarSenha" placeholder="••••••••" onkeypress="if(event.key === 'Enter') executarCadastro()" />
                                <span class="input-icon">✓</span>
                            </div>
                            <div class="input-feedback"></div>
                        </div>
                        
                        <button class="btn-primary" style="width: 100%;" onclick="executarCadastro()">
                            Cadastrar
                        </button>
                        
                        <p style="text-align: center; margin-top: 30px; color: #aaaaaa; cursor: pointer;" onclick="navegarPara('login')">
                            Já tem conta? <strong style="color: #FFFFFF;">Faça login</strong>
                        </p>
                    </div>
                </div>
            `;
        }
        
        // Função para formatar tempo (converte minutos em horas se >= 60)
        function formatarTempo(minutos) {
            if (minutos >= 60) {
                const horas = minutos / 60;
                return `${horas}h`;
            }
            return `${minutos}min`;
        }

        function renderCasos() {
            return `
                <section class="section page-content">
                    <h2 class="section-title">Todos os Casos</h2>
                    <p class="section-subtitle">6 mistérios para desvendar</p>

                    <div class="casos-grid" style="margin-top: 60px;">
                        ${casos.map(caso => `
                            <div class="case-card" onclick='navegarPara("caso-detalhe", {caso: ${JSON.stringify(caso).replace(/'/g, "\\'")}})'>
                                <img src="${caso.banner}" alt="${caso.titulo}" class="case-banner" />
                                <div class="case-content">
                                    <h3 class="case-title">${caso.titulo}</h3>
                                    <p class="case-subtitle">${caso.subtitulo}</p>
                                    <div class="case-tags">
                                        <span class="case-tag">
                                            <span class="case-tag-icon ${caso.nivelCor}">⚡</span>
                                            ${caso.dificuldade}
                                        </span>
                                        <span class="case-tag">🕐 ${formatarTempo(caso.tempoLimite)}</span>
                                        <span class="case-tag">🎯 ${caso.classificacao}</span>
                                        <span class="case-tag">👥 ${caso.jogadores}</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 25px; padding-top: 25px; border-top: 1px solid var(--cinza-medio);">
                                        <div class="case-price">R$ ${caso.precoDigital.toFixed(2)}</div>
                                        <button class="btn-primary" style="padding: 12px 28px;" onclick='event.stopPropagation(); navegarPara("caso-detalhe", {caso: ${JSON.stringify(caso).replace(/'/g, "\\'")}})'>Ver caso</button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </section>
            `;
        }

        function renderCasoDetalhe() {
            if (!casoSelecionado) {
                navegarPara('casos');
                return '';
            }

            return `
                <div class="page-content">
                    <div style="background: var(--cinza-claro); padding: 100px 40px 80px; text-align: center;">
                        <div style="max-width: 1000px; margin: 0 auto;">
                            <div style="display: inline-block; background: var(--amarelo); color: #FFFFFF; padding: 8px 20px; border-radius: 20px; font-weight: 700; font-size: 0.9rem; margin-bottom: 25px;">${casoSelecionado.numero}</div>
                            <h1 style="font-family: Montserrat; font-size: 3.5rem; color: #FFFFFF; margin-bottom: 20px; font-weight: 700;">${casoSelecionado.titulo}</h1>
                            <p style="font-size: 1.5rem; color: #aaaaaa;">${casoSelecionado.subtitulo}</p>
                        </div>
                    </div>

                    <section class="section">
                        <div style="max-width: 1200px; margin: 0 auto;">
                            <div style="background: #1a1a1a; border-radius: 12px; padding: 50px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin-bottom: 40px;">
                                <h3 style="font-family: Montserrat; color: #FFFFFF; font-size: 2rem; margin-bottom: 30px; font-weight: 700;">
                                    Informações do Caso
                                </h3>

                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px;">
                                    ${[
                                        {label: 'Dificuldade', value: casoSelecionado.dificuldade, emoji: '⚡'},
                                        {label: 'Tempo Limite', value: `${formatarTempo(casoSelecionado.tempoLimite)}`, emoji: '🕐'},
                                        {label: 'Classificação', value: casoSelecionado.classificacao, emoji: '🎯'},
                                        {label: 'Jogadores', value: casoSelecionado.jogadores, emoji: '👥'}
                                    ].map(info => `
                                        <div style="text-align: center; padding: 25px; background: var(--cinza-claro); border-radius: 8px;">
                                            <div style="font-size: 2rem; margin-bottom: 10px;">${info.emoji}</div>
                                            <div style="color: #aaaaaa; margin-bottom: 8px; font-size: 0.9rem;">${info.label}</div>
                                            <div style="color: #FFFFFF; font-size: 1.3rem; font-weight: 700; font-family: Montserrat;">${info.value}</div>
                                        </div>
                                    `).join('')}
                                </div>

                                <h4 style="font-family: Montserrat; color: #FFFFFF; font-size: 1.8rem; margin-bottom: 20px; font-weight: 700;">Resumo</h4>
                                <p style="color: #aaaaaa; line-height: 2; font-size: 1.1rem; margin-bottom: 40px;">${casoSelecionado.resumo}</p>

                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-bottom: 50px;">
                                    <div id="versaoDigital" style="border: 3px solid var(--amarelo); border-radius: 12px; padding: 40px; cursor: pointer; background: rgba(255, 215, 0, 0.1); text-align: center; transition: all 0.3s;" onclick="selecionarVersao('digital')">
                                        <div style="font-size: 3rem; margin-bottom: 15px;">📱</div>
                                        <h4 style="font-family: Montserrat; color: #FFFFFF; font-size: 1.8rem; margin-bottom: 10px; font-weight: 700;">Digital</h4>
                                        <p style="color: #aaaaaa; margin-bottom: 20px;">Receba por email</p>
                                        <div style="font-family: Montserrat; font-size: 3rem; color: #FFFFFF; font-weight: 700;">R$ ${casoSelecionado.precoDigital.toFixed(2)}</div>
                                    </div>

                                    <div id="versaoFisica" style="border: 2px solid #333333; border-radius: 12px; padding: 40px; cursor: pointer; background: #1a1a1a; text-align: center; transition: all 0.3s;" onclick="selecionarVersao('fisica')">
                                        <div style="font-size: 3rem; margin-bottom: 15px;">📦</div>
                                        <h4 style="font-family: Montserrat; color: #FFFFFF; font-size: 1.8rem; margin-bottom: 10px; font-weight: 700;">Física</h4>
                                        <p style="color: #aaaaaa; margin-bottom: 20px;">Receba em casa</p>
                                        <div style="font-family: Montserrat; font-size: 3rem; color: #FFFFFF; font-weight: 700;">R$ ${casoSelecionado.precoFisico.toFixed(2)}</div>
                                    </div>
                                </div>

                                <button class="btn-primary" style="width: 100%; font-size: 1.3rem; padding: 22px;" onclick="adicionarCasoAoCarrinho()">
                                    Adicionar ao Carrinho
                                </button>
                            </div>
                        </div>
                    </section>
                </div>
            `;
        }

        function renderCarrinho() {
            if (carrinho.length === 0) {
                return `
                    <section class="section page-content" style="min-height: 100vh;">
                        <h2 class="section-title">Carrinho</h2>
                        <div style="text-align: center; padding: 100px 40px;">
                            <div style="font-size: 6rem; margin-bottom: 30px;">🛒</div>
                            <p style="font-size: 1.8rem; color: #aaaaaa; margin-bottom: 40px;">Carrinho vazio</p>
                            <button class="btn-primary" onclick="navegarPara('casos')">
                                Ver Casos
                            </button>
                        </div>
                    </section>
                `;
            }

            const total = carrinho.reduce((sum, item) => sum + item.preco, 0);

            return `
                <section class="section page-content" style="min-height: 100vh;">
                    <h2 class="section-title">Meu Carrinho</h2>
                    <div style="max-width: 1000px; margin: 60px auto 0;">
                        ${carrinho.map(item => `
                            <div style="background: #1a1a1a; border-radius: 12px; padding: 30px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.08);">
                                <div style="flex: 1;">
                                    <h3 style="font-family: Montserrat; color: #FFFFFF; font-size: 1.8rem; margin-bottom: 8px; font-weight: 700;">${item.titulo}</h3>
                                    <p style="color: #aaaaaa; font-size: 1.1rem;">Versão: ${item.versao === 'digital' ? 'Digital 📱' : 'Física 📦'}</p>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-family: Montserrat; font-size: 2.5rem; color: #FFFFFF; margin-bottom: 15px; font-weight: 700;">
                                        R$ ${item.preco.toFixed(2)}
                                    </div>
                                    <button class="btn-secondary" style="padding: 10px 20px;" onclick="removerDoCarrinho(${item.id})">
                                        Remover
                                    </button>
                                </div>
                            </div>
                        `).join('')}

                        <div style="background: var(--cinza-claro); border-radius: 12px; padding: 40px; margin-top: 30px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <h3 style="font-family: Montserrat; color: #FFFFFF; font-size: 2.5rem; font-weight: 700;">Total</h3>
                                <div style="font-family: Montserrat; font-size: 4rem; color: #FFFFFF; font-weight: 700;">
                                    R$ ${total.toFixed(2)}
                                </div>
                            </div>
                            <button class="btn-primary" style="width: 100%; margin-top: 30px; font-size: 1.5rem; padding: 20px;" onclick="navegarPara('checkout')">
                                Finalizar Compra
                            </button>
                        </div>
                    </div>
                </section>
            `;
        }

        function renderCheckout() {
            const total = carrinho.reduce((sum, item) => sum + item.preco, 0);

            return `
                <section class="section page-content" style="min-height: 100vh;">
                    <h2 class="section-title">Checkout</h2>
                    <div style="max-width: 800px; margin: 60px auto 0;">
                        <div style="background: #1a1a1a; border-radius: 12px; padding: 50px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
                            <h3 style="font-family: Montserrat; color: #FFFFFF; font-size: 2.5rem; margin-bottom: 40px; text-align: center; font-weight: 700;">
                                Pagamento (Simulado)
                            </h3>
                            
                            <div style="text-align: center; margin-bottom: 40px;">
                                <img src="https://http2.mlstatic.com/storage/logos-api-admin/51b446b0-571c-11e8-9a2d-4b2bd7b1bf77-xl@2x.png" alt="Mercado Pago" style="max-width: 180px;">
                            </div>
                            
                            <p style="font-family: Montserrat; color: #FFFFFF; font-size: 3.5rem; margin-bottom: 50px; text-align: center; font-weight: 700;">
                                R$ ${total.toFixed(2)}
                            </p>
                            
                            <p style="text-align: center; color: #aaaaaa; margin-bottom: 40px; font-size: 1rem; line-height: 1.8;">
                                💳 Este é um checkout <strong>SIMULADO</strong> para testes<br>
                                Nenhuma cobrança real será efetuada
                            </p>
                            
                            <button class="btn-primary" style="width: 100%; font-size: 1.5rem; padding: 20px;" onclick="finalizarCompra()">
                                Confirmar Pagamento
                            </button>
                        </div>
                    </div>
                </section>
            `;
        }

        function renderAreaDetetive() {
            if (!usuarioLogado) {
                navegarPara('login');
                return '';
            }

            let conteudoAba = '';

            if (subPaginaDetetive === 'casos') {
                if (!usuarioLogado.casosComprados || usuarioLogado.casosComprados.length === 0) {
                    conteudoAba = `
                        <div style="text-align: center; padding: 100px 40px;">
                            <div style="font-size: 6rem; margin-bottom: 30px;">📁</div>
                            <p style="font-size: 1.8rem; color: #aaaaaa; margin-bottom: 40px;">Nenhum caso adquirido</p>
                            <button class="btn-primary" onclick="navegarPara('casos')">
                                Comprar Casos
                            </button>
                        </div>
                    `;
                } else {
                    conteudoAba = `
                        <div class="casos-grid">
                            ${usuarioLogado.casosComprados.map(caso => `
                                <div class="case-card">
                                    <img src="${caso.banner}" alt="${caso.titulo}" style="width: 100%; height: 220px; object-fit: cover;" />
                                    <div style="padding: 30px;">
                                        <h3 style="font-family: Montserrat; font-size: 1.6rem; color: #FFFFFF; margin-bottom: 15px; font-weight: 700;">${caso.titulo}</h3>
                                        
                                        ${caso.resolvido ? `
                                            <div style="background: rgba(76, 175, 80, 0.1); border: 2px solid var(--verde); border-radius: 8px; padding: 20px; margin-bottom: 20px; text-align: center;">
                                                <div style="color: var(--verde); font-size: 2rem; margin-bottom: 8px;">✅</div>
                                                <div style="color: var(--verde); font-weight: 700; font-family: Montserrat; font-size: 1.3rem; margin-bottom: 5px;">RESOLVIDO!</div>
                                                <div style="color: var(--verde); font-size: 0.95rem;">+${caso.pontosGanhos || 0} pontos${caso.tagGanha ? ' + ' + caso.tagGanha : ''}</div>
                                            </div>
                                        ` : caso.naoSolucionado ? `
                                            <div style="background: rgba(229, 57, 53, 0.1); border: 2px solid var(--vermelho); border-radius: 8px; padding: 20px; margin-bottom: 20px; text-align: center;">
                                                <div style="color: var(--vermelho); font-size: 2rem; margin-bottom: 8px;">❌</div>
                                                <div style="color: var(--vermelho); font-weight: 700; font-family: Montserrat; font-size: 1.3rem; margin-bottom: 5px;">NÃO SOLUCIONADO</div>
                                                <div style="color: var(--vermelho); font-size: 0.95rem;">5/5 tentativas</div>
                                            </div>
                                        ` : caso.iniciado ? `
                                            <div style="background: rgba(255, 215, 0, 0.1); border: 2px solid var(--amarelo); border-radius: 8px; padding: 20px; margin-bottom: 20px; text-align: center;">
                                                <div style="color: #FFFFFF; font-weight: 700; font-family: Montserrat; font-size: 1.2rem; margin-bottom: 5px;">EM ANDAMENTO</div>
                                                <div style="color: #aaaaaa; font-size: 0.95rem;">Tentativas: ${caso.tentativas || 0}/5</div>
                                            </div>
                                        ` : ''}

                                        <button class="btn-primary" style="width: 100%; padding: 14px; font-size: 1.1rem;" onclick='${caso.resolvido || caso.naoSolucionado ? `navegarPara("ver-solucao", {casoJogo: ${JSON.stringify(caso).replace(/'/g, "\\'")}})` : `iniciarCaso(${JSON.stringify(caso).replace(/'/g, "\\'")}); jogarCaso(${JSON.stringify(caso).replace(/'/g, "\\'")})` }'>
                                            ${caso.resolvido ? 'Ver Solução' : caso.naoSolucionado ? 'Ver Solução' : caso.iniciado ? 'Continuar' : 'Iniciar'}
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
            } else if (subPaginaDetetive === 'patentes') {
                conteudoAba = `
                    <div style="text-align: center; margin-bottom: 60px;">
                        <div style="display: inline-block; background: rgba(255, 215, 0, 0.1); border: 3px solid var(--amarelo); border-radius: 12px; padding: 30px 60px;">
                            <div style="font-size: 4rem; margin-bottom: 15px;">${getIconePatente(usuarioLogado.patente)}</div>
                            <h3 style="font-family: Montserrat; font-size: 2.5rem; color: #FFFFFF; font-weight: 700;">${usuarioLogado.patente}</h3>
                        </div>
                    </div>

                    <h3 style="font-family: Montserrat; color: #FFFFFF; font-size: 2.5rem; margin-bottom: 50px; text-align: center; font-weight: 700;">
                        Promoções de Patente
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 30px;">
                        ${[
                            {nome: 'Detetive Júnior', desc: 'Inicial', desbloqueada: true, bonus: '+0 pts'},
                            {nome: 'Sargento', desc: '1 caso resolvido', desbloqueada: usuarioLogado.casosResolvidos >= 1, bonus: '+200 pts'},
                            {nome: 'Inspetor', desc: '3 casos resolvidos', desbloqueada: usuarioLogado.casosResolvidos >= 3, bonus: '+250 pts'},
                            {nome: 'Inspetor-Chefe', desc: '5 casos resolvidos', desbloqueada: usuarioLogado.casosResolvidos >= 5, bonus: '+300 pts'},
                            {nome: 'Lenda: Sherlock Holmes', desc: '10 casos', desbloqueada: usuarioLogado.casosResolvidos >= 10, bonus: '+500 pts'}
                        ].map(patente => `
                            <div style="background: #1a1a1a; border: 2px solid ${patente.desbloqueada ? 'var(--amarelo)' : 'var(--cinza-medio)'}; border-radius: 12px; padding: 30px; text-align: center; ${patente.desbloqueada ? '' : 'opacity: 0.5;'}">
                                ${!patente.desbloqueada ? '<div style="font-size: 2.5rem; margin-bottom: 10px;">🔒</div>' : '<div style="font-size: 2.5rem; margin-bottom: 10px;">🎖️</div>'}
                                <div style="font-family: Montserrat; color: #FFFFFF; font-weight: 700; margin-bottom: 10px; font-size: 1.3rem;">
                                    ${patente.nome}
                                </div>
                                <div style="color: #aaaaaa; font-size: 0.95rem; margin-bottom: 10px;">${patente.desc}</div>
                                <div style="color: #FFFFFF; font-weight: 600; font-size: 0.9rem;">${patente.bonus}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else if (subPaginaDetetive === 'conquistas') {
                conteudoAba = `
                    <h3 style="font-family: Montserrat; color: #FFFFFF; font-size: 2.5rem; margin-bottom: 50px; text-align: center; font-weight: 700;">
                        Conquistas de Desempenho
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 30px;">
                        ${[
                            {id: 'Lupa de Ouro', nome: 'Lupa de Ouro', desc: '1ª tentativa + tempo', emoji: '🥇'},
                            {id: 'Lupa de Prata', nome: 'Lupa de Prata', desc: '2ª tentativa + tempo', emoji: '🥈'},
                            {id: 'Lupa de Bronze', nome: 'Lupa de Bronze', desc: '3ª tentativa + tempo', emoji: '🥉'},
                            {id: 'Ajudante de Honra', nome: 'Ajudante de Honra', desc: '4ª tentativa + tempo', emoji: '🎖️'},
                            {id: 'Advertido Pelo Departamento', nome: 'Advertido', desc: '5ª tentativa + tempo', emoji: '⚠️'}
                        ].map(conquista => {
                            const quantidade = usuarioLogado.conquistasContador?.[conquista.id] || 0;
                            const desbloqueada = quantidade > 0;
                            return `
                                <div style="background: #1a1a1a; border: 2px solid ${desbloqueada ? 'var(--amarelo)' : 'var(--cinza-medio)'}; border-radius: 12px; padding: 30px; text-align: center; ${desbloqueada ? '' : 'opacity: 0.5;'} position: relative;">
                                    ${!desbloqueada ? '<div style="font-size: 2.5rem; margin-bottom: 10px;">🔒</div>' : `
                                        <div style="font-size: 3rem; margin-bottom: 10px;">${conquista.emoji}</div>
                                        <div style="position: absolute; top: 10px; right: 10px; background: var(--amarelo); color: #000; padding: 6px 14px; border-radius: 20px; font-weight: 900; font-size: 1.1rem; font-family: Montserrat;">
                                            ${quantidade}x
                                        </div>
                                    `}
                                    <div style="font-family: Montserrat; color: #FFFFFF; font-weight: 700; margin-bottom: 10px; font-size: 1.3rem;">
                                        ${conquista.nome}
                                    </div>
                                    <div style="color: #aaaaaa; font-size: 0.95rem;">${conquista.desc}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            } else if (subPaginaDetetive === 'pontuacao') {
                conteudoAba = `
                    <h3 style="font-family: Montserrat; color: #FFFFFF; font-size: 2.5rem; margin-bottom: 50px; text-align: center; font-weight: 700;">
                        📊 Sistema de Pontuação
                    </h3>
                    
                    <div style="max-width: 1000px; margin: 0 auto;">
                        <!-- PONTOS POR RESOLUÇÃO -->
                        <div style="background: #1a1a1a; border: 2px solid var(--amarelo); border-radius: 12px; padding: 40px; margin-bottom: 30px;">
                            <h4 style="font-family: Montserrat; color: var(--amarelo); font-size: 1.8rem; margin-bottom: 25px; font-weight: 700;">
                                💰 Pontos por Resolução de Casos
                            </h4>
                            <div style="display: grid; gap: 15px;">
                                ${[
                                    {tent: '1ª tentativa', pts: '500 pontos', cor: '#FFD700'},
                                    {tent: '2ª tentativa', pts: '400 pontos', cor: '#C0C0C0'},
                                    {tent: '3ª tentativa', pts: '300 pontos', cor: '#CD7F32'},
                                    {tent: '4ª tentativa', pts: '200 pontos', cor: '#4CAF50'},
                                    {tent: '5ª tentativa', pts: '100 pontos', cor: '#2196F3'}
                                ].map(item => `
                                    <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                                        <span style="color: #FFFFFF; font-size: 1.1rem; font-weight: 600;">${item.tent}</span>
                                        <span style="color: ${item.cor}; font-size: 1.3rem; font-weight: 900;">${item.pts}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- BÔNUS DE TEMPO (TAGS) -->
                        <div style="background: #1a1a1a; border: 2px solid var(--amarelo); border-radius: 12px; padding: 40px; margin-bottom: 30px;">
                            <h4 style="font-family: Montserrat; color: var(--amarelo); font-size: 1.8rem; margin-bottom: 25px; font-weight: 700;">
                                ⏱️ Bônus de Tempo (Tags)
                            </h4>
                            <p style="color: #aaaaaa; margin-bottom: 25px; line-height: 1.8;">
                                Resolva o caso dentro do tempo limite para ganhar tags especiais e bônus de pontos:
                            </p>
                            <div style="display: grid; gap: 15px;">
                                ${[
                                    {tag: '🥇 Lupa de Ouro', req: '1ª tentativa + tempo', bonus: '+100 pontos'},
                                    {tag: '🥈 Lupa de Prata', req: '2ª tentativa + tempo', bonus: '+80 pontos'},
                                    {tag: '🥉 Lupa de Bronze', req: '3ª tentativa + tempo', bonus: '+60 pontos'},
                                    {tag: '🎖️ Ajudante de Honra', req: '4ª tentativa + tempo', bonus: '+40 pontos'},
                                    {tag: '⚠️ Advertido', req: '5ª tentativa + tempo', bonus: '+20 pontos'}
                                ].map(item => `
                                    <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 8px;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                            <span style="color: #FFFFFF; font-size: 1.2rem; font-weight: 700;">${item.tag}</span>
                                            <span style="color: var(--verde); font-size: 1.1rem; font-weight: 900;">${item.bonus}</span>
                                        </div>
                                        <div style="color: #888888; font-size: 0.95rem;">${item.req}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- BÔNUS DE PROMOÇÃO -->
                        <div style="background: #1a1a1a; border: 2px solid var(--amarelo); border-radius: 12px; padding: 40px; margin-bottom: 30px;">
                            <h4 style="font-family: Montserrat; color: var(--amarelo); font-size: 1.8rem; margin-bottom: 25px; font-weight: 700;">
                                ⭐ Bônus de Promoção
                            </h4>
                            <p style="color: #aaaaaa; margin-bottom: 25px; line-height: 1.8;">
                                Ao ser promovido para uma nova patente, você ganha bônus de pontos:
                            </p>
                            <div style="display: grid; gap: 15px;">
                                ${[
                                    {patente: 'Sargento', bonus: '+200 pontos'},
                                    {patente: 'Inspetor', bonus: '+250 pontos'},
                                    {patente: 'Inspetor-Chefe', bonus: '+300 pontos'},
                                    {patente: 'Lenda: Sherlock Holmes', bonus: '+500 pontos'}
                                ].map(item => `
                                    <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                                        <span style="color: #FFFFFF; font-size: 1.1rem; font-weight: 600;">${item.patente}</span>
                                        <span style="color: var(--verde); font-size: 1.3rem; font-weight: 900;">${item.bonus}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- OUTROS PONTOS -->
                        <div style="background: #1a1a1a; border: 2px solid var(--amarelo); border-radius: 12px; padding: 40px;">
                            <h4 style="font-family: Montserrat; color: var(--amarelo); font-size: 1.8rem; margin-bottom: 25px; font-weight: 700;">
                                🎁 Outras Formas de Pontuar
                            </h4>
                            <div style="display: grid; gap: 15px;">
                                ${[
                                    {acao: '🛒 Comprar um caso', pts: '+100 pontos'},
                                    {acao: '❌ Caso não solucionado', pts: '-50 pontos'}
                                ].map(item => `
                                    <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                                        <span style="color: #FFFFFF; font-size: 1.1rem; font-weight: 600;">${item.acao}</span>
                                        <span style="color: ${item.pts.includes('-') ? '#ff4444' : 'var(--verde)'}; font-size: 1.3rem; font-weight: 900;">${item.pts}</span>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div style="margin-top: 30px; padding: 25px; background: rgba(255, 215, 0, 0.1); border-radius: 8px; border: 2px solid var(--amarelo);">
                                <div style="color: var(--amarelo); font-size: 1.2rem; font-weight: 700; margin-bottom: 10px;">💡 Dica Importante</div>
                                <div style="color: #FFFFFF; line-height: 1.8;">
                                    Para maximizar sua pontuação: resolva casos na primeira tentativa dentro do tempo limite! 
                                    Você ganhará até <strong style="color: var(--amarelo);">600 pontos</strong> por caso (500 + 100 da Lupa de Ouro).
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (subPaginaDetetive === 'resumo') {
                conteudoAba = `
                    <div style="max-width: 900px; margin: 0 auto;">
                        <div style="background: #1a1a1a; border-radius: 12px; padding: 50px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
                            <h3 style="font-family: Montserrat; color: #FFFFFF; font-size: 2.5rem; margin-bottom: 40px; text-align: center; font-weight: 700;">
                                Ficha do Detetive
                            </h3>

                            <div style="background: var(--cinza-claro); padding: 30px; margin-bottom: 25px; border-radius: 8px;">
                                <div style="color: #aaaaaa; margin-bottom: 10px; font-size: 0.95rem; font-weight: 600;">ID</div>
                                <div style="font-family: Montserrat; color: #FFFFFF; font-size: 2rem; font-weight: 700;">#${String(usuarioLogado.id).padStart(5, '0')}</div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Calcular estatísticas
                const casosComprados = usuarioLogado.casosComprados || [];
                const casosResolvidos = casosComprados.filter(c => c.resolvido).length;
                const casosNaoSolucionados = casosComprados.filter(c => c.naoSolucionado).length;
                const casosEmAberto = casosComprados.filter(c => !c.resolvido && !c.naoSolucionado && !c.tempoInicio).length;
                const casosIniciados = casosComprados.filter(c => c.tempoInicio && !c.resolvido).length;
                const totalCasos = casosComprados.length;
                
                // Calcular média de tempo
                const casosComTempo = casosComprados.filter(c => c.resolvido && c.tempoTotal);
                const mediaTempoSegundos = casosComTempo.length > 0 
                    ? Math.floor(casosComTempo.reduce((acc, c) => acc + c.tempoTotal, 0) / casosComTempo.length)
                    : 0;
                
                // Contar conquistas desbloqueadas
                const conquistasDesbloqueadas = Object.keys(usuarioLogado.conquistasContador || {}).length;
                const totalConquistas = Object.values(usuarioLogado.conquistasContador || {}).reduce((a, b) => a + b, 0);
                
                // Posição no ranking (simulada - você pode implementar ranking real depois)
                const posicaoRanking = Math.floor(Math.random() * 100) + 1; // Temporário
                
                conteudoAba += `
                            
                            <div style="background: #1a1a1a; border: 2px solid #333333; padding: 30px; margin-bottom: 25px; border-radius: 8px;">
                                <div style="color: #aaaaaa; margin-bottom: 10px; font-size: 0.95rem; font-weight: 600;">NOME</div>
                                <div style="color: #FFFFFF; font-size: 1.6rem; font-weight: 600;">${usuarioLogado.nome}</div>
                            </div>
                            
                            <!-- PATENTE ATUAL -->
                            <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0.05)); border: 2px solid var(--amarelo); padding: 30px; margin-bottom: 25px; border-radius: 8px; text-align: center;">
                                <div style="color: var(--amarelo); margin-bottom: 10px; font-size: 0.95rem; font-weight: 600;">PATENTE ATUAL</div>
                                <div style="font-family: Montserrat; color: #FFFFFF; font-size: 2.2rem; font-weight: 900;">⭐ ${usuarioLogado.patente}</div>
                            </div>
                            
                            <!-- CONQUISTAS DESBLOQUEADAS -->
                            <div style="background: var(--cinza-claro); padding: 30px; margin-bottom: 25px; border-radius: 8px; text-align: center;">
                                <div style="color: #aaaaaa; margin-bottom: 10px; font-size: 0.95rem; font-weight: 600;">CONQUISTAS DESBLOQUEADAS</div>
                                <div style="font-family: Montserrat; color: #FFFFFF; font-size: 2.5rem; font-weight: 700;">
                                    🏆 ${conquistasDesbloqueadas} <span style="font-size: 1.2rem; color: #aaaaaa;">(${totalConquistas} total)</span>
                                </div>
                            </div>

                            <!-- GRID DE ESTATÍSTICAS -->
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 25px; margin-bottom: 25px;">
                                <div style="background: var(--cinza-claro); padding: 30px; text-align: center; border-radius: 8px;">
                                    <div style="color: #aaaaaa; margin-bottom: 10px; font-size: 0.95rem; font-weight: 600;">PONTOS</div>
                                    <div style="font-family: Montserrat; color: var(--amarelo); font-size: 3rem; font-weight: 700;">${usuarioLogado.pontos}</div>
                                </div>
                                <div style="background: var(--cinza-claro); padding: 30px; text-align: center; border-radius: 8px;">
                                    <div style="color: #aaaaaa; margin-bottom: 10px; font-size: 0.95rem; font-weight: 600;">CASOS</div>
                                    <div style="font-family: Montserrat; color: #FFFFFF; font-size: 3rem; font-weight: 700;">${totalCasos}</div>
                                </div>
                            </div>
                            
                            <!-- DETALHAMENTO DE CASOS -->
                            <div style="background: #1a1a1a; border: 2px solid #333333; padding: 30px; margin-bottom: 25px; border-radius: 8px;">
                                <div style="color: var(--amarelo); font-size: 1.3rem; font-weight: 700; margin-bottom: 20px; text-align: center;">📊 Estatísticas de Casos</div>
                                <div style="display: grid; gap: 15px;">
                                    ${[
                                        {label: '✅ Casos Resolvidos', valor: casosResolvidos, cor: 'var(--verde)'},
                                        {label: '❌ Casos Não Solucionados', valor: casosNaoSolucionados, cor: '#ff4444'},
                                        {label: '📂 Casos Em Aberto', valor: casosEmAberto, cor: '#2196F3'},
                                        {label: '🔍 Casos Iniciados', valor: casosIniciados, cor: 'var(--amarelo)'}
                                    ].map(item => `
                                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: rgba(255,255,255,0.03); border-radius: 6px;">
                                            <span style="color: #aaaaaa; font-size: 1rem;">${item.label}</span>
                                            <span style="color: ${item.cor}; font-size: 1.8rem; font-weight: 900;">${item.valor}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <!-- MÉDIA DE TEMPO -->
                            <div style="background: var(--cinza-claro); padding: 30px; margin-bottom: 25px; border-radius: 8px; text-align: center;">
                                <div style="color: #aaaaaa; margin-bottom: 10px; font-size: 0.95rem; font-weight: 600;">⏱️ MÉDIA DE TEMPO</div>
                                <div style="font-family: Montserrat; color: #FFFFFF; font-size: 2.5rem; font-weight: 700;">
                                    ${formatarTempoCompleto(mediaTempoSegundos)}
                                </div>
                                <div style="color: #888888; font-size: 0.9rem; margin-top: 8px;">
                                    ${casosComTempo.length} ${casosComTempo.length === 1 ? 'caso' : 'casos'} concluído${casosComTempo.length === 1 ? '' : 's'}
                                </div>
                            </div>
                            
                            <!-- POSIÇÃO NO RANKING -->
                            <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 215, 0, 0.05)); border: 2px solid var(--amarelo); padding: 30px; border-radius: 8px; text-align: center;">
                                <div style="color: var(--amarelo); margin-bottom: 10px; font-size: 0.95rem; font-weight: 600;">🏅 POSIÇÃO NO RANKING GLOBAL</div>
                                <div style="font-family: Montserrat; color: #FFFFFF; font-size: 3.5rem; font-weight: 900;">#${posicaoRanking}</div>
                                <div style="color: #888888; font-size: 0.95rem; margin-top: 8px;">Entre todos os detetives ativos</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            return `
                <section class="section page-content" style="min-height: 100vh;">
                    <h2 class="section-title">Área do Detetive</h2>
                    
                    <div class="tabs-container">
                        ${[
                            {id: 'casos', label: 'Meus Casos'},
                            {id: 'patentes', label: 'Promoções'},
                            {id: 'conquistas', label: 'Conquistas'},
                            {id: 'pontuacao', label: 'Pontuação'},
                            {id: 'resumo', label: 'Resumo'}
                        ].map(aba => `
                            <button class="tab-btn ${subPaginaDetetive === aba.id ? 'active' : ''}" onclick="mudarAba('${aba.id}')">
                                ${aba.label}
                            </button>
                        `).join('')}
                    </div>

                    <div style="max-width: 1400px; margin: 0 auto;">
                        ${conteudoAba}
                    </div>
                </section>
            `;
        }

        function renderPerfil() {
            if (!usuarioLogado) {
                navegarPara('login');
                return '';
            }

            dadosOriginaisPerfil = {nome: usuarioLogado.nome, senha: usuarioLogado.senha};

            return `
                <section class="section page-content" style="min-height: 100vh;">
                    <h2 class="section-title">Perfil</h2>
                    
                    <div style="max-width: 900px; margin: 60px auto 0;">
                        <div style="background: #1a1a1a; border-radius: 12px; padding: 50px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
                            <h3 style="font-family: Montserrat; color: #FFFFFF; font-size: 2.5rem; margin-bottom: 40px; text-align: center; font-weight: 700;">
                                Dados do Detetive
                            </h3>

                            <div class="form-group">
                                <label class="form-label">ID do Cadastro</label>
                                <input type="text" value="#${String(usuarioLogado.id).padStart(5, '0')}" readonly style="background: var(--cinza-claro); cursor: not-allowed;">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Nome/Nick (pode ser alterado)</label>
                                <input type="text" id="perfilNome" value="${usuarioLogado.nome}">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Email (não pode ser alterado)</label>
                                <input type="email" value="${usuarioLogado.email}" readonly style="background: var(--cinza-claro); cursor: not-allowed;">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Nova Senha (deixe em branco para não alterar)</label>
                                <input type="password" id="perfilSenha" placeholder="••••••••">
                            </div>

                            <div class="form-actions">
                                <button class="btn-secondary" style="flex: 1;" onclick="cancelarEdicaoPerfil()">
                                    Cancelar
                                </button>
                                <button class="btn-primary" style="flex: 1;" onclick="salvarPerfil()">
                                    Salvar
                                </button>
                            </div>

                            <button class="btn-secondary" style="width: 100%; margin-top: 20px;" onclick="navegarPara('area-detetive')">
                                Voltar
                            </button>
                        </div>
                    </div>
                </section>
            `;
        }

        function renderAjuda() {
            return `
                <section class="section page-content" style="min-height: 100vh;">
                    <h2 class="section-title">Ajuda</h2>
                    
                    <div style="max-width: 1000px; margin: 60px auto 0;">
                        <div style="background: #1a1a1a; border-radius: 12px; padding: 50px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
                            <h3 style="font-family: Montserrat; color: #FFFFFF; font-size: 2.5rem; margin-bottom: 40px; text-align: center; font-weight: 700;">
                                Perguntas Frequentes
                            </h3>

                            ${[
                                {q: 'Como funciona o jogo?', a: 'Você compra um caso, recebe as evidências e precisa descobrir: quem é o assassino, qual arma foi usada, o motivo e o local do crime.'},
                                {q: 'Quantas tentativas tenho?', a: 'Você tem 5 tentativas para resolver cada caso. Na primeira tentativa você ganha 500 pontos, na segunda 400, e assim por diante.'},
                                {q: 'O que são as Tags?', a: 'São conquistas especiais que você ganha ao resolver casos dentro do tempo limite. Lupa de Ouro, Prata, Bronze, etc.'},
                                {q: 'Como funcionam as promoções?', a: 'Conforme resolve mais casos, sua patente sobe: Sargento (1 caso), Inspetor (3 casos), Inspetor-Chefe (5 casos), Lenda Sherlock (10 casos).'},
                                {q: 'Posso jogar mais de uma vez?', a: 'Sim! Após finalizar um caso (resolvido ou não), você pode jogar novamente comprando outro caso.'}
                            ].map((faq, i) => `
                                <div style="background: var(--cinza-claro); border-left: 4px solid var(--amarelo); border-radius: 8px; padding: 30px; margin-bottom: 20px;">
                                    <h4 style="font-family: Montserrat; color: #FFFFFF; font-size: 1.5rem; margin-bottom: 15px; font-weight: 700;">
                                        ${faq.q}
                                    </h4>
                                    <p style="color: #aaaaaa; line-height: 1.8; font-size: 1.05rem;">
                                        ${faq.a}
                                    </p>
                                </div>
                            `).join('')}

                            <div style="text-align: center; margin-top: 60px;">
                                <h3 style="font-family: Montserrat; color: #FFFFFF; font-size: 2rem; margin-bottom: 30px; font-weight: 700;">
                                    Fale com o Delegado Virtual
                                </h3>
                                <a href="https://wa.me/5517988097070?text=Olá,%20preciso%20de%20ajuda!" target="_blank" rel="noopener noreferrer">
                                    <button class="btn-primary" style="font-size: 1.3rem; padding: 20px 50px;">
                                        💬 Abrir WhatsApp
                                    </button>
                                </a>
                            </div>
                        </div>
                    </div>
                </section>
            `;
        }

        function renderJogarCaso() {
            if (!casoEmJogo) {
                navegarPara('area-detetive');
                return '';
            }

            return `
                <section class="section page-content" style="min-height: 100vh;">
                    <div style="max-width: 1200px; margin: 0 auto;">
                        <div style="background: #1a1a1a; border-radius: 12px; padding: 40px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 20px rgba(0,0,0,0.08); flex-wrap: wrap; gap: 30px;">
                            <div>
                                <h2 style="font-family: Montserrat; font-size: 2.5rem; color: #FFFFFF; margin-bottom: 10px; font-weight: 700;">
                                    ${casoEmJogo.titulo}
                                </h2>
                                <p style="color: #aaaaaa; font-size: 1.1rem; font-weight: 600;">Tentativa ${(casoEmJogo.tentativas || 0) + 1} de 5</p>
                            </div>
                            <div style="text-align: center;">
                                <div style="color: #aaaaaa; margin-bottom: 8px; font-size: 0.95rem; font-weight: 600;">TEMPO</div>
                                <div id="timer" style="font-family: Montserrat; font-size: 2.5rem; color: #FFFFFF; font-weight: 700;">
                                    ${formatarTempoCompleto(tempoDecorrido)}
                                </div>
                            </div>
                        </div>

                        <div style="background: #1a1a1a; border-radius: 12px; padding: 50px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
                            <div style="text-align: center;">
                                <button class="btn-primary" style="font-size: 1.5rem; padding: 22px 60px;" onclick="document.getElementById('modalFormulario').classList.add('active')">
                                    Apresentar Teoria
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- MODAL -->
                    <div id="modalFormulario" class="modal-overlay">
                        <div class="modal-content">
                            <div style="text-align: center; margin-bottom: 30px; padding: 15px; background: rgba(255, 215, 0, 0.1); border: 2px solid var(--amarelo); border-radius: 10px;">
                                <div style="font-size: 1.6rem; color: var(--amarelo); font-weight: 900; font-family: Montserrat;">
                                    📝 Tentativa ${(casoEmJogo.tentativas || 0) + 1} de 5
                                </div>
                                <div style="font-size: 0.95rem; color: #aaaaaa; margin-top: 8px;">
                                    Pense bem antes de apresentar sua teoria
                                </div>
                            </div>
                            
                            <h3 style="font-family: Montserrat; font-size: 2.5rem; color: #FFFFFF; margin-bottom: 40px; text-align: center; font-weight: 700;">
                                Sua Teoria
                            </h3>

                            <div class="form-group">
                                <label class="form-label">1. Quem é o assassino?</label>
                                <select id="selectAssassino">
                                    <option value="">Selecione...</option>
                                    ${casoEmJogo.opcoes.assassinos.map(op => `<option value="${op}">${op}</option>`).join('')}
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">2. Qual foi a arma?</label>
                                <select id="selectArma">
                                    <option value="">Selecione...</option>
                                    ${casoEmJogo.opcoes.armas.map(op => `<option value="${op}">${op}</option>`).join('')}
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">3. Qual foi o motivo?</label>
                                <select id="selectMotivo">
                                    <option value="">Selecione...</option>
                                    ${casoEmJogo.opcoes.motivos.map(op => `<option value="${op}">${op}</option>`).join('')}
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">4. Onde aconteceu?</label>
                                <select id="selectLocal">
                                    <option value="">Selecione...</option>
                                    ${casoEmJogo.opcoes.locais.map(op => `<option value="${op}">${op}</option>`).join('')}
                                </select>
                            </div>

                            <div class="form-actions">
                                <button class="btn-secondary" style="flex: 1;" onclick="document.getElementById('modalFormulario').classList.remove('active')">
                                    Fechar
                                </button>
                                <button class="btn-primary" style="flex: 1;" onclick="validarResposta()">
                                    Validar
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
            `;
        }

        function renderVerSolucao() {
            if (!casoEmJogo) {
                navegarPara('area-detetive');
                return '';
            }

            return `
                <section class="section page-content" style="min-height: 100vh;">
                    <div style="max-width: 1000px; margin: 0 auto;">
                        <div style="background: #1a1a1a; border-radius: 12px; padding: 50px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
                            <h2 style="font-family: Montserrat; font-size: 3.5rem; color: #FFFFFF; margin-bottom: 50px; text-align: center; font-weight: 700;">
                                Solução do Caso
                            </h2>

                            ${casoEmJogo.resolvido ? `
                                <div style="background: rgba(76, 175, 80, 0.1); border: 3px solid var(--verde); border-radius: 12px; padding: 40px; margin-bottom: 50px; text-align: center;">
                                    <div style="font-size: 5rem; margin-bottom: 20px;">✅</div>
                                    <h3 style="font-family: Montserrat; color: var(--verde); font-size: 2.5rem; margin-bottom: 20px; font-weight: 700;">
                                        CASO RESOLVIDO!
                                    </h3>
                                    <p style="color: var(--verde); font-size: 1.3rem; margin-bottom: 8px; font-weight: 600;">
                                        Tentativa ${casoEmJogo.tentativas}
                                    </p>
                                    <p style="color: var(--verde); font-size: 1.3rem; margin-bottom: 8px; font-weight: 600;">
                                        Tempo: ${formatarTempoCompleto(casoEmJogo.tempoTotal || 0)}
                                    </p>
                                    <p style="color: var(--verde); font-size: 2.2rem; font-weight: 900; font-family: Montserrat; margin-top: 15px;">
                                        +${casoEmJogo.pontosGanhos || 0} PONTOS
                                    </p>
                                    ${casoEmJogo.tagGanha ? `<p style="color: var(--verde); font-size: 1.6rem; font-weight: 700; margin-top: 15px;">🏆 ${casoEmJogo.tagGanha}</p>` : ''}
                                </div>
                            ` : casoEmJogo.naoSolucionado ? `
                                <div style="background: rgba(229, 57, 53, 0.1); border: 3px solid var(--vermelho); border-radius: 12px; padding: 40px; margin-bottom: 50px; text-align: center;">
                                    <div style="font-size: 5rem; margin-bottom: 20px;">❌</div>
                                    <h3 style="font-family: Montserrat; color: var(--vermelho); font-size: 2.5rem; margin-bottom: 20px; font-weight: 700;">
                                        CASO NÃO SOLUCIONADO
                                    </h3>
                                    <p style="color: var(--vermelho); font-size: 1.3rem; font-weight: 600;">
                                        Tentativas esgotadas (5/5)
                                    </p>
                                </div>
                            ` : ''}

                            <h3 style="font-family: Montserrat; color: #FFFFFF; font-size: 2rem; margin-bottom: 30px; font-weight: 700;">
                                Resposta Correta
                            </h3>
                            <div style="display: grid; gap: 20px; margin-bottom: 50px;">
                                ${Object.entries(casoEmJogo.solucao).filter(([key]) => key !== 'explicacao').map(([key, value]) => `
                                    <div style="background: var(--cinza-claro); padding: 25px; border-radius: 8px;">
                                        <div style="color: #aaaaaa; margin-bottom: 10px; font-weight: 600; font-size: 0.9rem; text-transform: uppercase;">${key}</div>
                                        <div style="color: #FFFFFF; font-size: 1.4rem; font-weight: 700; font-family: Montserrat;">${value}</div>
                                    </div>
                                `).join('')}
                            </div>

                            <h3 style="font-family: Montserrat; color: #FFFFFF; font-size: 2rem; margin-bottom: 30px; font-weight: 700;">
                                Como Aconteceu
                            </h3>
                            <div style="background: var(--cinza-claro); padding: 35px; margin-bottom: 50px; border-radius: 8px;">
                                <p style="color: #aaaaaa; font-size: 1.15rem; line-height: 2;">
                                    ${casoEmJogo.solucao.explicacao}
                                </p>
                            </div>

                            <button class="btn-primary" style="width: 100%; padding: 20px; font-size: 1.3rem;" onclick="navegarPara('area-detetive')">
                                Voltar
                            </button>
                        </div>
                    </div>
                </section>
            `;
        }

        async function renderRanking() {
            const todosUsuarios = await buscarTodosUsuariosFirebase();
            const ranking = todosUsuarios
                .sort((a, b) => b.pontos - a.pontos)
                .map((u, index) => ({...u, posicao: index + 1}));
            
            const top10 = ranking.slice(0, 10);
            const usuarioRanking = usuarioLogado ? ranking.find(u => u.id === usuarioLogado.id) : null;

            const content = document.getElementById('app-content');
            content.innerHTML = `
                <section class="section page-content" style="min-height: 100vh;">
                    <h2 class="section-title">🏆 Ranking Global</h2>
                    <p class="section-subtitle">Top 10 detetives mais pontuados</p>
                    
                    <div class="rank-table" style="margin-top: 60px; overflow-x: auto;">
                        <div class="rank-header" style="display: grid; grid-template-columns: 80px 1fr 150px 100px 150px 100px; gap: 15px; padding: 20px; background: var(--amarelo); border-radius: 8px 8px 0 0; font-weight: 900;">
                            <div style="color: #000;">POS</div>
                            <div style="color: #000;">DETETIVE</div>
                            <div style="color: #000;">PATENTE</div>
                            <div style="color: #000;">PONTOS</div>
                            <div style="color: #000;">TAGS</div>
                            <div style="color: #000;">CASOS</div>
                        </div>
                        ${top10.map(user => {
                            const totalTags = Object.values(user.conquistasContador || {}).reduce((a, b) => a + b, 0);
                            return `
                            <div class="rank-row ${usuarioLogado && user.id === usuarioLogado.id ? 'user-rank' : ''}" style="display: grid; grid-template-columns: 80px 1fr 150px 100px 150px 100px; gap: 15px; padding: 20px; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <div style="font-family: Montserrat; font-size: 1.8rem; font-weight: 700; color: #FFFFFF;">
                                    ${user.posicao === 1 ? '🥇' : user.posicao === 2 ? '🥈' : user.posicao === 3 ? '🥉' : `#${user.posicao}`}
                                </div>
                                <div style="font-weight: ${usuarioLogado && user.id === usuarioLogado.id ? '900' : '600'}; color: ${usuarioLogado && user.id === usuarioLogado.id ? 'var(--amarelo)' : '#FFFFFF'}; font-size: 1.1rem; font-family: Montserrat;">
                                    ${user.nome} ${usuarioLogado && user.id === usuarioLogado.id ? '(VOCÊ)' : ''}
                                </div>
                                <div style="color: #aaaaaa; font-size: 0.95rem; font-weight: 600;">${user.patente}</div>
                                <div style="font-family: Montserrat; color: var(--amarelo); font-weight: 900; font-size: 1.3rem;">${user.pontos}</div>
                                <div style="color: #FFFFFF; font-size: 1.1rem; font-weight: 700;">${totalTags} 🏆</div>
                                <div style="color: #aaaaaa; font-size: 1.1rem; font-weight: 600;">${(user.casosComprados || []).length}</div>
                            </div>
                        `}).join('')}
                        ${usuarioRanking && usuarioRanking.posicao > 10 ? `
                            <div class="rank-row user-rank" style="display: grid; grid-template-columns: 80px 1fr 150px 100px 150px 100px; gap: 15px; padding: 20px; align-items: center;">
                                <div style="font-family: Montserrat; font-size: 1.8rem; font-weight: 700; color: #FFFFFF;">#${usuarioRanking.posicao}</div>
                                <div style="font-weight: 900; color: var(--amarelo); font-size: 1.1rem; font-family: Montserrat;">
                                    ${usuarioRanking.nome} (VOCÊ)
                                </div>
                                <div style="color: #aaaaaa; font-size: 0.95rem; font-weight: 600;">${usuarioRanking.patente}</div>
                                <div style="font-family: Montserrat; color: var(--amarelo); font-weight: 900; font-size: 1.3rem;">${usuarioRanking.pontos}</div>
                                <div style="color: #FFFFFF; font-size: 1.1rem; font-weight: 700;">${Object.values(usuarioRanking.conquistasContador || {}).reduce((a, b) => a + b, 0)} 🏆</div>
                                <div style="color: #aaaaaa; font-size: 1.1rem; font-weight: 600;">${(usuarioRanking.casosComprados || []).length}</div>
                            </div>
                        ` : ''}
                    </div>
                    
                    <!-- VERSÃO MOBILE -->
                    <style>
                        @media (max-width: 768px) {
                            .rank-header, .rank-row {
                                grid-template-columns: 1fr !important;
                                gap: 10px !important;
                            }
                            .rank-header > div, .rank-row > div {
                                display: flex;
                                justify-content: space-between;
                                align-items: center;
                            }
                            .rank-header > div::before, .rank-row > div::before {
                                content: attr(data-label);
                                font-weight: 700;
                                color: var(--amarelo);
                            }
                        }
                    </style>
                </section>
            `;
        }

        // ==================== VALIDAÇÕES DE FORMULÁRIO ==================== //
        
        // Máscara de Telefone: (99) 99999-9999
        function mascaraTelefone(input) {
            let valor = input.value.replace(/\D/g, '');
            
            if (valor.length > 11) {
                valor = valor.slice(0, 11);
            }
            
            if (valor.length <= 10) {
                valor = valor.replace(/^(\d{2})(\d{4})(\d{0,4})/, '($1) $2-$3');
            } else {
                valor = valor.replace(/^(\d{2})(\d{5})(\d{0,4})/, '($1) $2-$3');
            }
            
            input.value = valor;
            validarTelefone(input);
        }
        
        // Validar Telefone
        function validarTelefone(input) {
            const valor = input.value.replace(/\D/g, '');
            const wrapper = input.parentElement;
            const feedback = wrapper.nextElementSibling;
            const icon = wrapper.querySelector('.input-icon');
            
            if (valor.length === 0) {
                input.classList.remove('valid', 'invalid');
                feedback.classList.remove('error', 'success');
                feedback.style.display = 'none';
                icon.classList.remove('show');
                return false;
            }
            
            if (valor.length === 10 || valor.length === 11) {
                input.classList.add('valid');
                input.classList.remove('invalid');
                feedback.textContent = '✓ Telefone válido';
                feedback.classList.add('success');
                feedback.classList.remove('error');
                icon.textContent = '✓';
                icon.classList.add('valid', 'show');
                icon.classList.remove('invalid');
                return true;
            } else {
                input.classList.add('invalid');
                input.classList.remove('valid');
                feedback.textContent = '✗ Telefone incompleto';
                feedback.classList.add('error');
                feedback.classList.remove('success');
                icon.textContent = '✗';
                icon.classList.add('invalid', 'show');
                icon.classList.remove('valid');
                return false;
            }
        }
        
        // Validar Email
        function validarEmail(input) {
            const valor = input.value.trim();
            const wrapper = input.parentElement;
            const feedback = wrapper.nextElementSibling;
            const icon = wrapper.querySelector('.input-icon');
            const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            if (valor.length === 0) {
                input.classList.remove('valid', 'invalid');
                feedback.classList.remove('error', 'success');
                feedback.style.display = 'none';
                icon.classList.remove('show');
                return false;
            }
            
            if (regex.test(valor)) {
                input.classList.add('valid');
                input.classList.remove('invalid');
                feedback.textContent = '✓ Email válido';
                feedback.classList.add('success');
                feedback.classList.remove('error');
                icon.textContent = '✓';
                icon.classList.add('valid', 'show');
                icon.classList.remove('invalid');
                return true;
            } else {
                input.classList.add('invalid');
                input.classList.remove('valid');
                feedback.textContent = '✗ Email inválido (exemplo: nome@email.com)';
                feedback.classList.add('error');
                feedback.classList.remove('success');
                icon.textContent = '✗';
                icon.classList.add('invalid', 'show');
                icon.classList.remove('valid');
                return false;
            }
        }
        
        // Validar Nome/Nick (máx 30 caracteres, sem acentos/pontuação)
        function validarNome(input) {
            let valor = input.value;
            const wrapper = input.parentElement;
            const feedback = wrapper.nextElementSibling;
            const icon = wrapper.querySelector('.input-icon');
            
            // Remove acentos
            valor = valor
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '');
            
            // Remove pontuação e caracteres especiais, permite apenas letras, números e espaços
            valor = valor.replace(/[^a-zA-Z0-9\s]/g, '');
            
            // Limita a 30 caracteres
            if (valor.length > 30) {
                valor = valor.slice(0, 30);
            }
            
            input.value = valor;
            
            if (valor.length === 0) {
                input.classList.remove('valid', 'invalid');
                feedback.classList.remove('error', 'success');
                feedback.style.display = 'none';
                icon.classList.remove('show');
                return false;
            }
            
            if (valor.length >= 3 && valor.length <= 30) {
                input.classList.add('valid');
                input.classList.remove('invalid');
                feedback.textContent = `✓ Nome válido (${valor.length}/30 caracteres)`;
                feedback.classList.add('success');
                feedback.classList.remove('error');
                icon.textContent = '✓';
                icon.classList.add('valid', 'show');
                icon.classList.remove('invalid');
                return true;
            } else {
                input.classList.add('invalid');
                input.classList.remove('valid');
                feedback.textContent = `✗ Nome deve ter entre 3 e 30 caracteres (${valor.length}/30)`;
                feedback.classList.add('error');
                feedback.classList.remove('success');
                icon.textContent = '✗';
                icon.classList.add('invalid', 'show');
                icon.classList.remove('valid');
                return false;
            }
        }
        
        // Calcular força da senha
        function calcularForcaSenha(senha) {
            let forca = 0;
            
            // Critérios de força
            if (senha.length >= 8) forca++;
            if (senha.length >= 12) forca++;
            if (/[a-z]/.test(senha)) forca++;
            if (/[A-Z]/.test(senha)) forca++;
            if (/[0-9]/.test(senha)) forca++;
            if (/[^a-zA-Z0-9]/.test(senha)) forca++;
            
            if (forca <= 2) return 'fraca';
            if (forca <= 4) return 'media';
            return 'forte';
        }
        
        // Validar Senha com Termômetro
        function validarSenha(input) {
            const valor = input.value;
            const strengthBar = document.getElementById('senha-strength-bar');
            const strengthText = document.getElementById('senha-strength-text');
            const wrapper = input.parentElement;
            const passwordStrength = wrapper.nextElementSibling;
            const feedback = passwordStrength.nextElementSibling;
            
            if (valor.length === 0) {
                input.classList.remove('valid', 'invalid');
                strengthBar.className = 'strength-bar-fill';
                strengthText.textContent = '';
                strengthText.className = 'strength-text';
                feedback.classList.remove('error', 'success');
                feedback.style.display = 'none';
                return false;
            }
            
            const forca = calcularForcaSenha(valor);
            
            // Atualiza barra de força
            strengthBar.className = `strength-bar-fill ${forca}`;
            
            // Atualiza texto e feedback
            if (forca === 'fraca') {
                strengthText.innerHTML = '<span class="strength-icon">🔓</span> FRACA';
                strengthText.className = 'strength-text fraca';
                input.classList.add('invalid');
                input.classList.remove('valid');
                feedback.textContent = '✗ Senha muito fraca. Use letras, números e símbolos.';
                feedback.classList.add('error');
                feedback.classList.remove('success');
                return false;
            } else if (forca === 'media') {
                strengthText.innerHTML = '<span class="strength-icon">🔐</span> MÉDIA';
                strengthText.className = 'strength-text media';
                input.classList.add('valid');
                input.classList.remove('invalid');
                feedback.textContent = '⚠ Senha média. Adicione mais caracteres ou símbolos para maior segurança.';
                feedback.classList.add('success');
                feedback.classList.remove('error');
                return true;
            } else {
                strengthText.innerHTML = '<span class="strength-icon">🔒</span> FORTE';
                strengthText.className = 'strength-text forte';
                input.classList.add('valid');
                input.classList.remove('invalid');
                feedback.textContent = '✓ Senha forte! Excelente segurança.';
                feedback.classList.add('success');
                feedback.classList.remove('error');
                return true;
            }
        }
        
        // Validar Confirmação de Senha
        function validarConfirmacaoSenha(input) {
            const senha = document.getElementById('senhaCadastro').value;
            const confirmacao = input.value;
            const wrapper = input.parentElement;
            const feedback = wrapper.nextElementSibling;
            const icon = wrapper.querySelector('.input-icon');
            
            if (confirmacao.length === 0) {
                input.classList.remove('valid', 'invalid');
                feedback.classList.remove('error', 'success');
                feedback.style.display = 'none';
                icon.classList.remove('show');
                return false;
            }
            
            if (senha === confirmacao) {
                input.classList.add('valid');
                input.classList.remove('invalid');
                feedback.textContent = '✓ Senhas coincidem';
                feedback.classList.add('success');
                feedback.classList.remove('error');
                icon.textContent = '✓';
                icon.classList.add('valid', 'show');
                icon.classList.remove('invalid');
                return true;
            } else {
                input.classList.add('invalid');
                input.classList.remove('valid');
                feedback.textContent = '✗ Senhas não coincidem';
                feedback.classList.add('error');
                feedback.classList.remove('success');
                icon.textContent = '✗';
                icon.classList.add('invalid', 'show');
                icon.classList.remove('valid');
                return false;
            }
        }
        
        // Inicializar validações quando a página de cadastro for renderizada
        function inicializarValidacoes() {
            setTimeout(() => {
                // Telefone
                const telefoneInput = document.getElementById('telefoneCadastro');
                if (telefoneInput) {
                    telefoneInput.addEventListener('input', function() {
                        mascaraTelefone(this);
                    });
                    telefoneInput.addEventListener('blur', function() {
                        validarTelefone(this);
                    });
                }
                
                // Email
                const emailInput = document.getElementById('emailCadastro');
                if (emailInput) {
                    emailInput.addEventListener('input', function() {
                        validarEmail(this);
                    });
                    emailInput.addEventListener('blur', function() {
                        validarEmail(this);
                    });
                }
                
                // Nome
                const nomeInput = document.getElementById('nomeCadastro');
                if (nomeInput) {
                    nomeInput.addEventListener('input', function() {
                        validarNome(this);
                    });
                    nomeInput.addEventListener('blur', function() {
                        validarNome(this);
                    });
                }
                
                // Senha
                const senhaInput = document.getElementById('senhaCadastro');
                if (senhaInput) {
                    senhaInput.addEventListener('input', function() {
                        validarSenha(this);
                        const confirmarSenha = document.getElementById('confirmarSenha');
                        if (confirmarSenha && confirmarSenha.value.length > 0) {
                            validarConfirmacaoSenha(confirmarSenha);
                        }
                    });
                }
                
                // Confirmar Senha
                const confirmarSenhaInput = document.getElementById('confirmarSenha');
                if (confirmarSenhaInput) {
                    confirmarSenhaInput.addEventListener('input', function() {
                        validarConfirmacaoSenha(this);
                    });
                    confirmarSenhaInput.addEventListener('blur', function() {
                        validarConfirmacaoSenha(this);
                    });
                }
            }, 100);
        }

        // ==================== INICIALIZAÇÃO ==================== //
        document.addEventListener('DOMContentLoaded', function() {
            console.log('✅ FATTO CRIMINAL V2.0 carregado!');
            console.log('✅ 6 casos disponíveis');
            console.log('✅ Visual limpo e moderno');
            console.log('✅ Todas as funcionalidades operacionais');
            console.log('✅ Validações de formulário ativas');
            
            // Atualizar header e carrinho após carregar do localStorage
            if (usuarioLogado) {
                atualizarHeader();
            }
            if (carrinho.length > 0) {
                atualizarCarrinhoBadge();
            }
            
            renderizarPagina();
        });
    </script>
</body>
</html>